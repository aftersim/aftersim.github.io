(function(e){function t(t){for(var a,n,o=t[0],l=t[1],c=t[2],u=0,h=[];u<o.length;u++)n=o[u],Object.prototype.hasOwnProperty.call(s,n)&&s[n]&&h.push(s[n][0]),s[n]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);d&&d(t);while(h.length)h.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var e,t=0;t<r.length;t++){for(var i=r[t],a=!0,n=1;n<i.length;n++){var o=i[n];0!==s[o]&&(a=!1)}a&&(r.splice(t--,1),e=l(l.s=i[0]))}return e}var a={},n={app:0},s={app:0},r=[];function o(e){return l.p+"js/"+({sql:"sql",split:"split"}[e]||e)+"."+{sql:"db98d973",split:"3d65281f"}[e]+".js"}function l(t){if(a[t])return a[t].exports;var i=a[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,l),i.l=!0,i.exports}l.e=function(e){var t=[],i={sql:1,split:1};n[e]?t.push(n[e]):0!==n[e]&&i[e]&&t.push(n[e]=new Promise((function(t,i){for(var a="css/"+({sql:"sql",split:"split"}[e]||e)+"."+{sql:"73d4318a",split:"43a2c683"}[e]+".css",s=l.p+a,r=document.getElementsByTagName("link"),o=0;o<r.length;o++){var c=r[o],u=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(u===a||u===s))return t()}var h=document.getElementsByTagName("style");for(o=0;o<h.length;o++){c=h[o],u=c.getAttribute("data-href");if(u===a||u===s)return t()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=t,d.onerror=function(t){var a=t&&t.target&&t.target.src||s,r=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");r.code="CSS_CHUNK_LOAD_FAILED",r.request=a,delete n[e],d.parentNode.removeChild(d),i(r)},d.href=s;var p=document.getElementsByTagName("head")[0];p.appendChild(d)})).then((function(){n[e]=0})));var a=s[e];if(0!==a)if(a)t.push(a[2]);else{var r=new Promise((function(t,i){a=s[e]=[t,i]}));t.push(a[2]=r);var c,u=document.createElement("script");u.charset="utf-8",u.timeout=120,l.nc&&u.setAttribute("nonce",l.nc),u.src=o(e);var h=new Error;c=function(t){u.onerror=u.onload=null,clearTimeout(d);var i=s[e];if(0!==i){if(i){var a=t&&("load"===t.type?"missing":t.type),n=t&&t.target&&t.target.src;h.message="Loading chunk "+e+" failed.\n("+a+": "+n+")",h.name="ChunkLoadError",h.type=a,h.request=n,i[1](h)}s[e]=void 0}};var d=setTimeout((function(){c({type:"timeout",target:u})}),12e4);u.onerror=u.onload=c,document.head.appendChild(u)}return Promise.all(t)},l.m=e,l.c=a,l.d=function(e,t,i){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(l.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)l.d(i,a,function(t){return e[t]}.bind(null,a));return i},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/",l.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var h=0;h<c.length;h++)t(c[h]);var d=u;r.push([1,"chunk-vendors"]),i()})({0:function(e,t){},"0386":function(e,t,i){e.exports=i.p+"img/darkmode.a447d0e4.jpg"},"0405":function(e,t,i){},"0554":function(e,t,i){"use strict";i.r(t),t["default"]='// BC 2021-04-30: this file forked from https://github.com/visgl/deck.gl\n//\n// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nuniform float currentTime;\nvarying float vPercentComplete;\n\nvoid main(void) {\n\n  if (vPercentComplete == -1.0) discard;\n\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n\n  // if colorMode == 0, use pixel color from the texture\n  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  // Take the global opacity and the alpha from vColor into account for the alpha component\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n'},"08a6":function(e,t,i){"use strict";i("ffb1")},"0d03":function(e,t,i){"use strict";i("0d67")},"0d67":function(e,t,i){},1:function(e,t,i){e.exports=i("cd49")},"10a0":function(e,t,i){"use strict";i.d(t,"f",(function(){return r})),i.d(t,"e",(function(){return o})),i.d(t,"g",(function(){return a})),i.d(t,"a",(function(){return n})),i.d(t,"c",(function(){return c})),i.d(t,"b",(function(){return u})),i.d(t,"d",(function(){return l}));var a,n,s,r={light:"mapbox://styles/mapbox/light-v10",dark:"mapbox://styles/vsp-tu-berlin/ckek59op0011219pbwfar1rex"},o="pk.eyJ1IjoidnNwLXR1LWJlcmxpbiIsImEiOiJjamNpemh1bmEzNmF0MndudHI5aGFmeXpoIn0.u9f04rjFo7ZbWiSceTTXyA";(function(e){e[e["INFO"]=0]="INFO",e[e["WARNING"]=1]="WARNING"})(a||(a={})),function(e){e["LightMode"]="light",e["DarkMode"]="dark"}(n||(n={})),function(e){e["Susceptible"]="susceptible",e["InfectedButNotContagious"]="infectedButNotContagious",e["Contagious"]="contagious"}(s||(s={}));var l,c={text:"#000",background:"#ccccc4",links:"#ffffff",susceptible:"#999900",infectedButNotContagious:"#0077ff",contagious:"#bb0044",symptomatic:"#ff5533",seriouslyIll:"#7733ee",critical:"#000",recovered:"#116622"},u={text:"#fff",background:"#181518",links:"#445577",susceptible:"#bbbb44",infectedButNotContagious:"#00dddd",contagious:"#ff2299",symptomatic:"#ff5533",seriouslyIll:"#7733ee",critical:"#fff",recovered:"#116622"};(function(e){e[e["line"]=0]="line",e[e["box"]=1]="box"})(l||(l={}))},"11f4":function(e,t,i){},"125f":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"light":"light","dark":"dark","share":"share"},"de":{"light":"hell","dark":"dark","share":"freigeben"}}'),delete e.options._Ctor}},"15f6":function(e,t,i){},"18ab":function(e,t,i){},"1a8b":function(e,t,i){"use strict";var a=i("125f"),n=i.n(a);t["default"]=n.a},"1bf3":function(e,t,i){},"1ef6":function(e,t,i){},2:function(e,t){},"258b":function(e,t,i){},"2fbe":function(e,t,i){},3:function(e,t){},"301c":function(e,t,i){e.exports=i.p+"img/banner.7663a105.jpg"},3432:function(e,t,i){"use strict";i("cf49")},3630:function(e,t,i){},"363d":function(e,t,i){"use strict";(function(e){var a=i("1da1"),n=i("d4ec"),s=i("bee2"),r=i("262e"),o=i("2caf"),l=(i("96cf"),i("d3b7"),i("ddb0"),i("9ab4")),c=i("f2ec"),u=i("731b"),h=i("25f1"),d=i("60a3"),p=function(t){Object(r["a"])(l,t);var i=Object(o["a"])(l);function l(){var e;return Object(n["a"])(this,l),e=i.apply(this,arguments),e.table=[],e.entries=[],e.title="Topsheet",e}return Object(s["a"])(l,[{key:"formattedValue",value:function(e){return isNaN(e)?e:e.toLocaleString([this.$store.state.locale,"en"])}},{key:"mounted",value:function(){this.files.length&&this.runTopSheet()}},{key:"beforeDestroy",value:function(){try{this.solverThread&&(c["a"].terminate(this.solverThread),this.solverThread=null)}catch(e){console.warn(e)}}},{key:"boxChanged",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("changed!"),!this.solverThread){e.next=6;break}return e.next=4,this.solverThread.updateCalculations(this.entries);case 4:t=e.sent,this.table=t;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"runTopSheet",value:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.files.length){t.next=2;break}return t.abrupt("return");case 2:if(this.solverThread){t.next=7;break}return console.log("spawing topsheet thread"),t.next=6,Object(u["a"])(new h["a"](e));case 6:this.solverThread=t.sent;case 7:return t.prev=7,t.next=10,this.solverThread.runTopSheet({fileSystemConfig:this.fileSystemConfig,subfolder:this.subfolder,files:this.files,yaml:this.yaml});case 10:return this.table=t.sent,t.next=13,this.solverThread.getTitle(this.$store.state.locale);case 13:return this.title=t.sent,t.next=16,this.solverThread.getTextEntryFields();case 16:i=t.sent,this.entries=i,t.next=25;break;case 20:t.prev=20,t.t0=t["catch"](7),a=""+t.t0,console.log(a),this.table=[];case 25:case"end":return t.stop()}}),t,this,[[7,20]])})));function i(){return t.apply(this,arguments)}return i}()}]),l}(d["c"]);Object(l["a"])([Object(d["b"])({required:!0})],p.prototype,"fileSystemConfig",void 0),Object(l["a"])([Object(d["b"])({required:!0})],p.prototype,"subfolder",void 0),Object(l["a"])([Object(d["b"])({required:!0})],p.prototype,"files",void 0),Object(l["a"])([Object(d["b"])({required:!0})],p.prototype,"yaml",void 0),p=Object(l["a"])([Object(d["a"])({components:{}})],p),t["a"]=p}).call(this,i("3e87"))},"3a0b":function(e,t,i){"use strict";i("4ec9"),i("d3b7"),i("3ca3"),i("ddb0"),i("99af"),i("a434");var a=i("2b0e"),n=i("2f62"),s=i("10a0"),r=[{name:"Localhost",slug:"local",description:"Run mini-file-server to browse files on your PC",baseURL:"http://localhost:8000",needPassword:!1,thumbnail:"/thumb-localfiles.jpg",dashboardFolder:".dashboards"},{name:"Public-SVN",slug:"public-svn",description:"Simulation results from VSP at TU-Berlin",baseURL:"https://svn.vsp.tu-berlin.de/repos/public-svn/matsim/scenarios/countries",needPassword:!1,thumbnail:"/thumb-chart.jpg",skipList:["episim/battery"]}],o=r;a["default"].use(n["a"]);var l=function(){return{initial:!0,longitude:3.4,latitude:45.5,zoom:4,pitch:0,bearing:0}};t["a"]=new n["a"].Store({state:{app:"aftersim",debug:!1,authAttempts:0,breadcrumbs:[],credentials:{fake:"fake"},isFullScreen:!1,isDarkMode:!1,needLoginForUrl:"",statusErrors:[],statusMessage:"Loading",svnProjects:o,visualizationTypes:new Map,colorScheme:s["a"].LightMode,locale:"en",runFolders:{},runFolderCount:0,resizeEvents:0,viewState:l()},mutations:{updateRunFolders:function(e,t){e.runFolderCount=t.number,e.runFolders=t.folders},requestLogin:function(e,t){e.needLoginForUrl=t},registerPlugin:function(e,t){e.visualizationTypes.set(t.kebabName,t)},setBreadCrumbs:function(e,t){e.breadcrumbs=t},setCredentials:function(e,t){var i=btoa("".concat(t.username,":").concat(t.pw));e.credentials[t.url]=i,e.authAttempts++},setFullScreen:function(e,t){e.isFullScreen=t},setMapCamera:function(e,t){t.jump?e.viewState.initial&&(e.viewState=t):e.viewState=t},setStatus:function(e,t){t.type===s["g"].INFO?e.statusMessage=t.msg:e.statusErrors.length&&e.statusErrors[e.statusErrors.length-1]===t.msg||e.statusErrors.push(t.msg)},clearError:function(e,t){e.statusErrors.length>=t&&e.statusErrors.splice(t,1)},clearAllErrors:function(e){e.statusErrors=[]},resize:function(e){e.resizeEvents+=1},rotateColors:function(e){e.colorScheme=e.colorScheme===s["a"].DarkMode?s["a"].LightMode:s["a"].DarkMode,e.isDarkMode=e.colorScheme===s["a"].DarkMode,console.log("NEW COLORS:",e.colorScheme),localStorage.setItem("colorscheme",e.colorScheme),document.body.style.backgroundColor=e.colorScheme===s["a"].LightMode?"#edebe4":"#2d3133"},setLocale:function(e,t){e.locale=t.toLocaleLowerCase(),localStorage.setItem("locale",e.locale),console.log("NEW LOCALE:",e.locale)}},actions:{},modules:{},getters:{}})},"3e87":function(e,t,i){e.exports=i.p+"js/1.e6434160.worker.js"},"3eea":function(e,t,i){},4:function(e,t){},4219:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"selectColumn":"Select data column","loading":"Loading...","bandwidths":"Widths: 1 pixel =","timeOfDay":"Time of day","colors":"Colors"},"de":{"selectColumn":"Datenspalte wählen","loading":"Laden...","bandwidths":"Linienbreiten: 1 pixel =","timeOfDay":"Uhrzeit","colors":"Farben"}}'),delete e.options._Ctor}},"432b":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"all":"All","colors":"Colors","loading":"Loading","selectColumn":"Select data column","timeOfDay":"Time of Day"},"de":{"all":"Alle","colors":"Farben","loading":"Wird geladen","selectColumn":"Datenspalte wählen","timeOfDay":"Uhrzeit"}}'),delete e.options._Ctor}},4714:function(e,t,i){"use strict";i("929a")},"48e2":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"loading":"Loading data...","sorting":"Sorting into bins...","threedee":"Show in 3D","aggregate":"Summary","maxHeight":"Max Height","showDetails":"Show Details","selection":"Selection","areas":"Areas","count":"Count"},"de":{"loading":"Dateien laden...","sorting":"Sortieren...","threedee":"In 3D anzeigen","aggregate":"Daten","maxHeight":"Max Höhe","showDetails":"Details anzeigen","selection":"Ausgewählt","areas":"Orte","count":"Anzahl"}}'),delete e.options._Ctor}},4978:function(e,t,i){"use strict";i("99d1")},"49fc":function(e,t,i){"use strict";i("9a53")},"4a17":function(e,t,i){"use strict";i("586d")},"4a60":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"map",attrs:{id:e.mapID},on:{click:e.handleEmptyClick}})},n=[],s=i("d4ec"),r=i("bee2"),o=i("262e"),l=i("2caf"),c=(i("99af"),i("d81d"),i("fb6a"),i("9ab4")),u=i("60a3"),h=i("60a4"),d=i("595c"),p=i.n(d),m=i("5530"),f=i("4ce1"),v=i("5d0f"),g=function(e){Object(o["a"])(i,e);var t=Object(l["a"])(i);function i(){Object(s["a"])(this,i);for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return t.call.apply(t,[this].concat(a))}return Object(r["a"])(i,[{key:"renderLayers",value:function(){var e=this,t=this.props,i=t.selectedHexStats,a=t.elevationScale,n=t.extruded,s=t.coverage,r=t.material,o=t.transitions,l=this.state,c=l.angle,u=l.radius,h=l.cpuAggregator,d=l.vertices,p=this.getSubLayerClass("hexagon-cell",v["a"]),f=this._getSublayerUpdateTriggers(),g=d&&d.length?{vertices:d,radius:1}:{radius:u,angle:c};return new p(Object(m["a"])(Object(m["a"])({},g),{},{diskResolution:6,elevationScale:a,extruded:n,coverage:s,material:r,getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight},getFillColor:function(t){return i&&i.selectedHexagonIds.indexOf(t.index)>-1?[255,64,255]:e._onGetSublayerColor.bind(e)(t)}}),this.getSubLayerProps({id:"hexagon-cell",updateTriggers:f}),{data:h.state.layerData.data})}}]),i}(f["a"]),b=i("b85c"),y=(i("f00c"),i("a9e3"),i("3723")),k=i("ae9c"),S=i("261f");function w(e,t){var i,a=e.data,n=e.radius,s=(e.center,t.viewport),r=t.attributes,o=a.length?[14,52]:null,l=O(n,s,o),c=[],u=Object(k["a"])(a),h=u.iterable,d=u.objectInfo,p=r.positions.value,m=r.positions.getAccessor(),f=m.size,v=Object(b["a"])(h);try{for(v.s();!(i=v.n()).done;){var g=i.value;d.index++;var w=d.index*f,C=[p[w],p[w+1]],j=Number.isFinite(C[0])&&Number.isFinite(C[1]);j?c.push({screenCoord:s.projectFlat(C),source:g,index:d.index}):S["a"].warn("HexagonLayer: invalid position")()}}catch(_){v.e(_)}finally{v.f()}var x=Object(y["a"])().radius(l).x((function(e){return e.screenCoord[0]})).y((function(e){return e.screenCoord[1]})),T=x(c);return{hexagons:T.map((function(e,t){return{position:s.unprojectFlat([e.x,e.y]),points:e,index:t}})),radiusCommon:l}}function O(e,t,i){var a=t.getDistanceScales(i),n=a.unitsPerMeter;return e*n[0]}var C=i("fa45"),j=i("10a0"),x={ambient:.64,diffuse:.6,shininess:32,specularColor:[51,51,51]},T=function(e){Object(o["a"])(i,e);var t=Object(l["a"])(i);function i(){var e;return Object(s["a"])(this,i),e=t.apply(this,arguments),e.mapID="map-id-".concat(Math.floor(1e12*Math.random())),e}return Object(r["a"])(i,[{key:"viewState",get:function(){return this.$store.state.viewState}},{key:"viewMoved",value:function(){this.layerManager.deckInstance.setProps({viewState:this.viewState})}},{key:"swapTheme",value:function(){this.layerManager.updateStyle()}},{key:"handlePropsChanged",value:function(){this.layerManager&&this.updateLayers()}},{key:"mounted",value:function(){console.log(this.mapID),this.setupLayerManager(),this.updateLayers()}},{key:"beforeDestroy",value:function(){this.layerManager.destroy()}},{key:"handleEmptyClick",value:function(e){this.props.highlights.length&&this.$emit("emptyClick")}},{key:"setupLayerManager",value:function(){var e=this;this.layerManager=new C["a"],this.layerManager.init({container:"#".concat(this.mapID),viewState:this.$store.state.viewState,pickingRadius:3,mapStyle:this.props.dark?j["f"].dark:j["f"].light,getTooltip:this.getTooltip,onViewStateChange:function(t){var i=t.viewState;e.$store.commit("setMapCamera",i)}})}},{key:"getTooltip",value:function(e){var t=e.object,i=e.x,a=e.y;if(!t||!t.position||!t.position.length)return null;t.position[1],t.position[0];var n=t.points.length;return{html:"        <b>".concat(this.props.highlights.length?"Count":this.props.metric,": ").concat(n," </b><br/>\n      "),style:{backgroundColor:this.props.dark?"#445":"white",color:this.props.dark?"white":"#222",padding:"1rem 1rem",position:"absolute",left:i+4,top:a-80,boxShadow:"0px 2px 10px #22222266"}}}},{key:"handleClick",value:function(e,t){this.$emit("hexClick",e,t)}},{key:"handleViewState",value:function(e){this.$store.commit("setMapCamera",e)}},{key:"updateLayers",value:function(){var e=p()({colormap:this.props.colorRamp,nshades:10,format:"rba",alpha:1}).map((function(e){return[e[0],e[1],e[2]]})),t=null;t=this.props.highlights.length?this.props.highlights.map((function(e){return e[1]})):this.props.data?{length:this.props.data?this.props.data.length:0,attributes:{getPosition:{value:this.props.data.raw,size:2}}}:null,this.layerManager.addLayer(new h["a"]({id:"arc-layer",data:this.props.highlights,getSourcePosition:function(e){return e[0]},getTargetPosition:function(e){return e[1]},pickable:!1,opacity:.4,getHeight:0,getWidth:1,getSourceColor:this.props.dark?[144,96,128,192]:[192,192,240],getTargetColor:this.props.dark?[144,96,128,192]:[192,192,240]})),this.layerManager.addLayer(new g({id:"hex-layer",data:t,getPosition:this.props.highlights.length?function(e){return e}:null,colorRange:this.props.dark?e.slice(1):e.reverse().slice(1),coverage:this.props.coverage,autoHighlight:!0,elevationRange:[0,this.props.maxHeight],elevationScale:this.props.data&&this.props.data.length?50:0,extruded:this.props.extrude,selectedHexStats:this.props.selectedHexStats,hexagonAggregator:w,pickable:!0,opacity:.7,radius:this.props.radius,upperPercentile:this.props.upperPercentile,material:x,transitions:{elevationScale:{type:"interpolation",duration:250},opacity:{type:"interpolation",duration:250}},onClick:this.handleClick}))}}]),i}(u["c"]);Object(c["a"])([Object(u["b"])({required:!0})],T.prototype,"props",void 0),Object(c["a"])([Object(u["d"])("viewState")],T.prototype,"viewMoved",null),Object(c["a"])([Object(u["d"])("props.dark")],T.prototype,"swapTheme",null),Object(c["a"])([Object(u["d"])("props")],T.prototype,"handlePropsChanged",null),T=Object(c["a"])([Object(u["a"])({components:{}})],T);var _=T,R=_,M=i("2877"),A=Object(M["a"])(R,a,n,!1,null,null,null);t["a"]=A.exports},5:function(e,t){},"55ea":function(e,t,i){},"55f7":function(e,t,i){"use strict";i("726f")},"580a":function(e,t,i){"use strict";i("f181")},"586d":function(e,t,i){},"5ad6":function(e,t,i){"use strict";var a=i("48e2"),n=i.n(a);t["default"]=n.a},"5c0b":function(e,t,i){"use strict";i("9c0c")},6033:function(e,t,i){"use strict";i("a98e")},6044:function(e,t,i){},6348:function(e,t,i){},"648f":function(e,t,i){"use strict";var a=i("c2a5"),n=i.n(a);t["default"]=n.a},"65c1":function(e,t,i){},"6a19":function(e,t,i){"use strict";i("7f61")},"6d32":function(e,t,i){"use strict";i("e5dd")},"726f":function(e,t,i){},7339:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"draw-thing"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.showShapeDrawer,expression:"showShapeDrawer"}],staticClass:"map",attrs:{id:e.mapID}}),a("div",{staticClass:"map-actions"},[a("button",{staticClass:"button draw-button is-tiny",class:{"is-drawing":e.showShapeDrawer},style:{"border-color":e.isDark?"#111111":"#e0e0e0"},attrs:{title:"Draw"},on:{click:e.toggleShapeDrawer}},[a("img",{attrs:{src:i("cab3"),width:"16"}})])]),e.showShapeDrawer?a("div",{staticClass:"control-panel"},[a("h3",[e._v(e._s(e.$t("title")))]),a("p",[e._v(e._s(e.hint))]),a("div",{staticClass:"buttons"},[a("button",{staticClass:"button is-small export-button",style:{"is-outlined":!e.canExport},attrs:{disabled:!e.canExport},on:{click:e.exportIt}},[e._v(e._s(e.$t("shapefile")))]),a("button",{staticClass:"button is-small is-outlined",on:{click:e.cancel}},[e._v(e._s(e.$t("clear")))])])]):e._e()])},n=[],s=i("d4ec"),r=i("bee2"),o=i("262e"),l=i("2caf"),c=(i("4de4"),i("9ab4")),u=i("60a3"),h=i("7306"),d=i("fbbb"),p=i("9d6f"),m=i.n(p),f=i("fa45"),v=i("3a0b"),g=function(e){Object(o["a"])(i,e);var t=Object(l["a"])(i);function i(){var e;return Object(s["a"])(this,i),e=t.apply(this,arguments),e.canExport=!1,e.points=[],e.hint=e.$t("hint"),e.isDark=v["a"].state.isDarkMode,e.showShapeDrawer=!1,e.polygons=[{type:"Feature",geometry:{type:"Polygon",coordinates:[e.points]},finished:!1}],e.mapID="map-id-".concat(Math.floor(1e12*Math.random())),e}return Object(r["a"])(i,[{key:"flipDarkMode",value:function(){this.isDark=this.$store.state.isDarkMode}},{key:"toggleShapeDrawer",value:function(){this.clearShapes(),this.updateLayers(),this.showShapeDrawer=!this.showShapeDrawer}},{key:"clearShapes",value:function(){this.canExport=!1,this.points=[],this.polygons=[{type:"Feature",geometry:{type:"Polygon",coordinates:[this.points]},finished:!1}]}},{key:"viewState",get:function(){return this.$store.state.viewState}},{key:"viewMoved",value:function(){this.layerManager.deckInstance.setProps({viewState:this.viewState})}},{key:"swapTheme",value:function(){this.layerManager.updateStyle()}},{key:"mounted",value:function(){console.log(this.mapID),this.setupLayerManager(),this.updateLayers()}},{key:"beforeDestroy",value:function(){this.layerManager.destroy()}},{key:"setupLayerManager",value:function(){var e=this;this.layerManager=new f["a"],this.layerManager.init({container:"#".concat(this.mapID),viewState:this.$store.state.viewState,pickingRadius:3,mapStyle:null,getCursor:function(e){var t=e.isDragging,i=e.isHovering;return t?"grabbing":i?"pointer":"crosshair"},onViewStateChange:function(t){var i=t.viewState;e.$store.commit("setMapCamera",i)},onClick:this.handleMapClick})}},{key:"exportIt",value:function(){console.log("exporting"),this.polygons=this.polygons.filter((function(e){return e.finished})),this.points=[],this.updateLayers();var e={type:"FeatureCollection",features:this.polygons};m.a.download(e,{folder:"shapefile-wgs84",types:{point:"points",polygon:"polygons",line:"lines"}}),this.startNewPolygon()}},{key:"cancel",value:function(){this.hint=this.$t("hint"),this.clearShapes(),this.updateLayers(),this.showShapeDrawer=!1}},{key:"handleMapClick",value:function(e,t){e.coordinate&&(t.rightButton?this.points.pop():(this.points.push(e.coordinate),this.hint=this.$t("close-shape")),this.updateLayers())}},{key:"startNewPolygon",value:function(){this.points=[],this.polygons.push({type:"Feature",geometry:{type:"Polygon",coordinates:[this.points]},finished:!1})}},{key:"handlePointClick",value:function(e){return 0===e.index&&(this.points.push(this.points[0]),this.polygons[this.polygons.length-1].finished=!0,this.startNewPolygon(),this.canExport=!0,this.hint=this.$t("more-shapes"),this.updateLayers()),!0}},{key:"handleViewState",value:function(e){this.$store.commit("setMapCamera",e)}},{key:"updateLayers",value:function(){this.layerManager.removeLayer("draw-polygon-layer"),this.layerManager.addLayer(new h["a"]({id:"draw-polygon-layer",data:this.polygons,pickable:!1,stroked:!0,filled:!0,extruded:!1,lineWidthMinPixels:4,getFillColor:[175,160,255,80],getLineColor:[255,0,200],getLineWidth:10,parameters:{depthTest:!1}})),this.layerManager.removeLayer("scatterplot-layer"),this.layerManager.addLayer(new d["a"]({id:"scatterplot-layer",data:this.points,getPosition:function(e){return e},pickable:!0,stroked:!0,filled:!0,radiusMinPixels:6,radiusMaxPixels:6,lineWidthMinPixels:2,getFillColor:[255,0,200],getLineColor:[255,255,255],opacity:1,onClick:this.handlePointClick}))}}]),i}(u["c"]);Object(c["a"])([Object(u["d"])("$store.state.isDarkMode")],g.prototype,"flipDarkMode",null),Object(c["a"])([Object(u["d"])("viewState")],g.prototype,"viewMoved",null),Object(c["a"])([Object(u["d"])("globalStore.state.isDarkMode")],g.prototype,"swapTheme",null),g=Object(c["a"])([Object(u["a"])({components:{}})],g);var b=g,y=b,k=(i("e2bd"),i("2877")),S=i("d326"),w=Object(k["a"])(y,a,n,!1,null,"c317348e",null);"function"===typeof S["default"]&&Object(S["default"])(w);t["a"]=w.exports},"73ab":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"title":"Draw Shapes","hint":"Click on map to draw shapes.","clear":"Clear","shapefile":"Export","close-shape":"Add more points to close shape.","more-shapes":"Export now or start new shape."},"de":null}'),delete e.options._Ctor}},"79f5":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"metrics":"Metrics","viewer":"Transit Network"},"de":{"metrics":"Metrics","viewer":"ÖV Netzwerk"}}'),delete e.options._Ctor}},"7f61":function(e,t,i){},"818f":function(e,t,i){var a=i("4719"),n=i("301c"),s=i("a7f5"),r=i("b944"),o=a(n),l=a(s),c=a(r),u='<img src="'+o+'"> <h3 id="episim-covid-19-virus-spreading-dynamics">Episim: COVID-19 virus spreading dynamics</h3> <p>This animation illustrates the <a href="https://covid-sim.info">MATSIM-Episim model</a> as it simulates the spread of COVID-19 disease through <strong>Berlin, Germany</strong> and the surrounding area.</p> <p>Each dot depicts a person, going about their day. The colors represent their disease status:</p> <div style="display:flex;flex-direction:column;margin-bottom:1rem"> <p style="margin-bottom:.4rem"><span style="background-color:#c8c800">&nbsp;&nbsp;&nbsp;&nbsp;</span> Susceptible and healthy</p> <p style="margin-bottom:.4rem"><span style="background-color:#30ffff">&nbsp;&nbsp;&nbsp;&nbsp;</span> Latently Infected</p> <p style="margin-bottom:.4rem"><span style="background-color:#c80032">&nbsp;&nbsp;&nbsp;&nbsp;</span> Contagious</p> <p style="margin-bottom:.4rem"><span style="background-color:#ff5532">&nbsp;&nbsp;&nbsp;&nbsp;</span> Showing Symptoms</p> <p style="margin-bottom:.4rem"><span style="background-color:#6e2878">&nbsp;&nbsp;&nbsp;&nbsp;</span> Seriously Sick</p> <p style="margin-bottom:.4rem"><span style="background-color:#141414">&nbsp;&nbsp;&nbsp;&nbsp;</span> Critical</p> <p style="margin-bottom:.4rem"><span style="background-color:#1a7a2c">&nbsp;&nbsp;&nbsp;&nbsp;</span> Recovered</p> </div> <p>You can select different days to see how the population&#39;s health shifts over time.</p> <p>This is a &quot;Base Case&quot; simulation for illustrative purposes. It shows what would have happened in Berlin if there had been no social distancing measures, no closing of schools and workplaces, etc.</p> <p>This illustration shows only a small sample of the total tripmaking in Berlin; while MATSim-Episim can model each agent individually, it is too much data to show on one screen in disaggregate form.</p> <h3 id="interesting-things-to-explore">Interesting things to explore</h3> <ul> <li><p>By day 14, new infections <span style="background-color:#30e6f0">&nbsp;&nbsp;&nbsp;&nbsp;</span> are quite noticeable throughout Berlin, and by day 18 they are everywhere in the city</p> </li> <li><p>By day 33, many recovered people <span style="background-color:#1e7846">&nbsp;&nbsp;&nbsp;&nbsp;</span> are apparent</p> </li> <li><p>By day 40, most of the new infections occur far outside the central urban area of Berlin.</p> </li> </ul> <h3 id="how-does-the-simulation-work">How does the simulation work?</h3> <p>The method used by MATSIM-Episim is available on the front page at <a href="https://matsim-vsp.github.io">https://matsim-vsp.github.io</a>. It is based on advanced human mobility models and virus infection dynamics taken from recent literature and publications.</p> <h3 id="for-more-information">For more information</h3> <p>Please email us at <a href="mailto:covid19@vsp.tu-berlin.de">covid19@vsp.tu-berlin.de</a> for more information.</p> <p>The main website is at <a href="https://covid-sim.info">matsim-vsp.github.io</a> is under heavy development as we build new versions of the Episim model.</p> <p>MATSim-Episim is freely available and open source, and can be downloaded at <a href="https://github.com/matsim-org/matsim-episim">https://github.com/matsim-org/matsim-episim</a>.</p> <h3 id="acknowledgements">Acknowledgements</h3> <p>This site and the MATSim-Episim model are developed at Technische Universität Berlin, by the Transport Systems Planning and Transport Telematics group, Institute for Land and Sea Transport (ILS) at TU Berlin. Professor Kai Nagel leads the team.</p> <p>This research supported by the <a href="https://bmbf.de">Bundesministerium für Bildung und Forschung</a> at the German Federal Goverment.</p> <p>Website and visulations built using <a href="https://vuejs.org">Vue</a> and <a href="https://threejs.org">Three.js</a>.</p> <hr> <img src="'+l+'" width="40%"> <br/> <br/> <img src="'+c+'" width="40%"> <br/> <br/> <br/> <br/> ';e.exports=u},"83c7":function(e,t,i){"use strict";i("d429")},8668:function(e,t,i){"use strict";i("a417")},"86b8":function(e,t,i){},"8c14":function(e,t,i){"use strict";var a=i("9a46"),n=i.n(a);t["default"]=n.a},"90da":function(e,t,i){"use strict";i("9bba")},"920e":function(e,t,i){"use strict";i("18ab")},"929a":function(e,t,i){},"99d1":function(e,t,i){},"9a46":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"all":"All","colors":"Colors","loading":"Loading","selectColumn":"Select data column","timeOfDay":"Time of day","bandwidths":"Widths: 1 pixel =","showDiffs":"Show Differences"},"de":{"all":"Alle","colors":"Farben","loading":"Wird geladen","selectColumn":"Datenspalte wählen","timeOfDay":"Uhrzeit","bandwidths":"Linienbreiten: 1 pixel =","showDiffs":"Differenzen"}}'),delete e.options._Ctor}},"9a53":function(e,t,i){},"9a5c":function(e,t,i){"use strict";i("0405")},"9bba":function(e,t,i){},"9c0c":function(e,t,i){},"9c40":function(e,t,i){"use strict";i("bb86")},"9cbf":function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"title":"Key Performance Indicators"},"de":{"title":"Key Performance Indicators"}}'),delete e.options._Ctor}},a058:function(e,t,i){},a270:function(e,t,i){"use strict";i("b2c7")},a278:function(e,t,i){"use strict";i.r(t),t["default"]="// fragment shader: pixel colors\nuniform float simulationTime;\n\n// passed in from vertex shader:\nvarying float skip;\nvarying float atRest;\n\nvec4 getColor() {\n\n    if (atRest == 1.0) {\n        return vec4(0.0, 0.5, 0.2, 1.0);\n    }\n\n    return vec4(1.0, 1.0, 0.5, 1.0);\n}\n\n\nvoid main() {\n    // don't do anything if this trip is currently out of time bounds\n    if (skip == 1.0) {\n\n        gl_FragColor = vec4(0,0,0,0);\n\n    } else {\n\n        gl_FragColor = getColor();\n\n    }\n}\n"},a28f:function(e,t,i){"use strict";i("6044")},a2d2:function(e,t,i){"use strict";var a=i("432b"),n=i.n(a);t["default"]=n.a},a417:function(e,t,i){},a504:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"folder-browser"},[e.myState.errorStatus?i("div",{staticClass:"stripe details"},[i("div",{staticClass:"vessel"},[i("div",{staticClass:"badnews",domProps:{innerHTML:e._s(e.myState.errorStatus)}})])]):i("div",{staticClass:"stripe details"},[i("div",{staticClass:"vessel"},[i("div",{staticClass:"curated-sections"},[e.myState.svnProject?i("h2",[e._v(e._s(e.myState.svnProject.name)+": "+e._s(e.xsubfolder||"/"))]):e._e(),e.xsubfolder?i("a",{on:{click:function(t){return e.openOutputFolder("..")}}},[e._v("^ UP")]):e._e(),i("div",{staticClass:"readme-header"},[e.myState.readme?i("div",{staticClass:"curate-content markdown",domProps:{innerHTML:e._s(e.myState.readme)}}):e._e()]),e.myState.folders.length?i("h3",{staticClass:"curate-heading"},[e._v(" "+e._s(e.$t("Folders")))]):e._e(),e.myState.folders.length?i("div",{staticClass:"curate-content"},[i("div",{staticClass:"folder-table"},e._l(e.myState.folders,(function(t){return i("div",{key:t.name,staticClass:"folder",class:{fade:e.myState.isLoading},on:{click:function(i){return e.openOutputFolder(t)}}},[i("p",[i("i",{staticClass:"fa fa-folder-open"}),e._v(" "+e._s(t))])])})),0)]):e._e(),i("topsheets-finder",{attrs:{fileSystemConfig:e.myState.svnProject,subfolder:e.xsubfolder,files:e.myState.files}}),e.myState.vizes.length?i("h3",{staticClass:"curate-heading"},[e._v(e._s(e.$t("Analysis")))]):e._e(),e.myState.vizes.length?i("div",{staticClass:"curate-content"},[i("div",{staticClass:"viz-table"},e._l(e.myState.vizes,(function(t,a){return i("div",{key:t.config,staticClass:"viz-grid-item",on:{click:function(t){return e.clickedVisualization(a)}}},[i("div",{staticClass:"viz-frame"},[i(t.component,{tag:"component",staticClass:"viz-frame-component",style:{"pointer-events":"image-view"===t.component?"auto":"none"},attrs:{root:e.myState.svnProject.slug,subfolder:e.myState.subfolder,yamlConfig:t.config,thumbnail:!0,fileApi:e.myState.svnRoot},on:{title:function(t){return e.updateTitle(a,t)}}}),i("p",[e._v(e._s(t.title))])],1)])})),0)]):e._e(),e.myState.files.length?i("h3",{staticClass:"curate-heading"},[e._v(e._s(e.$t("Files")))]):e._e(),e.myState.files.length?i("div",{staticClass:"curate-content"},[i("div",{staticClass:"file-table"},e._l(e.myState.files,(function(t){return i("div",{key:t,staticClass:"file",class:{fade:e.myState.isLoading}},[i("a",{attrs:{href:e.myState.svnProject.baseURL+"/"+e.myState.subfolder+"/"+t}},[e._v(e._s(t))])])})),0)]):e._e()],1)])])])},n=[],s=i("1da1"),r=i("b85c"),o=i("d4ec"),l=i("bee2"),c=i("262e"),u=i("2caf"),h=(i("96cf"),i("4de4"),i("b0c0"),i("ac1f"),i("1276"),i("d3b7"),i("ddb0"),i("d81d"),i("2ca0"),i("99af"),i("9ab4")),d=i("60a3"),p=i("d4cd"),m=i.n(p),f=i("d15e"),v=i("db05"),g=i.n(v),b=i("8f3c"),y=i.n(b),k=i("3a0b"),S=i("b6c1"),w=i("d037"),O=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"topsheets-finder curate-content"},e._l(e.topsheets,(function(t){return i("top-sheet",{key:t,attrs:{fileSystemConfig:e.fileSystemConfig,subfolder:e.subfolder,files:e.files,yaml:t}})})),1)},C=[],j=(i("07ac"),i("8a79"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.table.length?i("div",{staticClass:"topsheet curate-content"},[i("h3",{staticClass:"curate-heading"},[e._v(" "+e._s(e.title))]),i("div",{staticClass:"output-table"},e._l(e.entries,(function(t,a){return i("div",{key:"entry"+a,staticClass:"row"},[i("div",{staticClass:"cell top-label",style:t.style},[e._v(e._s(t.title))]),i("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"row.value"}],staticClass:"input is-small cell top-value",style:t.style,domProps:{value:t.value},on:{change:e.boxChanged,input:function(i){i.target.composing||e.$set(t,"value",i.target.value)}}})])})),0),i("div",{staticClass:"output-table",staticStyle:{"margin-top":"1rem"}},e._l(e.table,(function(t,a){return i("div",{key:"row"+a,staticClass:"row"},[i("div",{staticClass:"cell top-label",style:t.style},[e._v(e._s(t.title))]),i("div",{staticClass:"cell top-value",style:t.style},[e._v(e._s(e.formattedValue(t.value)))])])})),0)]):e._e()}),x=[],T=i("363d"),_=T["a"],R=(i("49fc"),i("2877")),M=Object(R["a"])(_,j,x,!1,null,"2b09d6e4",null),A=M.exports,D=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.topsheets=[],e}return Object(l["a"])(i,[{key:"folderUpdated",value:function(){this.topsheets=[]}},{key:"filesUpdated",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.files.length){e.next=6;break}return this.fileSystem=new w["a"](this.fileSystemConfig),e.next=4,this.findTopsheetsForThisFolder();case 4:this.topsheets=e.sent,console.log("TOPSHEETS",this.topsheets);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"mounted",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"findTopsheetsForThisFolder",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,o,l,c,u,h,d,p,m,f;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.findAllTopsheetFolders(),i={},a=Object(r["a"])(t),e.prev=3,a.s();case 5:if((n=a.n()).done){e.next=15;break}return s=n.value,e.next=9,this.fileSystem.getDirectory(s);case 9:o=e.sent,l=o.files,c=Object(r["a"])(l);try{for(c.s();!(u=c.n()).done;)h=u.value,i[h]="".concat(s,"/").concat(h)}catch(v){c.e(v)}finally{c.f()}case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](3),a.e(e.t0);case 20:return e.prev=20,a.f(),e.finish(20);case 23:d=g()(this.files,["topsheet*.y?(a)ml"]),p=Object(r["a"])(d);try{for(p.s();!(m=p.n()).done;)f=m.value,i[f]="".concat(this.subfolder,"/").concat(f)}catch(v){p.e(v)}finally{p.f()}return e.abrupt("return",Object.values(i));case 27:case"end":return e.stop()}}),e,this,[[3,17,20,23]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"findAllTopsheetFolders",value:function(){var e=this,t=localStorage.getItem("RunFinder.foundFolders");if(!t)return[];var i=JSON.parse(t)[this.fileSystemConfig.name].filter((function(e){return e.path.endsWith(".topsheets")})),a=i.map((function(e){return e.path})),n=a.filter((function(t){var i=t.substring(0,t.length-11);return e.subfolder.startsWith(i)}));return n}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],D.prototype,"fileSystemConfig",void 0),Object(h["a"])([Object(d["b"])({required:!0})],D.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!0})],D.prototype,"files",void 0),Object(h["a"])([Object(d["d"])("subfolder")],D.prototype,"folderUpdated",null),Object(h["a"])([Object(d["d"])("files")],D.prototype,"filesUpdated",null),D=Object(h["a"])([Object(d["a"])({components:{TopSheet:A}})],D);var E=D,L=E,F=(i("a270"),i("b998")),P=Object(R["a"])(L,O,C,!1,null,"3ab26fc9",null);"function"===typeof F["default"]&&Object(F["default"])(P);var z=P.exports,I={messages:{en:{Analysis:"Analysis",Files:"Files",Folders:"Folders",Topsheet:"Topsheet"},de:{Analysis:"Ergebnisse",Files:"Dateien",Folders:"Ordner",Topsheet:"Topsheet"}}},N=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.globalState=k["a"].state,e.mdRenderer=new m.a,e.myState={errorStatus:"",folders:[],files:[],isLoading:!1,readme:"",svnProject:null,svnRoot:void 0,subfolder:"",vizes:[],summary:!1},e.summaryYamlFilename="viz-summary.yml",e}return Object(l["a"])(i,[{key:"getFileSystem",value:function(e){var t=k["a"].state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"generateBreadcrumbs",value:function(){if(!this.myState.svnProject)return[];var e,t=[{label:"aftersim",url:"/"},{label:this.myState.svnProject.name,url:"/"+this.myState.svnProject.slug}],i=this.myState.subfolder.split("/"),a="/",n=Object(r["a"])(i);try{for(n.s();!(e=n.n()).done;){var s=e.value;s&&(a+=s+"/",t.push({label:s,url:"/"+this.myState.svnProject.slug+a}))}}catch(o){n.e(o)}finally{n.f()}return k["a"].commit("setBreadCrumbs",t),t}},{key:"mounted",value:function(){this.updateRoute()}},{key:"clickedVisualization",value:function(e){var t=this.myState.vizes[e];if("image-view"!==t.component&&this.myState.svnProject){var i={root:this.myState.svnProject.slug,subfolder:this.myState.subfolder,yamlConfig:t.config,thumbnail:!1};this.$emit("navigate",{component:t.component,props:i})}}},{key:"updateTitle",value:function(e,t){this.myState.vizes[e].title=t}},{key:"swapColors",value:function(){this.fetchFolderContents()}},{key:"updateRoute",value:function(){var e=this.getFileSystem(this.root);this.myState.svnProject=e,this.myState.subfolder=this.xsubfolder||"",this.myState.svnProject&&(this.myState.svnRoot=new w["a"](this.myState.svnProject),this.generateBreadcrumbs(),this.fetchFolderContents())}},{key:"authenticationChanged",value:function(){console.log("AUTH CHANGED - Reload"),this.updateRoute()}},{key:"filesChanged",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.vizes=[],0!==this.myState.files.length){e.next=3;break}return e.abrupt("return");case 3:if(this.showReadme(),this.myState.summary=-1!==this.myState.files.indexOf(this.summaryYamlFilename),!this.myState.summary){e.next=10;break}return e.next=8,this.buildCuratedSummaryView();case 8:e.next=11;break;case 10:this.buildShowEverythingView();case 11:return e.next=13,this.$nextTick();case 13:Object(f["a"])(".medium-zoom",{background:"#444450"});case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showReadme",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t="readme.md",-1!==this.myState.files.indexOf(t)){e.next=5;break}this.myState.readme="",e.next=11;break;case 5:if(this.myState.svnRoot){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.myState.svnRoot.getFileText(this.myState.subfolder+"/"+t);case 9:i=e.sent,this.myState.readme=this.mdRenderer.render(i);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildShowEverythingView",value:function(){var e,t=Object(r["a"])(this.globalState.visualizationTypes.values());try{for(t.s();!(e=t.n()).done;){var i,a=e.value,n=g()(this.myState.files,a.filePatterns),s=Object(r["a"])(n);try{for(s.s();!(i=s.n()).done;){var o=i.value;this.myState.vizes.push({component:a.kebabName,config:o,title:"◆"})}}catch(l){s.e(l)}finally{s.f()}}}catch(l){t.e(l)}finally{t.f()}}},{key:"buildCuratedSummaryView",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,o,l,c,u,h,d,p,m,f,v,b;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return");case 2:return e.t0=y.a,e.next=5,this.myState.svnRoot.getFileText(this.myState.subfolder+"/"+this.summaryYamlFilename);case 5:e.t1=e.sent,t=e.t0.parse.call(e.t0,e.t1),i=Object(r["a"])(t.plugins),e.prev=8,i.s();case 10:if((a=i.n()).done){e.next=43;break}if(n=a.value,s=this.globalState.visualizationTypes.get(n),s){e.next=15;break}return e.abrupt("continue",41);case 15:if(!t[s.kebabName]){e.next=38;break}o=Object(r["a"])(t[s.kebabName]),e.prev=17,o.s();case 19:if((l=o.n()).done){e.next=28;break}return c=l.value,e.next=23,this.findMatchingFiles(c);case 23:u=e.sent,h=Object(r["a"])(u);try{for(h.s();!(d=h.n()).done;)p=d.value,this.myState.vizes.push({component:s.kebabName,config:p,title:p})}catch(k){h.e(k)}finally{h.f()}case 26:e.next=19;break;case 28:e.next=33;break;case 30:e.prev=30,e.t2=e["catch"](17),o.e(e.t2);case 33:return e.prev=33,o.f(),e.finish(33);case 36:e.next=41;break;case 38:m=g()(this.myState.files,s.filePatterns),f=Object(r["a"])(m);try{for(f.s();!(v=f.n()).done;)b=v.value,this.myState.vizes.push({component:s.kebabName,config:b,title:"◆"})}catch(k){f.e(k)}finally{f.f()}case 41:e.next=10;break;case 43:e.next=48;break;case 45:e.prev=45,e.t3=e["catch"](8),i.e(e.t3);case 48:return e.prev=48,i.f(),e.finish(48);case 51:case"end":return e.stop()}}),e,this,[[8,45,48,51],[17,30,33,36]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"findMatchingFiles",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.myState.files.indexOf(t)>-1)){e.next=2;break}return e.abrupt("return",[t]);case 2:if(i=g()(this.myState.files,t),!i.length){e.next=5;break}return e.abrupt("return",i);case 5:if(this.myState.svnRoot){e.next=7;break}return e.abrupt("return",[]);case 7:return e.prev=7,a=t.split("/"),n=this.myState.subfolder+"/"+a[0],console.log(n),e.next=13,this.myState.svnRoot.getDirectory(n);case 13:return s=e.sent,r=g()(s.files,a[1]),e.abrupt("return",r.map((function(e){return a[0]+"/"+e})));case 18:e.prev=18,e.t0=e["catch"](7);case 20:return e.abrupt("return",[]);case 21:case"end":return e.stop()}}),e,this,[[7,18]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"fetchFolderContents",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.svnRoot){e.next=2;break}return e.abrupt("return",[]);case 2:return this.myState.isLoading=!0,this.myState.errorStatus="",this.myState.files=[],e.prev=5,e.next=8,this.myState.svnRoot.getDirectory(this.myState.subfolder);case 8:t=e.sent,i=t.dirs.filter((function(e){return!e.startsWith(".")})).sort(),a=t.files.filter((function(e){return!e.startsWith(".")})).sort(),this.myState.errorStatus="",this.myState.folders=i,this.myState.files=a,e.next=32;break;case 16:e.prev=16,e.t0=e["catch"](5),console.log("BAD PAGE"),console.log({eeee:e.t0}),this.myState.folders=[],this.myState.files=[],this.myState.errorStatus="<h3>",e.t0.status&&(this.myState.errorStatus+="".concat(e.t0.status," ")),e.t0.statusText&&(this.myState.errorStatus+="".concat(e.t0.statusText)),"<h3>"===this.myState.errorStatus&&(this.myState.errorStatus+="Error"),this.myState.errorStatus+="</h3>",e.t0.url&&(this.myState.errorStatus+="<p>".concat(e.t0.url,"</p>")),e.t0.message&&(this.myState.errorStatus+="<p>".concat(e.t0.message,"</p>")),"<h3>Error</h3>"===this.myState.errorStatus&&(this.myState.errorStatus=""+e.t0),this.myState.svnProject&&(this.myState.errorStatus+="<p><i>".concat(this.myState.svnProject.baseURL).concat(this.myState.subfolder,"</i></p>")),this.myState.svnProject&&this.myState.svnProject.needPassword&&401===e.t0.status&&k["a"].commit("requestLogin",this.myState.svnProject.slug);case 32:return e.prev=32,this.myState.isLoading=!1,e.finish(32);case 35:case"end":return e.stop()}}),e,this,[[5,16,32,35]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"openOutputFolder",value:function(e){if(!this.myState.isLoading&&this.myState.svnProject){var t=".."===e?this.myState.subfolder.substring(0,this.myState.subfolder.lastIndexOf("/")):this.myState.subfolder+"/"+e,i={root:this.myState.svnProject.slug,xsubfolder:t};this.$emit("navigate",{component:"FolderBrowser",props:i})}}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!1})],N.prototype,"xsubfolder",void 0),Object(h["a"])([Object(d["b"])({required:!0})],N.prototype,"root",void 0),Object(h["a"])([Object(d["d"])("globalState.colorScheme")],N.prototype,"swapColors",null),Object(h["a"])([Object(d["d"])("xsubfolder")],N.prototype,"updateRoute",null),Object(h["a"])([Object(d["d"])("globalState.authAttempts")],N.prototype,"authenticationChanged",null),Object(h["a"])([Object(d["d"])("myState.files")],N.prototype,"filesChanged",null),N=Object(h["a"])([Object(d["a"])({components:Object.assign({TopsheetsFinder:z},S["a"]),props:{},i18n:I})],N);var H=N,B=H,V=(i("b176"),Object(R["a"])(B,a,n,!1,null,"78fc3649",null));t["a"]=V.exports},a722:function(e,t,i){"use strict";i("11f4")},a78e:function(e,t,i){"use strict";i("65c1")},a7f5:function(e,t,i){e.exports=i.p+"img/matsim-logo-blue.33e6b1c3.png"},a98e:function(e,t,i){},a998:function(e,t,i){"use strict";i("15f6")},ab71:function(e,t,i){"use strict";var a=i("d352"),n=i.n(a);t["default"]=n.a},ac68:function(e,t,i){e.exports=i.p+"js/0.aa11c5a8.worker.js"},acace:function(e,t,i){"use strict";i("ef1a")},acee:function(e,t,i){"use strict";(function(e){var a=i("1da1"),n=i("b85c"),s=i("3835"),r=i("d4ec"),o=i("bee2"),l=i("262e"),c=i("2caf"),u=(i("96cf"),i("ace4"),i("d3b7"),i("cfc3"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("ac1f"),i("1276"),i("99af"),i("4de4"),i("4d63"),i("25f0"),i("07ac"),i("d81d"),i("b64b"),i("13d5"),i("9ab4")),h=i("60a3"),d=i("4971"),p=i.n(d),m=i("f206"),f=i("8f3c"),v=i.n(f),g=i("f2ec"),b=i("731b"),y=i("25f1"),k=i("beea"),S=i("3a0b"),w=i("dc81"),O=i("7339"),C=i("10a0"),j=i("4a60"),x=i("d037"),T=function(t){Object(l["a"])(u,t);var i=Object(c["a"])(u);function u(){var e;return Object(r["a"])(this,u),e=i.apply(this,arguments),e.radius=250,e.maxHeight=100,e.extrudeTowers=!1,e.colorRamps=["bathymetry","par","chlorophyll","magma"],e.buttonColors=["#5E8AAE","#BF7230","#269367","#9C439C"],e.colorRamp=e.colorRamps[0],e.globalState=S["a"].state,e.vizDetails={title:"",description:"",file:"",projection:"",thumbnail:"",aggregations:{}},e.myState={statusMessage:"",fileApi:void 0,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.rowCache={},e.requests={raw:new Float32Array(0),length:0},e.highlightedTrips=[],e.searchTerm="",e.searchEnabled=!1,e.isLoaded=!1,e.activeAggregation="",e.isHighlightingZone=!1,e.multiSelectedHexagons={},e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.hexStats=null,e.aggregations={},e.columnLookup=[],e}return Object(o["a"])(u,[{key:"buttonLabel",get:function(){var e=this.activeAggregation.split("~"),t=Object(s["a"])(e,2),i=t[0],a=t[1];return this.aggregations[i][a].title}},{key:"mapProps",get:function(){return{colorRamp:this.colorRamp,coverage:.65,dark:this.$store.state.isDarkMode,data:this.requests,extrude:this.extrudeTowers,highlights:this.highlightedTrips,maxHeight:this.maxHeight,metric:this.buttonLabel,radius:this.radius,upperPercentile:100,selectedHexStats:this.hexStats}}},{key:"handleEmptyClick",value:function(){this.flipViewToShowInvertedData({})}},{key:"handleHexClick",value:function(e,t){var i;if(!t.srcEvent.shiftKey)return this.multiSelectedHexagons={},this.hexStats=null,void this.flipViewToShowInvertedData(e);var a=null===e||void 0===e||null===(i=e.object)||void 0===i?void 0:i.index;void 0!==a&&(a in this.multiSelectedHexagons?delete this.multiSelectedHexagons[a]:this.multiSelectedHexagons[a]=e.object.points,this.hexStats=this.selectedHexagonStatistics())}},{key:"flipViewToShowInvertedData",value:function(e){this.isHighlightingZone?this.isHighlightingZone=!1:e.object?this.isHighlightingZone=!0:this.isHighlightingZone=!1;var t=this.activeAggregation.split("~"),i=0,a=0;if(this.isHighlightingZone){i=parseInt(t[1]),a=i%2?i-1:i+1;var s,r="".concat(t[0]).concat(i),o=this.rowCache[r],l="".concat(t[0]).concat(a),c=this.rowCache[l],u=[],h=Object(n["a"])(e.object.points);try{for(h.s();!(s=h.n()).done;){var d=s.value,p=2*d.index,m=[c.raw[p],c.raw[p+1]];u.push([[o.raw[p],o.raw[p+1]],m]),this.highlightedTrips=u}}catch(f){h.e(f)}finally{h.f()}this.hexStats&&(this.hexStats.selectedHexagonIds=[]),this.multiSelectedHexagons={},this.colorRamp=this.colorRamps[a]}else this.hexStats=null,this.multiSelectedHexagons={},this.handleOrigDest(t[0],parseInt(t[1]));this.isHighlightingZone||(this.highlightedTrips=[])}},{key:"handleOrigDest",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,i){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=t+i,this.hexStats=null,this.multiSelectedHexagons={},this.highlightedTrips=[],this.activeAggregation="".concat(t,"~").concat(i),this.requests=this.rowCache[a],this.colorRamp=this.colorRamps[i];case 7:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"buildFileApi",value:function(){var e=this.getFileSystem(this.root);this.myState.fileApi=new x["a"](e),this.myState.fileSystem=e}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"getFileSystem",value:function(e){var t=this.$store.state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return");case 2:if(t=new RegExp(".*(yml|yaml)$").test(this.myState.yamlConfig),t){e.next=7;break}return this.vizDetails={title:"Output Trips",description:this.myState.yamlConfig,file:this.myState.yamlConfig,projection:"EPSG:31468",aggregations:{"Trip Summary":[{title:"Origins",x:"start_x",y:"start_y"},{title:"Destinations",x:"end_x",y:"end_y"}]}},this.$emit("title",this.vizDetails.title),e.abrupt("return");case 7:return e.prev=7,e.next=10,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 10:i=e.sent,this.vizDetails=v.a.parse(i),e.next=18;break;case 14:e.prev=14,e.t0=e["catch"](7),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.needPassword&&401===e.t0.status?this.$store.commit("requestLogin",this.myState.fileSystem.slug):this.$store.commit("setStatus",{type:C["g"].WARNING,msg:"Could not find: ".concat(this.myState.subfolder,"/").concat(this.myState.yamlConfig)});case 18:a=this.vizDetails.title?this.vizDetails.title:"Hex Aggregation",this.$emit("title",a);case 20:case"end":return e.stop()}}),e,this,[[7,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return");case 2:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=17;break}return e.prev=3,e.next=6,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 6:return t=e.sent,e.next=9,t.arrayBuffer();case 9:i=e.sent,a=k["a"].arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](3),console.error(e.t0);case 17:case"end":return e.stop()}}),e,this,[[3,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.$store.state.colorScheme===C["a"].DarkMode?t:e}},{key:"handleShowSelectionButton",value:function(){var e=Object.values(this.multiSelectedHexagons),t=[];e.map((function(e){return t=t.concat(e)}));var i={object:{points:t}};this.flipViewToShowInvertedData(i)}},{key:"selectedHexagonStatistics",value:function(){var e=Object.keys(this.multiSelectedHexagons).map((function(e){return parseInt(e)}));if(!e.length)return null;var t=Object.values(this.multiSelectedHexagons),i=t.reduce((function(e,t){return e+t.length}),0);return{rows:i,numHexagons:e.length,selectedHexagonIds:e}}},{key:"jumpToCenter",value:function(){if(this.$store.state.viewState.initial){var e=0,t=0;try{for(var i=Object.values(this.rowCache)[0].raw,a=0,n=0;n<i.length;n+=1024){var s=i[n],r=i[n+1];s&&r&&(a++,e+=s,t+=r)}e/=a,t/=a}catch(c){console.warn(c)}if(e&&t){var o=this.$store.state.viewState,l={jump:!0,longitude:e,latitude:t,bearing:o.bearing,pitch:o.pitch,zoom:o.zoom};this.$store.commit("setMapCamera",l)}}}},{key:"mounted",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$store.commit("setFullScreen",!this.thumbnail),this.buildFileApi(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.myState.statusMessage="".concat(this.$i18n.t("loading")),this.aggregations=this.vizDetails.aggregations,e.next=10,this.loadFiles();case 10:this.buildThumbnail(),this.isLoaded=!0,this.handleOrigDest(Object.keys(this.aggregations)[0],0);case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){try{this.gzipParser&&g["a"].terminate(this.gzipParser)}catch(e){console.warn(e)}this.$store.commit("setFullScreen",!1)}},{key:"parseCSVFile",value:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(i){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.myState.fileSystem){t.next=2;break}return t.abrupt("return");case 2:return this.myState.statusMessage="Loading file...",t.next=5,Object(b["a"])(new y["a"](e));case 5:return this.gzipParser=t.sent,n=this,t.next=9,this.gzipParser.startLoading(i,this.myState.fileSystem,this.vizDetails.aggregations,this.vizDetails.projection).subscribe({next:function(e){n.myState.statusMessage=e},complete:function(){return Object(a["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.gzipParser.results();case 2:t=e.sent,i=t.rowCache,a=t.columnLookup,g["a"].terminate(n.gzipParser),n.dataIsLoaded({rowCache:i,columnLookup:a});case 7:case"end":return e.stop()}}),e)})))()},error:function(){console.log("GOT YOU!")}});case 9:case"end":return t.stop()}}),t,this)})));function i(e){return t.apply(this,arguments)}return i}()},{key:"dataIsLoaded",value:function(e){var t=e.rowCache,i=e.columnLookup;this.columnLookup=i,this.rowCache=t,this.requests=t[this.activeAggregation.replaceAll("~","")],this.jumpToCenter(),this.myState.statusMessage=""}},{key:"loadFiles",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=[],this.myState.fileApi){e.next=3;break}return e.abrupt("return",{dataArray:t});case 3:return e.prev=3,i="".concat(this.myState.subfolder,"/").concat(this.vizDetails.file),e.next=7,this.parseCSVFile(i);case 7:e.next=14;break;case 9:e.prev=9,e.t0=e["catch"](3),console.error(e.t0),this.myState.statusMessage=""+e.t0,this.$store.commit("setStatus",{type:C["g"].WARNING,msg:"Error loading/parsing: ".concat(this.myState.subfolder,"/").concat(this.vizDetails.file)});case 14:case"end":return e.stop()}}),e,this,[[3,9]])})));function t(){return e.apply(this,arguments)}return t}()}]),u}(h["c"]);Object(u["a"])([Object(h["b"])({required:!0})],T.prototype,"root",void 0),Object(u["a"])([Object(h["b"])({required:!0})],T.prototype,"subfolder",void 0),Object(u["a"])([Object(h["b"])({required:!1})],T.prototype,"yamlConfig",void 0),Object(u["a"])([Object(h["b"])({required:!1})],T.prototype,"thumbnail",void 0),T=Object(u["a"])([Object(h["a"])({components:{CollapsiblePanel:w["a"],DrawingTool:O["a"],XyHexDeckMap:j["a"],VueSlider:p.a,ToggleButton:m["ToggleButton"]}})],T),S["a"].commit("registerPlugin",{kebabName:"xy-hexagons",prettyName:"XY Aggregator",description:"Collects XY data into geographic hexagons",filePatterns:["viz-xy*.y?(a)ml","*output_trips.csv?(.gz)"],component:T}),t["a"]=T}).call(this,i("ac68"))},b176:function(e,t,i){"use strict";i("86b8")},b2c7:function(e,t,i){},b6c1:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"carrier-viewer",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[e.thumbnail?e._e():i("div",{staticClass:"nav"},[e.myState.statusMessage?i("p",{staticClass:"big time"},[e._v(e._s(e.myState.statusMessage))]):e._e()]),e.thumbnail?e._e():i("tour-viz",{staticClass:"anim",attrs:{shipments:e.shownShipments,shownRoutes:e.shownRoutes,stopMidpoints:e.stopMidpoints,paths:[],drtRequests:[],traces:[],colors:e.COLOR_OCCUPANCY,settingsShowLayers:e.SETTINGS,center:e.vizDetails.center,searchEnabled:e.searchEnabled,vehicleLookup:e.vehicleLookup,onClick:e.handleClick}}),e.detailContent?i("collapsible-panel",{staticClass:"left-side",attrs:{darkMode:!0,direction:"left",width:"300"}},[i("h3",[e._v("Raw Details")]),i("div",{staticClass:"panel-items"},[i("div",{staticClass:"detail-list"},[i("pre",{staticStyle:{color:"#ccc","padding-right":"2rem"}},[e._v(e._s(e.detailContent))])])])]):e._e(),e.isLoaded&&!e.thumbnail?i("collapsible-panel",{staticClass:"right-side",attrs:{darkMode:!0,width:"250",direction:"right"}},[i("div",{staticClass:"panel-items"},[e.carriers.length?i("h3",[e._v(e._s(e.$t("carriers")))]):e._e(),i("div",{staticClass:"carrier-list"},e._l(e.carriers,(function(t){return i("div",{key:t.$.id,staticClass:"carrier",class:{selected:t.$.id==e.selectedCarrier}},[i("div",{staticClass:"carrier-title",on:{click:function(i){return e.handleSelectCarrier(t)}}},[i("i",{staticClass:"far",class:t.$.id==e.selectedCarrier?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(e._s(t.$.id))])]),t.$.id==e.selectedCarrier?i("div",{staticClass:"carrier-details"},[e.tours.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleTours=!e.toggleTours}}},[i("i",{staticClass:"far",class:e.toggleTours?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(e._s(e.$t("tours"))+": "+e._s(e.tours.length))])]),e._l(e.toggleTours?e.tours:[],(function(t,a){return i("div",{key:a,staticClass:"leaf tour",class:{selected:t==e.selectedTour},on:{click:function(i){return e.handleSelectTour(t)}}},[e._v(e._s(""+t.vehicleId))])}))],2):e._e(),e.vehicles.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleVehicles=!e.toggleVehicles}}},[i("i",{staticClass:"far",class:e.toggleVehicles?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("vehicles"))+": "+e._s(e.vehicles.length))])]),e._l(e.toggleVehicles?e.vehicles:[],(function(t){return i("div",{key:t,staticClass:"leaf tour"},[e._v(e._s(t))])}))],2):e._e(),e.shipments.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleShipments=!e.toggleShipments}}},[i("i",{staticClass:"far",class:e.toggleShipments?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("shipments"))+": "+e._s(e.shipments.length))])]),e._l(e.toggleShipments?e.shipments:[],(function(t){return i("div",{key:t.id,staticClass:"leaf tour",class:{selected:t==e.selectedShipment,"shipment-in-tour":e.shipmentIdsInTour.includes(t.id)},on:{click:function(i){return e.handleSelectShipment(t)}}},[e._v(e._s(t.id+": "+t.from+"-"+t.to))])}))],2):e._e(),e.services.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleServices=!e.toggleServices}}},[i("i",{staticClass:"far",class:e.toggleServices?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("services"))+": "+e._s(e.services.length))])]),e._l(e.toggleServices?e.services:[],(function(t){return i("div",{key:t.id,staticClass:"leaf tour"},[e._v(e._s(""+t.id))])}))],2):e._e()]):e._e()])})),0)])]):e._e()],1)},n=[],s=i("b85c"),r=i("1da1"),o=i("d4ec"),l=i("bee2"),c=i("262e"),u=i("2caf"),h=(i("96cf"),i("d81d"),i("b64b"),i("4de4"),i("fb6a"),i("d3b7"),i("7db0"),i("9911"),i("99af"),i("ac1f"),i("1276"),i("ace4"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("8a79"),i("9ab4")),d=i("60a3"),p=i("4971"),m=i.n(p),f=i("f206"),v=i("89ab"),g=i.n(v),b=i("8f3c"),y=i.n(b),k=i("e975"),S=i.n(k),w=i("595c"),O=i.n(w),C=i("083c"),j=i.n(C),x=i("faeb"),T=i.n(x),_=i("b562"),R=i("f908"),M=i("3a0b"),A=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.isLoaded&&!e.thumbnail?i("collapsible-panel",{staticClass:"right-side",attrs:{darkMode:!0,width:"250",direction:"right"}},[i("div",{staticClass:"panel-items"},[e.carriers.length?i("h3",[e._v(e._s(e.$t("carriers")))]):e._e(),i("div",{staticClass:"carrier-list"},e._l(e.carriers,(function(t){return i("div",{key:t.$.id,staticClass:"carrier",class:{selected:t.$.id==e.selectedCarrier}},[i("div",{staticClass:"carrier-title",on:{click:function(i){return e.handleSelectCarrier(t)}}},[i("i",{staticClass:"far",class:t.$.id==e.selectedCarrier?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(e._s(t.$.id))])]),t.$.id==e.selectedCarrier?i("div",{staticClass:"carrier-details"},[e.tours.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleTours=!e.toggleTours}}},[i("i",{staticClass:"far",class:e.toggleTours?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(e._s(e.$t("tours"))+": "+e._s(e.tours.length))])]),e._l(e.toggleTours?e.tours:[],(function(t,a){return i("div",{key:a,staticClass:"leaf tour",class:{selected:t==e.selectedTour},on:{click:function(i){return e.handleSelectTour(t)}}},[e._v(e._s(""+t.id))])}))],2):e._e(),e.vehicles.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleVehicles=!e.toggleVehicles}}},[i("i",{staticClass:"far",class:e.toggleVehicles?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("vehicles"))+": "+e._s(e.vehicles.length))])]),e._l(e.toggleVehicles?e.vehicles:[],(function(t){return i("div",{key:t,staticClass:"leaf tour"},[e._v(e._s(t))])}))],2):e._e(),e.shipments.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleShipments=!e.toggleShipments}}},[i("i",{staticClass:"far",class:e.toggleShipments?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("shipments"))+": "+e._s(e.shipments.length))])]),e._l(e.toggleShipments?e.shipments:[],(function(t){return i("div",{key:t.id,staticClass:"leaf tour",class:{selected:t==e.selectedShipment,"shipment-in-tour":e.shipmentIdsInTour.includes(t.id)},on:{click:function(i){return e.handleSelectShipment(t)}}},[e._v(e._s(t.id+": "+t.from+"-"+t.to))])}))],2):e._e(),e.services.length?i("div",{staticClass:"carrier-section"},[i("div",{staticClass:"carrier-title",on:{click:function(t){e.toggleServices=!e.toggleServices}}},[i("i",{staticClass:"far",class:e.toggleServices?"fa-minus-square":"fa-plus-square"}),i("span",[e._v(" "+e._s(e.$t("services"))+": "+e._s(e.services.length))])]),e._l(e.toggleServices?e.services:[],(function(t){return i("div",{key:t.id,staticClass:"leaf tour"},[e._v(e._s(""+t.id))])}))],2):e._e()]):e._e()])})),0)])]):e._e()},D=[],E=i("dc81"),L=(i("a4d3"),i("e01a"),i("ab5b")),F=i.n(L);function P(e){var t=e.items.map((function(e){return F.a.createElement("li",{key:e.value+e.value[0]},F.a.createElement("div",{style:{width:"100%",height:"".concat(Math.max(1,3*(1*e.value-1)+3),"px"),backgroundColor:"rgb(".concat(e.color,")")}}),e.label&&F.a.createElement("div",{style:{marginBottom:"0.5rem"}},e.label))}));return F.a.createElement("div",null,F.a.createElement("h4",{style:{textAlign:"left",fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.8rem"}},e.title),F.a.createElement("p",null,e.description),F.a.createElement("ul",{style:{listStyle:"none",padding:0,margin:0}},t))}var z=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"vue-component"}},[i("vue-slider",e._b({staticClass:"slider",on:{dragging:e.dragging,"drag-start":e.dragStart,"drag-end":e.dragEnd},model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.sliderOptions,!1)),i("div",{staticClass:"buttons"},[i("div",{staticClass:"playpause",on:{click:e.toggleSimulation}},[e.isRunning?i("i",{staticClass:"button-icon fa fa-1x fa-pause"}):i("i",{staticClass:"button-icon fa fa-1x fa-play"})])])],1)},I=[],N=i("3c87"),H=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.sliderValue=0,e.sliderOptions={min:0,max:1e6,clickable:!1,dotSize:30,duration:0,lazy:!0,tooltip:"active","tooltip-placement":"top","tooltip-formatter":function(t){return e.convertSecondsToClockTimeMinutes(t)}},e.pauseWhileDragging=!1,e}return Object(l["a"])(i,[{key:"toggleSimulation",value:function(){this.$emit("click")}},{key:"convertSecondsToClockTimeMinutes",value:function(e){var t=this.getSecondsFromSlider(e);try{var i=N(t),a=("00"+i.minutes).slice(-2);return"".concat(i.hours,":").concat(a)}catch(n){return"00:00"}}},{key:"dragStart",value:function(){this.isRunning&&(this.pauseWhileDragging=!0,this.$emit("click"))}},{key:"dragEnd",value:function(){this.pauseWhileDragging&&this.$emit("click"),this.pauseWhileDragging=!1}},{key:"dragging",value:function(e){this.$emit("time",this.getSecondsFromSlider(e))}},{key:"onKeyPressed",value:function(e){"Space"===e.code&&this.toggleSimulation()}},{key:"getSecondsFromSlider",value:function(e){var t=(this.timeEnd-this.timeStart)*e/1e6;return t===this.timeEnd&&(t=this.timeEnd-1),t}},{key:"handleTimeChanged",value:function(){this.sliderValue=1e6*(this.currentTime-this.timeStart)/(this.timeEnd-this.timeStart)}},{key:"mounted",value:function(){window.addEventListener("keyup",this.onKeyPressed)}},{key:"beforeDestroy",value:function(){window.removeEventListener("keyup",this.onKeyPressed)}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],H.prototype,"isRunning",void 0),Object(h["a"])([Object(d["b"])({required:!0})],H.prototype,"timeStart",void 0),Object(h["a"])([Object(d["b"])({required:!0})],H.prototype,"timeEnd",void 0),Object(h["a"])([Object(d["b"])({required:!0})],H.prototype,"currentTime",void 0),Object(h["a"])([Object(d["d"])("currentTime")],H.prototype,"handleTimeChanged",null),H=Object(h["a"])([Object(d["a"])({components:{VueSlider:m.a},props:{}})],H);var B=H,V=B,U=(i("6033"),i("2877")),q=Object(U["a"])(V,z,I,!1,null,"0661f5b0",null),W=q.exports,$=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"settings-panel-content"},[i("h4",[e._v("Ein-/Ausblenden")]),e._l(Object.keys(e.items),(function(t){return i("div",{key:t,staticClass:"row"},[i("toggle-button",{staticClass:"toggle",attrs:{width:40,value:e.items[t],labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(i){return e.$emit("click",t)}}}),i("label",[e._v(e._s(t))])],1)}))],2)},G=[],Y=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){return Object(o["a"])(this,i),t.apply(this,arguments)}return i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],Y.prototype,"items",void 0),Y=Object(h["a"])([Object(d["a"])({components:{ToggleButton:f["ToggleButton"]}})],Y);var X=Y,Z=X,K=(i("08a6"),Object(U["a"])(Z,$,G,!1,null,"35849012",null)),J=K.exports,Q=i("10a0");S.a.insensitive=!0;var ee=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.colorScheme=Q["a"].DarkMode,e.searchTerm="",e.searchEnabled=!1,e.globalState=M["a"].state,e.isDarkMode=e.colorScheme===Q["a"].DarkMode,e.isLoaded=!0,e.showHelp=!1,e.speed=1,e.legendBits=[],e.links={},e.toggleTours=!0,e.toggleVehicles=!0,e.toggleShipments=!0,e.toggleServices=!0,e.carriers=[],e.vehicles=[],e.shipments=[],e.services=[],e.stopMidpoints=[],e.tours=[],e.shownRoutes=[],e.shownShipments=[],e.shipmentIdsInTour=[],e.selectedCarrier="",e.selectedTour=null,e.selectedShipment=null,e.currentlyAnimating={},e.vehicleLookup=[],e.vehicleLookupString={},e}return Object(l["a"])(i,[{key:"handleSelectShipment",value:function(e){if(console.log({shipment:e}),this.selectedShipment===e)return this.selectedShipment=null,void(this.shownShipments=[]);this.shownShipments=this.shipments.filter((function(t){return t.id===e.id})),this.selectedShipment=e}},{key:"handleSelectTour",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,o,l,c,u,h,d,p,m,f,v,g,b,y,k=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log({tour:t}),this.currentlyAnimating=t,this.shownRoutes=[],this.shownShipments=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopMidpoints=[],this.selectedTour!==t){e.next=10;break}return this.selectedTour=null,e.abrupt("return");case 10:this.selectedTour=t,i=[],a=[],n=0,r=Object(s["a"])(t.plan),e.prev=15,l=function(){var e=o.value;if(e.shipmentId){i.push(e.shipmentId);var t=k.shipments.find((function(t){return t.id===e.shipmentId})),s="pickup"===e.type?t.from:t.to;if(a.length&&a[a.length-1].link===s)return"continue";var r=[k.links[s][0],k.links[s][1]],l=[k.links[s][2],k.links[s][3]],c=[.5*(k.links[s][0]+k.links[s][2]),.5*(k.links[s][1]+k.links[s][3])],u=Object.assign({},t);delete u.from,delete u.fromX,delete u.fromY,delete u.to,delete u.toX,delete u.toY,delete u.id,a.push({id:t.id,count:n++,link:s,midpoint:c,label:"",details:u,ptFrom:r,ptTo:l})}},r.s();case 18:if((o=r.n()).done){e.next=24;break}if(c=l(),"continue"!==c){e.next=22;break}return e.abrupt("continue",22);case 22:e.next=18;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e["catch"](15),r.e(e.t0);case 29:return e.prev=29,r.f(),e.finish(29);case 32:for(u=0;u<a.length;u++){for(h="",d=0;d<u;d++)a[u].midpoint[0]===a[d].midpoint[0]&&a[u].midpoint[1]===a[d].midpoint[1]&&(h+=",".concat(d),",0"===h&&(h=",*"),a[u].label="");h+=",".concat(u),h=h.slice(1),"0"===h&&(h="*"),a[u].label=h}this.shipmentIdsInTour=i,p=O()({colormap:"summer",nshades:Math.max(9,t.routes.length),format:"rba"}).map((function(e){return e.slice(0,3)})),m=0,f=function(e){return new Promise((function(t){return setTimeout(t,e)}))},v=t.routes.length>20?25:50,g=Object(s["a"])(t.routes),e.prev=39,g.s();case 41:if((b=g.n()).done){e.next=49;break}return y=b.value,this.addRouteToMap(t,y,a,p,m),m++,e.next=47,f(v);case 47:e.next=41;break;case 49:e.next=54;break;case 51:e.prev=51,e.t1=e["catch"](39),g.e(e.t1);case 54:return e.prev=54,g.f(),e.finish(54);case 57:this.stopMidpoints=a;case 58:case"end":return e.stop()}}),e,this,[[15,26,29,32],[39,51,54,57]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addRouteToMap",value:function(e,t,i,a,n){if(this.currentlyAnimating===e){var r,o=[[this.links[t[0]][0],this.links[t[0]][1]]],l=Object(s["a"])(t);try{for(l.s();!(r=l.n()).done;){var c=r.value,u=[this.links[c][0],this.links[c][1]];u[0]===o[o.length-1][0]&&u[1]===o[o.length-1][1]||o.push(u),o.push([this.links[c][2],this.links[c][3]])}}catch(h){l.e(h)}finally{l.f()}this.shownRoutes=this.shownRoutes.concat([{count:n,points:o,color:a[n]}]),this.stopMidpoints=i.slice(0,n)}}},{key:"handleSelectCarrier",value:function(e){var t,i,a;console.log("carrier",e),this.currentlyAnimating=null;e.$.id;this.vehicles=[],this.shipments=[],this.services=[],this.tours=[],this.shownRoutes=[],this.shownShipments=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopMidpoints=[],this.selectedCarrier!==e.$.id?(this.selectedCarrier=e.$.id,null!==(t=e.capabilities[0])&&void 0!==t&&null!==(i=t.vehicles[0])&&void 0!==i&&i.vehicle&&(this.vehicles=e.capabilities[0].vehicles[0].vehicle.map((function(e){return e.$.id})).sort((function(e,t){return S()(e,t)}))),this.shipments=this.processShipments(e),null!==(a=e.services[0])&&void 0!==a&&a.service&&(this.services=e.services[0].service.map((function(e){return e.$})).sort((function(e,t){return S()(e.$.id,t.$.id)}))),this.tours=this.processTours(e)):this.selectedCarrier=""}},{key:"processTours",value:function(e){var t;if(null===(t=e.plan[0])||void 0===t||!t.tour)return[];var i=e.plan[0].tour.map((function(e){var t=e.$$.map((function(e){return Object.assign(e.$,{$:e["#name"],route:e.route})})),i=t.filter((function(e){return"leg"===e.$&&e.route[0].length})).map((function(e){return e.route[0].split(" ")}));return{id:e.$.vehicleId,plan:t,routes:i}}));return i.sort((function(e,t){return S()(e.id,t.id)})),i}},{key:"processShipments",value:function(e){var t;if(!e.shipments)return[];var i=[];null!==(t=e.shipments[0])&&void 0!==t&&t.shipment&&(i=e.shipments[0].shipment.map((function(e){return e.$})).sort((function(e,t){return S()(e.id,t.id)})));try{var a,n=Object(s["a"])(i);try{for(n.s();!(a=n.n()).done;){var r=a.value;r.fromX=.5*(this.links[r.from][0]+this.links[r.from][2]),r.fromY=.5*(this.links[r.from][1]+this.links[r.from][3]),r.toX=.5*(this.links[r.to][0]+this.links[r.to][2]),r.toY=.5*(this.links[r.to][1]+this.links[r.to][3])}}catch(o){n.e(o)}finally{n.f()}}catch(l){}return i}},{key:"swapTheme",value:function(){this.isDarkMode=this.colorScheme===Q["a"].DarkMode}},{key:"handleClick",value:function(e){if(null!==e){var t=this.vehicleLookup[e];console.log(t),this.searchTerm===t?this.searchTerm="":this.searchTerm=t}else this.searchTerm=""}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.colorScheme===Q["a"].DarkMode?t:e}},{key:"mounted",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()}]),i}(d["c"]);Object(h["a"])([Object(d["d"])("globalState.colorScheme")],ee.prototype,"swapTheme",null),ee=Object(h["a"])([Object(d["a"])({components:{CollapsiblePanel:E["a"],LegendColors:P,PlaybackControls:W,SettingsPanel:J,ToggleButton:f["ToggleButton"],VueSlider:m.a}})],ee);var te=ee,ie=te,ae=(i("c4c6"),i("ab71")),ne=Object(U["a"])(ie,A,D,!1,null,"505e9f0c",null);"function"===typeof ae["default"]&&Object(ae["default"])(ne);var se,re=ne.exports,oe=(i("4ec9"),i("3ca3"),i("ddb0"),i("fb2c"),i("13d5"),i("25f0"),"initialize"),le="error",ce="result",ue=(self,function(){function e(t){var i=this;Object(o["a"])(this,e),this.promises=new Map,this.worker=t,this.handleMessageDelegate=function(e){return i.handleWorkerMessage(e)},this.worker.addEventListener("message",this.handleMessageDelegate)}return Object(l["a"])(e,[{key:"destroy",value:function(){this.worker&&(this.worker.removeEventListener("message",this.handleMessageDelegate),this.worker.terminate())}},{key:"postAsyncWorkerMessage",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,i,a){var n,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={call:{method:t,parameters:i},id:this.generatePromiseId()},a?this.worker.postMessage(n,a):this.worker.postMessage(n,[]),e.abrupt("return",new Promise((function(e,t){s.promises.set(n.id,{resolve:e,reject:t})})));case 3:case"end":return e.stop()}}),e,this)})));function t(t,i,a){return e.apply(this,arguments)}return t}()},{key:"handleWorkerMessage",value:function(e){Date.now();var t=e.data;switch(t.type){case le:this.handleError(t);break;case ce:this.handleEvent(t);break;default:console.error("unknown message type: "+t.type)}}},{key:"handleError",value:function(e){console.error("Error in Worker: "+e.error),this.promises.has(e.id)&&(this.promises.get(e.id).reject(e.error),this.promises.delete(e.id))}},{key:"handleEvent",value:function(e){this.promises.has(e.id)&&(this.promises.get(e.id).resolve(e.result),this.promises.delete(e.id))}},{key:"generatePromiseId",value:function(){var e=new Uint32Array(8);return crypto.getRandomValues(e),e.reduce((function(e,t){return e+("0"+t.toString(16)).slice(-2)}),"")}}]),e}());function he(){return new Worker(i.p+"js/NetworkHelper.worker.7edde184.worker.js")}(function(e){e["CreateNodesAndLinks"]="CreateNodesAndLinks",e["ConvertCoordinates"]="ConvertCoordinates",e["ProcessTransit"]="ProcessTransit"})(se||(se={}));var de=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){return Object(o["a"])(this,i),t.call(this,new he)}return Object(l["a"])(i,[{key:"createNodesAndLinks",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(se.CreateNodesAndLinks,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"convertCoordinates",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(se.ConvertCoordinates,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processTransit",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(se.ProcessTransit,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initialize",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postAsyncWorkerMessage(oe,t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"create",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new i,e.next=3,a.initialize(t);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(ue),pe=i("3835"),me=i("50fd"),fe=i("ee06"),ve=i("2a18"),ge=i("f2b6"),be=i("c98a"),ye=i("72db"),ke=i("9043"),Se=i("3cd3"),we=i("60a4"),Oe=i("5530"),Ce=i("45eb"),je=i("7e84"),xe=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){return Object(o["a"])(this,i),t.apply(this,arguments)}return Object(l["a"])(i,[{key:"initializeState",value:function(e){Object(Ce["a"])(Object(je["a"])(i.prototype),"initializeState",this).call(this,e),this.getAttributeManager().addInstanced({instanceOffset:{size:1,accessor:"getOffset"}})}},{key:"getShaders",value:function(){return Object(Oe["a"])(Object(Oe["a"])({},Object(Ce["a"])(Object(je["a"])(i.prototype),"getShaders",this).call(this)),{},{inject:{"vs:#decl":"\n            attribute float instanceOffset;\n            varying float offset;\n            ","vs:#main-start":"\n            offset = instanceOffset;\n            ","fs:#decl":"\n            varying float offset;\n            ","fs:#main-start":"\n            if (offset == 1.0 && vPathPosition.x < 0.0) {\n                discard;\n            }\n            if (offset == 2.0 && vPathPosition.x > 0.0) {\n                discard;\n            }\n            if (offset == 0.0 && abs(vPathPosition.x) > 0.5) {\n                discard;\n            }\n        "}})}}]),i}(ye["a"]);xe.layerName="PathOffsetLayer",xe.defaultProps={getOffset:{type:"accessor",value:0}};var Te=i("8307"),_e={circle:{x:0,y:0,width:128,height:128,mask:!0},infoPin:{x:128,y:0,width:128,height:128,mask:!0},box:{x:128,y:128,width:128,height:128,mask:!1},vehicle:{x:0,y:128,width:128,height:128,mask:!1}},Re="pk.eyJ1IjoidnNwLXR1LWJlcmxpbiIsImEiOiJjamNpemh1bmEzNmF0MndudHI5aGFmeXpoIn0.u9f04rjFo7ZbWiSceTTXyA",Me=new fe["a"]({color:[255,255,255],intensity:1}),Ae=new ve["a"]({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]}),De=new ge["a"]({ambientLight:Me,pointLight:Ae}),Ee={vehicleColor:[200,130,250],trailColor0:[235,235,25],trailColor1:[23,184,190],effects:[De]},Le={latitude:52.5,longitude:13.4,zoom:9,pitch:15,minZoom:1,maxZoom:23};function Fe(e){var t="mapbox://styles/vsp-tu-berlin/ckek59op0011219pbwfar1rex",i=e.shipments,a=e.shownRoutes,n=e.stopMidpoints,s=(e.settingsShowLayers,e.center),r=(e.searchEnabled,e.onClick),o=Ee,l=Object.assign({},Le);l.latitude=s[1],l.longitude=s[0];var c=Object(L["useState"])({}),u=Object(pe["a"])(c,2),h=u[0],d=u[1],p=[];function m(){console.log(h),h.object?r(h.object.v):r(null)}function f(e){var t=e.hoverInfo,i=t.object,a=t.x,n=t.y;if(!i)return null;if(i.color)return F.a.createElement("div",{className:"tooltip",style:{fontSize:"0.7rem",backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",left:a+20,top:n-30}},"Leg ",i.count+1);var s=20*Object.keys(i).length+32,r=n-30;return r+s>window.innerHeight&&(r=n-s),F.a.createElement("div",{className:"tooltip",style:{fontSize:"0.7rem",backgroundColor:"#334455ee",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#eee",padding:"0.5rem 0.5rem",position:"absolute",left:a+20,top:r}},F.a.createElement("table",{style:{fontSize:"0.8rem"}},F.a.createElement("tbody",null,F.a.createElement("tr",null,F.a.createElement("td",{style:{fontSize:"1rem",fontWeight:"bold",textAlign:"right",paddingRight:"0.5rem"}},i.type," ",i.count,":"),F.a.createElement("td",{style:{fontSize:"1rem",fontWeight:"bold"}}," ",i.id)),Object.keys(i.details).map((function(e){return F.a.createElement("tr",{key:e},F.a.createElement("td",{style:{textAlign:"right",paddingRight:"0.5rem",paddingTop:"0.2rem"}},e,":"),F.a.createElement("td",{style:{paddingTop:"0.2rem"}},i.details[e]))})))))}return p.push(new ye["a"]({id:"shipmentLocationDashedLine",data:n,getPath:function(e){return[e.ptFrom,e.ptTo]},getColor:[192,192,192],getOffset:2,opacity:1,widthMinPixels:4,rounded:!0,shadowEnabled:!1,pickable:!1,autoHighlight:!1,highlightColor:[255,255,255],parameters:{depthTest:!1},getDashArray:[3,2],dashJustified:!0,extensions:[new Te["a"]({dash:!0})]})),p.push(new xe({id:"deliveryroutes",data:a,getPath:function(e){return e.points},getColor:function(e){return e.color},getOffset:2,opacity:1,widthMinPixels:12,rounded:!0,shadowEnabled:!1,pickable:!0,autoHighlight:!0,highlightColor:[255,255,255],onHover:d,parameters:{depthTest:!1}})),p.push(new ke["a"]({id:"dest-circles",data:n,getIcon:function(e){return"circle"},getColor:function(e){return e.count?[255,255,255]:[255,255,0]},getPosition:function(e){return e.midpoint},getSize:function(e){return e.count?38:64},opacity:1,shadowEnabled:!0,noAlloc:!1,iconAtlas:"/icon-atlas-3.png",iconMapping:_e,sizeScale:1,billboard:!0,pickable:!0,autoHighlight:!0,highlightColor:[255,0,255],onHover:d})),p.push(new Se["a"]({id:"dest-labels",data:n,backgroundColor:[255,255,255],getColor:[0,0,0],getPosition:function(e){return e.midpoint},getText:function(e){return"".concat(e.label)},getTextAnchor:"middle",getSize:18,opacity:1,noAlloc:!1,sizeScale:1,pickable:!1,autoHighlight:!1})),p.push(new we["a"]({id:"shipments",data:i,getSourcePosition:function(e){return[e.fromX,e.fromY]},getTargetPosition:function(e){return[e.toX,e.toY]},getSourceColor:[255,0,255],getTargetColor:[200,255,255],getWidth:2,opacity:.75,parameters:{depthTest:!1}})),F.a.createElement(be["a"],{layers:p,effects:o.effects,pickingRadius:5,initialViewState:l,controller:!0,getCursor:function(){return"pointer"},onClick:m},F.a.createElement(me["a"],{reuseMaps:!0,mapStyle:t,preventStyleDiffing:!0,mapboxApiAccessToken:Re}),f({hoverInfo:h}))}var Pe=i("d037"),ze=i("b8ae");d["c"].use(ze["VuePlugin"]),S.a.insensitive=!0;var Ie=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.COLOR_OCCUPANCY={0:[255,255,85],1:[32,96,255],2:[85,255,85],3:[255,85,85],4:[200,0,0]},e.COLOR_OCCUPANCY_MATSIM_UNUSED={0:[255,85,255],1:[255,255,85],2:[85,255,85],3:[85,85,255],4:[255,85,85],5:[255,85,0]},e.SETTINGS={Fahrzeuge:!1,Routen:!1,"DRT Anfragen":!1},e.legendItems=Object.keys(e.COLOR_OCCUPANCY).map((function(t){return{type:Q["d"].line,color:e.COLOR_OCCUPANCY[t],value:t,label:t}})),e.legendRequests=[{type:Q["d"].line,color:[255,0,255],value:0,label:""}],e.vizDetails={network:"",carriers:"",projection:"",title:"",description:"",thumbnail:"",center:[13.4,52.5]},e.myState={statusMessage:"",clock:"00:00",colorScheme:Q["a"].DarkMode,isRunning:!1,isShowingHelp:!1,fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,data:[]},e.searchTerm="",e.searchEnabled=!1,e.globalState=M["a"].state,e.isDarkMode=e.myState.colorScheme===Q["a"].DarkMode,e.isLoaded=!0,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.links={},e.toggleTours=!0,e.toggleVehicles=!0,e.toggleShipments=!0,e.toggleServices=!0,e.detailContent="",e.carriers=[],e.vehicles=[],e.shipments=[],e.services=[],e.stopMidpoints=[],e.tours=[],e.shownRoutes=[],e.shownShipments=[],e.shipmentIdsInTour=[],e.selectedCarrier="",e.selectedTour=null,e.selectedShipment=null,e.currentlyAnimating={},e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.vehicleLookup=[],e.vehicleLookupString={},e}return Object(l["a"])(i,[{key:"handleSelectShipment",value:function(e){if(console.log({shipment:e}),this.selectedShipment===e)return this.selectedShipment=null,void(this.shownShipments=[]);this.shownShipments=this.shipments.filter((function(t){return t.id===e.id})),this.selectedShipment=e}},{key:"handleSelectTour",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,o,l,c,u,h,d,p,m,f,v,g,b,y,k=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log({tour:t}),this.currentlyAnimating=t,this.shownRoutes=[],this.shownShipments=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopMidpoints=[],this.selectedTour!==t){e.next=11;break}return this.selectedTour=null,this.detailContent="",e.abrupt("return");case 11:this.selectedTour=t,this.detailContent=JSON.stringify(t,null,4),i=[],a=[],n=0,r=Object(s["a"])(t.plan),e.prev=17,l=function(){var e=o.value;if(e.shipmentId){i.push(e.shipmentId);var t=k.shipments.find((function(t){return t.id===e.shipmentId})),s="pickup"===e.type?t.from:t.to;if(a.length&&a[a.length-1].link===s)return"continue";var r=[k.links[s][0],k.links[s][1]],l=[k.links[s][2],k.links[s][3]],c=[.5*(k.links[s][0]+k.links[s][2]),.5*(k.links[s][1]+k.links[s][3])],u=Object.assign({},t);delete u.from,delete u.fromX,delete u.fromY,delete u.to,delete u.toX,delete u.toY,delete u.id,a.push({id:t.id,type:"pickup"===e.type?k.$t("pickup"):k.$t("delivery"),count:n++,link:s,midpoint:c,label:"",details:u,ptFrom:r,ptTo:l})}},r.s();case 20:if((o=r.n()).done){e.next=26;break}if(c=l(),"continue"!==c){e.next=24;break}return e.abrupt("continue",24);case 24:e.next=20;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e["catch"](17),r.e(e.t0);case 31:return e.prev=31,r.f(),e.finish(31);case 34:for(u=0;u<a.length;u++){for(h="",d=0;d<u;d++)a[u].midpoint[0]===a[d].midpoint[0]&&a[u].midpoint[1]===a[d].midpoint[1]&&(h+=",".concat(d),",0"===h&&(h=",*"),a[u].label="");h+=",".concat(u),h=h.slice(1),"0"===h&&(h="*"),a[u].label=h}this.shipmentIdsInTour=i,p=O()({colormap:"summer",nshades:Math.max(9,t.routes.length),format:"rba"}).map((function(e){return e.slice(0,3)})),m=0,f=function(e){return new Promise((function(t){return setTimeout(t,e)}))},v=t.routes.length>20?25:50,g=Object(s["a"])(t.routes),e.prev=41,g.s();case 43:if((b=g.n()).done){e.next=51;break}return y=b.value,this.addRouteToMap(t,y,a,p,m),m++,e.next=49,f(v);case 49:e.next=43;break;case 51:e.next=56;break;case 53:e.prev=53,e.t1=e["catch"](41),g.e(e.t1);case 56:return e.prev=56,g.f(),e.finish(56);case 59:this.stopMidpoints=a;case 60:case"end":return e.stop()}}),e,this,[[17,28,31,34],[41,53,56,59]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addRouteToMap",value:function(e,t,i,a,n){if(this.currentlyAnimating===e){var r,o=[[this.links[t[0]][0],this.links[t[0]][1]]],l=Object(s["a"])(t);try{for(l.s();!(r=l.n()).done;){var c=r.value,u=[this.links[c][0],this.links[c][1]];u[0]===o[o.length-1][0]&&u[1]===o[o.length-1][1]||o.push(u),o.push([this.links[c][2],this.links[c][3]])}}catch(h){l.e(h)}finally{l.f()}this.shownRoutes=this.shownRoutes.concat([{count:n,points:o,color:a[n]}]),this.stopMidpoints=i.slice(0,n)}}},{key:"handleSelectCarrier",value:function(e){var t,i,a;console.log("carrier",e),this.currentlyAnimating=null;e.$.id;this.vehicles=[],this.shipments=[],this.services=[],this.tours=[],this.shownRoutes=[],this.shownShipments=[],this.selectedShipment=null,this.shipmentIdsInTour=[],this.stopMidpoints=[],this.selectedCarrier!==e.$.id?(this.selectedCarrier=e.$.id,null!==(t=e.capabilities[0])&&void 0!==t&&null!==(i=t.vehicles[0])&&void 0!==i&&i.vehicle&&(this.vehicles=e.capabilities[0].vehicles[0].vehicle.map((function(e){return e.$.id})).sort((function(e,t){return S()(e,t)}))),this.shipments=this.processShipments(e),null!==(a=e.services[0])&&void 0!==a&&a.service&&(this.services=e.services[0].service.map((function(e){return e.$})).sort((function(e,t){return S()(e.$.id,t.$.id)}))),this.tours=this.processTours(e)):this.selectedCarrier=""}},{key:"processTours",value:function(e){var t;if(null===(t=e.plan[0])||void 0===t||!t.tour)return[];var i=e.plan[0].tour.map((function(e){var t=e.$$.map((function(e){return Object.assign(e.$,{$:e["#name"],route:e.route})})),i=t.filter((function(e){return"leg"===e.$&&e.route[0].length})).map((function(e){return e.route[0].split(" ")}));return{vehicleId:e.$.vehicleId,plan:t,routes:i}}));return i.sort((function(e,t){return S()(e.vehicleId,t.vehicleId)})),i}},{key:"processShipments",value:function(e){var t;if(!e.shipments)return[];var i=[];null!==(t=e.shipments[0])&&void 0!==t&&t.shipment&&(i=e.shipments[0].shipment.map((function(e){return e.$})).sort((function(e,t){return S()(e.id,t.id)})));try{var a,n=Object(s["a"])(i);try{for(n.s();!(a=n.n()).done;){var r=a.value;r.fromX=.5*(this.links[r.from][0]+this.links[r.from][2]),r.fromY=.5*(this.links[r.from][1]+this.links[r.from][3]),r.toX=.5*(this.links[r.to][0]+this.links[r.to][2]),r.toY=.5*(this.links[r.to][1]+this.links[r.to][3])}}catch(o){n.e(o)}finally{n.f()}}catch(l){}return i}},{key:"handleSettingChange",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log(t),this.SETTINGS[t]=!this.SETTINGS[t];case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Pe["a"](t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"getFileSystem",value:function(e){var t=this.$store.state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=y.a.parse(t),this.vizDetails.center||(this.vizDetails.center=[13.4,52.5]),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.needPassword&&401===e.t0.status&&M["a"].commit("requestLogin",this.myState.fileSystem.slug);case 12:i=this.vizDetails.title?this.vizDetails.title:"Carrier Explorer",this.$emit("title",i),this.buildThumbnail();case 15:case"end":return e.stop()}}),e,this,[[0,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,g.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.myState.colorScheme===Q["a"].DarkMode,this.updateLegendColors()}},{key:"handleClick",value:function(e){if(null!==e){var t=this.vehicleLookup[e];console.log(t),this.searchTerm===t?this.searchTerm="":this.searchTerm=t}else this.searchTerm=""}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.myState.colorScheme===Q["a"].DarkMode?t:e}},{key:"mounted",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return M["a"].commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.showHelp=!1,this.updateLegendColors(),this.myState.statusMessage="Loading carriers...",console.log("loading files"),e.next=12,this.loadCarriers();case 12:return this.carriers=e.sent,e.next=15,this.loadNetwork();case 15:this.links=e.sent,console.log("GO!"),this.myState.statusMessage="";case 18:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadCarriers",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFileOrGzippedFile(this.vizDetails.carriers);case 2:return t=e.sent,e.next=5,this.parseXML(t);case 5:return i=e.sent,a=i.carriers.carrier.sort((function(e,t){return S()(e.$.id,t.$.id)})),e.next=9,this.$nextTick();case 9:return console.log({carrierList:a}),e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadNetwork",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.statusMessage="Loading network",!(this.vizDetails.network.indexOf(".xml.")>-1)){e.next=14;break}return e.next=4,this.loadFileOrGzippedFile(this.vizDetails.network);case 4:return t=e.sent,e.next=7,this.parseXML(t);case 7:return i=e.sent,e.next=10,this.convertRoadNetwork(i);case 10:return a=e.sent,e.abrupt("return",a);case 14:return e.next=16,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.network);case 16:if(n=e.sent,!n){e.next=23;break}return e.next=20,Object(_["a"])(n);case 20:e.t0=e.sent,e.next=24;break;case 23:e.t0=null;case 24:return s=e.t0,e.next=27,R["run"](T.a.inflateAsync(s,{to:"string"}));case 27:return r=e.sent,o=JSON.parse(r),e.abrupt("return",o);case 30:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"convertRoadNetwork",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.statusMessage="Projecting network...",this.vizDetails.projection="EPSG:31464",e.next=4,de.create({xml:t,projection:this.vizDetails.projection});case 4:return this._networkHelper=e.sent,this.myState.statusMessage="Crunching road network...",e.next=8,this._networkHelper.createNodesAndLinks();case 8:return this.myState.statusMessage="Converting coordinates...",e.next=11,this._networkHelper.convertCoordinates();case 11:for(i=e.sent,this._networkHelper.destroy(),this.myState.statusMessage="Merging links and nodes",a=i.network.nodes,n={},s=0,r=Object.keys(i.network.links);s<r.length;s++)o=r[s],l=i.network.links[o],n[o]=[a[l.from].x,a[l.from].y,a[l.to].x,a[l.to].y];return e.abrupt("return",n);case 18:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){this.myState.isRunning=!1,this._networkHelper&&this._networkHelper.destroy(),M["a"].commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1)}},{key:"parseXML",value:function(e){var t=new j.a.Parser({strict:!0,trim:!0,preserveChildrenOrder:!0,explicitChildren:!0,explicitArray:!0});return new Promise((function(i,a){t.parseString(e,(function(e,t){e?a(e):i(t)}))}))}},{key:"loadFileOrGzippedFile",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("loading",t),i="",e.prev=2,!t.endsWith("xml")){e.next=9;break}return e.next=6,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+t);case 6:i=e.sent,e.next=24;break;case 9:if(!t.endsWith("gz")){e.next=24;break}return e.next=12,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+t);case 12:if(a=e.sent,!a){e.next=19;break}return e.next=16,Object(_["a"])(a);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=null;case 20:return n=e.t0,e.next=23,R["run"](T.a.inflateAsync(n,{to:"string"}));case 23:i=e.sent;case 24:e.next=31;break;case 26:e.prev=26,e.t1=e["catch"](2),s=t+": "+e.t1,console.error(e.t1),this.myState.statusMessage=s;case 31:return e.abrupt("return",i);case 32:case"end":return e.stop()}}),e,this,[[2,26]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"toggleLoaded",value:function(e){this.isLoaded=e}},{key:"rotateColors",value:function(){this.myState.colorScheme=this.myState.colorScheme===Q["a"].DarkMode?Q["a"].LightMode:Q["a"].DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!1})],Ie.prototype,"fileApi",void 0),Object(h["a"])([Object(d["b"])({required:!1})],Ie.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],Ie.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],Ie.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["d"])("globalState.authAttempts")],Ie.prototype,"authenticationChanged",null),Object(h["a"])([Object(d["d"])("globalState.colorScheme")],Ie.prototype,"swapTheme",null),Ie=Object(h["a"])([Object(d["a"])({components:{CollapsiblePanel:E["a"],DetailsPanel:re,LegendColors:P,PlaybackControls:W,SettingsPanel:J,ToggleButton:f["ToggleButton"],TourViz:Fe,VueSlider:m.a}})],Ie),M["a"].commit("registerPlugin",{kebabName:"carrier-viewer",prettyName:"Carrier Viewer",description:"For freight etc!",filePatterns:["viz-carrier*.y?(a)ml"],component:Ie});var Ne=Ie,He=Ne,Be=(i("4a17"),i("d388")),Ve=Object(U["a"])(He,a,n,!1,null,"3795a5f0",null);"function"===typeof Be["default"]&&Object(Be["default"])(Ve);var Ue=Ve.exports,qe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"gl-app",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[i("div",{staticClass:"left-side"},[e.thumbnail?e._e():i("collapsible-panel",{attrs:{direction:"left",locked:!0}},[i("div",{staticClass:"panel-items"},[i("h3",[e._v(e._s(e.vizDetails.title))]),i("p",[e._v(" "+e._s(e.vizDetails.description))])])])],1),e.thumbnail?e._e():i("trip-viz",{staticClass:"anim",attrs:{center:e.vizDetails.center,colors:e.COLOR_OCCUPANCY,drtRequests:e.$options.drtRequests,dark:e.globalState.isDarkMode,paths:e.$options.paths,settingsShowLayers:e.SETTINGS,searchEnabled:e.searchEnabled,simulationTime:e.simulationTime,traces:e.$options.traces,vehicleLookup:e.vehicleLookup,onClick:e.handleClick}}),e.isLoaded&&!e.thumbnail?i("div",{staticClass:"right-side"},[i("collapsible-panel",{attrs:{direction:"right"}},[i("div",{staticClass:"big clock"},[i("p",[e._v(e._s(e.myState.clock))])]),i("div",{staticClass:"panel-items"},[i("legend-colors",{staticClass:"legend-block",attrs:{title:"Anfragen:",items:e.legendRequests}}),e.legendItems.length?i("legend-colors",{staticClass:"legend-block",attrs:{title:"Passagiere:",items:e.legendItems}}):e._e(),i("div",{staticClass:"search-panel"},[i("p",{staticClass:"speed-label",style:{margin:"1rem 0 0 0"}},[e._v("Suche:")]),i("form",{attrs:{autocomplete:"off"}}),i("div",{staticClass:"field"},[i("p",{staticClass:"control has-icons-left"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.searchTerm,expression:"searchTerm"}],staticClass:"input is-small",attrs:{type:"email",placeholder:"Search..."},domProps:{value:e.searchTerm},on:{input:function(t){t.target.composing||(e.searchTerm=t.target.value)}}}),i("span",{staticClass:"icon is-small is-left"},[i("i",{staticClass:"fas fa-search"})])])])]),i("settings-panel",{staticClass:"settings-area",attrs:{items:e.SETTINGS},on:{click:e.handleSettingChange}}),i("div",{staticClass:"speed-block"},[i("p",{staticClass:"speed-label"},[e._v("Geschwindigkeit:"),i("br"),e._v(e._s(e.speed)+"x")]),i("vue-slider",{staticClass:"speed-slider",attrs:{data:e.speedStops,duration:0,dotSize:20,tooltip:"active","tooltip-placement":"bottom","tooltip-formatter":function(e){return e+"x"}},model:{value:e.speed,callback:function(t){e.speed=t},expression:"speed"}})],1)],1)])],1):e._e(),!e.thumbnail&&e.isLoaded?i("playback-controls",{staticClass:"bottom-area",attrs:{timeStart:e.timeStart,timeEnd:e.timeEnd,isRunning:e.myState.isRunning,currentTime:e.simulationTime},on:{click:e.toggleSimulation,time:e.setTime}}):e._e()],1)},We=[],$e=i("2909"),Ge=(i("159b"),i("7783")),Ye={currentTime:{type:"number",value:0,min:0},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},searchFlag:{type:"number",value:0}},Xe=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){return Object(o["a"])(this,i),t.apply(this,arguments)}return Object(l["a"])(i,[{key:"getShaders",value:function(){var e=Object(Ce["a"])(Object(je["a"])(i.prototype),"getShaders",this).call(this);return e.inject={"vs:#decl":"        attribute float timeStart;\n        attribute float timeEnd;\n        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","vs:#main-start":"        if (searchFlag == 1.0) {\n          vTime = 999.0;\n        } else if (timeEnd == -1.0 || timeStart > currentTime || timeEnd < currentTime ) {\n          vTime = -1.0;\n          return;\n        } else {\n          float nearBeginning = currentTime - timeStart;\n          float nearEnd = timeEnd - currentTime;\n          vTime = min(nearBeginning, nearEnd);\n        }\n      ","fs:#decl":"        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","fs:#main-start":"      if (searchFlag == 0.0 && vTime == -1.0 ) discard;\n      ","fs:DECKGL_FILTER_COLOR":"        if (vTime <= 10.0) color.a *= (vTime / 10.0);\n      "},e}},{key:"initializeState",value:function(e){Object(Ce["a"])(Object(je["a"])(i.prototype),"initializeState",this).call(this,e);var t=this.getAttributeManager();t.addInstanced({timeStart:{size:1,accessor:"getTimeStart"},timeEnd:{size:1,accessor:"getTimeEnd"}})}},{key:"draw",value:function(e){var t=this.props.currentTime;e.uniforms=Object.assign({},e.uniforms,{currentTime:t}),Object(Ce["a"])(Object(je["a"])(i.prototype),"draw",this).call(this,e)}}]),i}(we["a"]);Xe.layerName="DrtRequestArcLayer",Xe.defaultProps=Ye;i("aff5"),i("a9e3"),i("cfc3");var Ze,Ke=i("2b88"),Je=i("050f"),Qe=i("261f"),et=i("2bb8"),tt=i("01a6"),it=i("ca47"),at=i("d22f"),nt=i("ade3"),st=(i("90d7"),i("07ac"),i("31d5")),rt=i("a7bc"),ot=i("7f94"),lt=i("9c99"),ct=i("2418"),ut=i("ae9c"),ht=1024,dt=4,pt=function(){},mt=(Ze={},Object(nt["a"])(Ze,tt["a"].TEXTURE_MIN_FILTER,tt["a"].LINEAR_MIPMAP_LINEAR),Object(nt["a"])(Ze,tt["a"].TEXTURE_MAG_FILTER,tt["a"].LINEAR),Object(nt["a"])(Ze,tt["a"].TEXTURE_WRAP_S,tt["a"].CLAMP_TO_EDGE),Object(nt["a"])(Ze,tt["a"].TEXTURE_WRAP_T,tt["a"].CLAMP_TO_EDGE),Ze);function ft(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function vt(e,t,i,a){return i===t.width&&a===t.height?t:(e.canvas.height=a,e.canvas.width=i,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0,t.width,t.height,0,0,i,a),e.canvas)}function gt(e){return e&&(e.id||e.url)}function bt(e,t,i,a){var n=t.width,s=t.height,r=Object(st["a"])(t,{width:i,height:a});return Object(rt["b"])(t,r,{targetY:0,width:n,height:s}),t.delete(),r}function yt(e,t,i){for(var a=0;a<t.length;a++){var n=t[a],s=n.icon,r=n.xOffset,o=gt(s);e[o]=Object(Oe["a"])(Object(Oe["a"])({},s),{},{x:r,y:i})}}function kt(e){for(var t=e.icons,i=e.buffer,a=e.mapping,n=void 0===a?{}:a,s=e.xOffset,r=void 0===s?0:s,o=e.yOffset,l=void 0===o?0:o,c=e.rowHeight,u=void 0===c?0:c,h=e.canvasWidth,d=[],p=0;p<t.length;p++){var m=t[p],f=gt(m);if(!n[f]){var v=m.height,g=m.width;r+g+i>h&&(yt(n,d,l),r=0,l=u+l+i,u=0,d=[]),d.push({icon:m,xOffset:r}),r=r+g+i,u=Math.max(u,v)}}return d.length>0&&yt(n,d,l),{mapping:n,rowHeight:u,xOffset:r,yOffset:l,canvasWidth:h,canvasHeight:ft(u+l+i)}}function St(e,t,i){if(!e||!t)return null;i=i||{};var a,n={},r=Object(ut["a"])(e),o=r.iterable,l=r.objectInfo,c=Object(s["a"])(o);try{for(c.s();!(a=c.n()).done;){var u=a.value;l.index++;var h=t(u,l),d=gt(h);if(!h)throw new Error("Icon is missing.");if(!h.url)throw new Error("Icon url is missing.");n[d]||i[d]&&h.url===i[d].url||(n[d]=Object(Oe["a"])(Object(Oe["a"])({},h),{},{source:u,sourceIndex:l.index}))}}catch(p){c.e(p)}finally{c.f()}return n}var wt=function(){function e(t,i){var a=i.onUpdate,n=void 0===a?pt:a,s=i.onError,r=void 0===s?pt:s;Object(o["a"])(this,e),this.gl=t,this.onUpdate=n,this.onError=r,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=dt,this._canvasWidth=ht,this._canvasHeight=0,this._canvas=null}return Object(l["a"])(e,[{key:"finalize",value:function(){var e;null===(e=this._texture)||void 0===e||e.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(e){var t=this._autoPacking?gt(e):e;return this._mapping[t]||{}}},{key:"setProps",value:function(e){var t=e.loadOptions,i=e.autoPacking,a=e.iconAtlas,n=e.iconMapping,s=e.data,r=e.getIcon;t&&(this._loadOptions=t),void 0!==i&&(this._autoPacking=i),r&&(this._getIcon=r),n&&(this._mapping=n),a&&this._updateIconAtlas(a),this._autoPacking&&(s||r)&&"undefined"!==typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(s))}},{key:"isLoaded",get:function(){return 0===this._pendingCount}},{key:"_updateIconAtlas",value:function(e){var t;null===(t=this._texture)||void 0===t||t.delete(),this._texture=null,this._externalTexture=e,this.onUpdate()}},{key:"_updateAutoPacking",value:function(e){var t=Object.values(St(e,this._getIcon,this._mapping)||{});if(t.length>0){var i=kt({icons:t,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),a=i.mapping,n=i.xOffset,s=i.yOffset,r=i.rowHeight,o=i.canvasHeight;this._rowHeight=r,this._mapping=a,this._xOffset=n,this._yOffset=s,this._canvasHeight=o,this._texture||(this._texture=new ot["a"](this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:mt})),this._texture.height!==this._canvasHeight&&(this._texture=bt(this.gl,this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._loadIcons(t)}}},{key:"_loadIcons",value:function(e){var t,i=this,a=this._canvas.getContext("2d"),n=Object(s["a"])(e);try{var r=function(){var e=t.value;i._pendingCount++,Object(ct["a"])(e.url,lt["a"],i._loadOptions).then((function(t){var n=gt(e),s=i._mapping[n],r=s.x,o=s.y,l=s.width,c=s.height,u=vt(a,t,l,c);i._texture.setSubImageData({data:u,x:r,y:o,width:l,height:c}),i._texture.generateMipmap(),i.onUpdate()})).catch((function(t){i.onError({url:e.url,source:e.source,sourceIndex:e.sourceIndex,loadOptions:i._loadOptions,error:t})})).finally((function(){i._pendingCount--}))};for(n.s();!(t=n.n()).done;)r()}catch(o){n.e(o)}finally{n.f()}}}]),e}(),Ot=i("f863").default,Ct=i("0554").default,jt=[0,0,0,255],xt={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!1,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},iconStill:{type:"object",value:null},getIcon:{type:"accessor",value:function(e){return e.icon}},getColor:{type:"accessor",value:jt},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getPathStart:{type:"accessor",value:null},getPathEnd:{type:"accessor",value:null},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},currentTime:{type:"number",value:0},pickable:{type:"boolean",value:!0},onIconError:{type:"function",value:null,compare:!1,optional:!0}},Tt=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){return Object(o["a"])(this,i),t.apply(this,arguments)}return Object(l["a"])(i,[{key:"getShaders",value:function(){return Object(Ce["a"])(Object(je["a"])(i.prototype),"getShaders",this).call(this,{vs:Ot,fs:Ct,modules:[Ke["a"],Je["a"]]})}},{key:"initializeState",value:function(){this.state={iconManager:new wt(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};var e=this.getAttributeManager();e.addInstanced({instanceTimestamps:{size:1,accessor:"getTimeStart"},instanceTimestampsNext:{size:1,accessor:"getTimeEnd"},instanceStartPositions:{size:2,accessor:"getPathStart"},instanceEndPositions:{size:2,accessor:"getPathEnd"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:tt["a"].UNSIGNED_BYTE,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:tt["a"].UNSIGNED_BYTE,normalized:!0,transition:!0,accessor:"getColor",defaultValue:jt},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(e){var t=e.oldProps,a=e.props,n=e.changeFlags;Object(Ce["a"])(Object(je["a"])(i.prototype),"updateState",this).call(this,{props:a,oldProps:t,changeFlags:n});var s=this.getAttributeManager(),r=a.iconAtlas,o=a.iconMapping,l=a.data,c=a.getIcon,u=this.state.iconManager;u.setProps({loadOptions:a.loadOptions});var h=!1,d=r||this.internalState.isAsyncPropLoading("iconAtlas");if(d?(t.iconAtlas!==a.iconAtlas&&u.setProps({iconAtlas:r,autoPacking:!1}),t.iconMapping!==a.iconMapping&&(u.setProps({iconMapping:o}),h=!0)):u.setProps({autoPacking:!0}),(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&u.setProps({data:l,getIcon:c}),h&&(s.invalidate("instanceOffsets"),s.invalidate("instanceIconFrames"),s.invalidate("instanceColorModes")),n.extensionsChanged){var p,m=this.context.gl;null===(p=this.state.model)||void 0===p||p.delete(),this.state.model=this._getModel(m),s.invalidateAll()}}},{key:"isLoaded",get:function(){return Object(Ce["a"])(Object(je["a"])(i.prototype),"isLoaded",this)&&this.state.iconManager.isLoaded}},{key:"finalizeState",value:function(){Object(Ce["a"])(Object(je["a"])(i.prototype),"finalizeState",this).call(this),this.state.iconManager.finalize()}},{key:"draw",value:function(e){var t=e.uniforms,i=this.props,a=i.sizeScale,n=i.sizeMinPixels,s=i.sizeMaxPixels,r=i.sizeUnits,o=i.billboard,l=i.alphaCutoff,c=i.currentTime,u=i.iconStill,h=i.pickable,d=this.state.iconManager,p=this.context.viewport,m=d.getTexture();m&&this.state.model.setUniforms(t).setUniforms({iconsTexture:m,iconsTextureDim:[m.width,m.height],sizeScale:a*("pixels"===r?p.metersPerPixel:1),sizeMinPixels:n,sizeMaxPixels:s,billboard:o,alphaCutoff:l,currentTime:c,pickable:h,iconStillOffsets:this.getInstanceOffset(u),iconStillFrames:this.getInstanceIconFrame(u)}).draw()}},{key:"_getModel",value:function(e){var t=[-1,-1,-1,1,1,1,1,-1];return new it["a"](e,Object(Oe["a"])(Object(Oe["a"])({},this.getShaders()),{},{id:this.props.id,geometry:new at["a"]({drawMode:tt["a"].TRIANGLE_FAN,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"_onError",value:function(e){var t=this.getCurrentLayer().props.onIconError;t?t(e):Qe["a"].error(e.error)()}},{key:"getInstanceOffset",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.width/2-t.anchorX||0,t.height/2-t.anchorY||0]}},{key:"getInstanceColorMode",value:function(e){var t=this.state.iconManager.getIconMapping(e);return t.mask?1:0}},{key:"getInstanceIconFrame",value:function(e){var t=this.state.iconManager.getIconMapping(e);return[t.x||0,t.y||0,t.width||0,t.height||0]}}]),i}(et["a"]);Tt.layerName="FlatIconLayer",Tt.defaultProps=xt;var _t=i("125d"),Rt={currentTime:{type:"number",value:0,min:0},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},searchFlag:{type:"number",value:0}},Mt=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){return Object(o["a"])(this,i),t.apply(this,arguments)}return Object(l["a"])(i,[{key:"getShaders",value:function(){var e=Object(Ce["a"])(Object(je["a"])(i.prototype),"getShaders",this).call(this);return e.inject={"vs:#decl":"        attribute float timeStart;\n        attribute float timeEnd;\n        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","vs:#main-start":"        if (searchFlag == 1.0) {\n          vTime = 999.0;\n        } else if(timeStart > currentTime || timeEnd < currentTime ) {\n          vTime = -1.0;\n          return;\n        } else {\n          float nearBeginning = currentTime - timeStart;\n          float nearEnd = timeEnd - currentTime;\n          vTime = min(nearBeginning, nearEnd);\n        }\n      ","fs:#decl":"        uniform float currentTime;\n        varying float vTime;\n        uniform float searchFlag;\n      ","fs:#main-start":"        if (searchFlag == 0.0 && vTime == -1.0 ) discard;\n      ","fs:DECKGL_FILTER_COLOR":"        if (searchFlag == 0.0 && vTime <= 10.0) color.a *= (vTime / 10.0);\n      "},e}},{key:"initializeState",value:function(e){Object(Ce["a"])(Object(je["a"])(i.prototype),"initializeState",this).call(this,e);var t=this.getAttributeManager();t.addInstanced({timeStart:{size:1,accessor:"getTimeStart"},timeEnd:{size:1,accessor:"getTimeEnd"}})}},{key:"draw",value:function(e){var t=this.props,a=t.currentTime,n=t.searchFlag;e.uniforms=Object.assign({},e.uniforms,{currentTime:a,searchFlag:n}),Object(Ce["a"])(Object(je["a"])(i.prototype),"draw",this).call(this,e)}}]),i}(_t["a"]);Mt.layerName="PathTraceLayer",Mt.defaultProps=Rt;var At={marker:{x:0,y:0,width:128,height:128,mask:!0},info:{x:128,y:0,width:128,height:128,mask:!0},vehicle:{x:128,y:128,width:128,height:128,mask:!0},diamond:{x:0,y:128,width:128,height:128,mask:!1}},Dt=new fe["a"]({color:[255,255,255],intensity:1}),Et=new ve["a"]({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]}),Lt=new ge["a"]({ambientLight:Dt,pointLight:Et}),Ft={vehicleColor:[200,130,250],trailColor0:[235,235,25],trailColor1:[23,184,190],effects:[Lt]},Pt={time:0,fromX:1,fromY:2,toX:3,toY:4,veh:5,arrival:6};function zt(e){var t=e.simulationTime,i=e.paths,a=e.traces,n=e.drtRequests,s=e.settingsShowLayers,r=(e.center,e.dark),o=e.vehicleLookup,l=e.searchEnabled,c=e.onClick,u=Ft,h=M["a"].state.viewState,d=1,p=Object(L["useState"])({}),m=Object(pe["a"])(p,2),f=m[0],v=m[1],g=[];function b(){console.log(f),f.object?c(f.object.v):c(null)}function y(e){var t=e.hoverInfo,i=t.object,a=t.x,n=t.y;if(!i)return null;var s=o[i.v];return F.a.createElement("div",{className:"tooltip",style:{fontSize:"0.8rem",backgroundColor:"#ddddeedd",borderLeft:"6px solid green",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#223",padding:"1rem 1rem",position:"absolute",left:a+40,top:n-30}},F.a.createElement("big",null,F.a.createElement("b",null,"Taxi: ",s)),F.a.createElement("div",null,"Passagiere: ",i.occ," "))}return s["Routen"]&&g.push(new Mt({id:"Routen",data:a,currentTime:t,getSourcePosition:function(e){return e.p0},getTargetPosition:function(e){return e.p1},getTimeStart:function(e){return e.t0},getTimeEnd:function(e){return e.t1},getColor:function(t){return e.colors[t.occ]},getWidth:function(e){return 3*(e.occ+1)-1},opacity:.9,widthMinPixels:2,rounded:!1,shadowEnabled:!1,searchFlag:l?1:0,pickable:!0,autoHighlight:!0,highlightColor:[255,0,255],onHover:v})),s["Fahrzeuge"]&&g.push(new Tt({id:"Vehicles",data:i,getPathStart:function(e){return e.p0},getPathEnd:function(e){return e.p1},getTimeStart:function(e){return e.t0},getTimeEnd:function(e){return e.t1},getIcon:function(e){return"vehicle"},getColor:function(t){return e.colors[t.occ]},iconMoving:"vehicle",iconStill:"diamond",getSize:l?56:44,opacity:1,currentTime:t,shadowEnabled:!1,noAlloc:!0,iconAtlas:"/icon-atlas.png",iconMapping:At,sizeScale:.5,billboard:!1,pickable:!0,depthTest:!0,autoHighlight:!1,highlightColor:[255,0,255],onHover:v,parameters:{depthTest:!1}})),s["DRT Anfragen"]&&g.push(new Xe({id:"DRT Requests",data:n,currentTime:t,getSourcePosition:function(e){return[e[Pt.fromX],e[Pt.fromY]]},getTargetPosition:function(e){return[e[Pt.toX],e[Pt.toY]]},getTimeStart:function(e){return e[Pt.time]},getTimeEnd:function(e){return e[Pt.arrival]},getSourceColor:[255,0,255],getTargetColor:[200,255,255],getWidth:d,opacity:.5,searchFlag:l?1:0})),F.a.createElement(be["a"],{layers:g,effects:u.effects,pickingRadius:5,viewState:h,controller:!0,getCursor:function(){return"pointer"},onClick:b,onViewStateChange:function(e){M["a"].commit("setMapCamera",e.viewState)}},F.a.createElement(me["a"],{reuseMaps:!0,mapStyle:r?Q["f"].dark:Q["f"].light,preventStyleDiffing:!0,mapboxApiAccessToken:Q["e"]}),y({hoverInfo:f}))}d["c"].use(ze["VuePlugin"]);var It=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.COLOR_OCCUPANCY={0:[255,255,85],1:[32,96,255],2:[85,255,85],3:[255,85,85],4:[200,0,0]},e.COLOR_OCCUPANCY_MATSIM_UNUSED={0:[255,85,255],1:[255,255,85],2:[85,255,85],3:[85,85,255],4:[255,85,85],5:[255,85,0]},e.SETTINGS={Fahrzeuge:!0,Routen:!1,"DRT Anfragen":!1},e.legendItems=Object.keys(e.COLOR_OCCUPANCY).map((function(t){return{type:Q["d"].line,color:e.COLOR_OCCUPANCY[t],value:t,label:t}})),e.legendRequests=[{type:Q["d"].line,color:[255,0,255],value:0,label:""}],e.vizDetails={network:"",drtTrips:"",projection:"",title:"",description:"",thumbnail:"",center:[6.5,51]},e.myState={statusMessage:"",clock:"00:00",colorScheme:Q["a"].DarkMode,isRunning:!1,isShowingHelp:!1,fileApi:void 0,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,data:[]},e.timeStart=0,e.timeEnd=86400,e.traces=Object(Ge["a"])([]),e.paths=Object(Ge["a"])([]),e.requests=Object(Ge["a"])([]),e.simulationTime=21600,e.timeElapsedSinceLastFrame=0,e.searchTerm="",e.searchEnabled=!1,e.globalState=M["a"].state,e.isDarkMode=e.globalState.colorScheme===Q["a"].DarkMode,e.isLoaded=!0,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.vehicleLookup=[],e.vehicleLookupString={},e.isPausedDueToHiding=!1,e}return Object(l["a"])(i,[{key:"buildFileApi",value:function(){var e=this.getFileSystem(this.root);this.myState.fileApi=new Pe["a"](e),this.myState.fileSystem=e}},{key:"handleSettingChange",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log(t),this.SETTINGS[t]=!this.SETTINGS[t],this.updateDatasetFilters(),this.simulationTime+=1;case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Pe["a"](t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"getFileSystem",value:function(e){var t=M["a"].state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 5:t=e.sent,this.vizDetails=y.a.parse(t),this.vizDetails.center||(this.vizDetails.center=[14,52.1]),e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](2),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.needPassword&&401===e.t0.status&&M["a"].commit("requestLogin",this.myState.fileSystem.slug);case 14:i=this.vizDetails.title?this.vizDetails.title:"Agent Animation",this.$emit("title",i),this.buildThumbnail();case 17:case"end":return e.stop()}}),e,this,[[2,10]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return");case 2:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=17;break}return e.prev=3,e.next=6,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 6:return t=e.sent,e.next=9,g.a.arraybuffer(t);case 9:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](3),console.error(e.t0);case 17:case"end":return e.stop()}}),e,this,[[3,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.globalState.colorScheme===Q["a"].DarkMode,this.updateLegendColors()}},{key:"handleSearch",value:function(){var e,t,i,a,n,s,r=this.vehicleLookupString[this.searchTerm];r>-1?(console.log("vehicle",r),null===(e=this.pathVehicle)||void 0===e||e.filterExact(r),null===(t=this.traceVehicle)||void 0===t||t.filterExact(r),null===(i=this.requestVehicle)||void 0===i||i.filterExact(r),this.requestStart.filterAll(),this.requestEnd.filterAll(),this.searchEnabled=!0):(console.log("nope"),null===(a=this.pathVehicle)||void 0===a||a.filterAll(),null===(n=this.traceVehicle)||void 0===n||n.filterAll(),null===(s=this.requestVehicle)||void 0===s||s.filterAll(),this.searchEnabled=!1);this.updateDatasetFilters()}},{key:"handleClick",value:function(e){if(null!==e){var t=this.vehicleLookup[e];console.log(t),this.searchTerm===t?this.searchTerm="":this.searchTerm=t}else this.searchTerm=""}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.myState.colorScheme===Q["a"].DarkMode?t:e}},{key:"setWallClock",value:function(){var e=Math.floor(this.simulationTime/3600),t=Math.floor(this.simulationTime/60)%60;this.myState.clock="".concat(e<10?"0":"").concat(e).concat(t<10?":0":":").concat(t)}},{key:"setTime",value:function(e){this.simulationTime=e,this.setWallClock(),this.traceStart&&this.pathStart&&this.requestStart&&(this.pathStart.filter([0,this.simulationTime]),this.pathEnd.filter([this.simulationTime,1/0]),this.searchEnabled||(this.traceStart.filter([0,this.simulationTime]),this.traceEnd.filter([this.simulationTime,1/0]),this.requestStart.filter([0,this.simulationTime]),this.requestEnd.filter([this.simulationTime,1/0]))),this.$options.paths=this.paths.allFiltered(),this.$options.traces=this.traces.allFiltered(),this.$options.drtRequests=this.requests.allFiltered()}},{key:"toggleSimulation",value:function(){this.myState.isRunning=!this.myState.isRunning,this.timeElapsedSinceLastFrame=Date.now(),this.myState.isRunning&&0===this.speed&&(this.speed=1),this.myState.isRunning&&this.animate()}},{key:"mounted",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return M["a"].commit("setFullScreen",!this.thumbnail),this.buildFileApi(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.showHelp=!1,this.updateLegendColors(),this.setWallClock(),this.myState.statusMessage="/ Dateien laden...",console.log("loading files"),e.next=13,this.loadFiles();case 13:return t=e.sent,i=t.trips,a=t.drtRequests,console.log("parsing vehicle motion"),this.myState.statusMessage="/ Standorte berechnen...",e.next=20,this.parseVehicles(i);case 20:return this.paths=e.sent,this.pathStart=this.paths.dimension((function(e){return e.t0})),this.pathEnd=this.paths.dimension((function(e){return e.t1})),this.pathVehicle=this.paths.dimension((function(e){return e.v})),console.log("Routen verarbeiten..."),this.myState.statusMessage="/ Routen verarbeiten...",e.next=28,this.parseRouteTraces(i);case 28:return this.traces=e.sent,this.traceStart=this.traces.dimension((function(e){return e.t0})),this.traceEnd=this.traces.dimension((function(e){return e.t1})),this.traceVehicle=this.traces.dimension((function(e){return e.v})),console.log("Anfragen sortieren..."),this.myState.statusMessage="/ Anfragen...",e.next=36,this.parseDrtRequests(a);case 36:this.requests=e.sent,this.requestStart=this.requests.dimension((function(e){return e[0]})),this.requestEnd=this.requests.dimension((function(e){return e[6]})),this.requestVehicle=this.requests.dimension((function(e){return e[5]})),console.log("GO!"),this.myState.statusMessage="",document.addEventListener("visibilitychange",this.handleVisibilityChange,!1),this.myState.isRunning=!0,this.timeElapsedSinceLastFrame=Date.now(),this.animate();case 46:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"parseDrtRequests",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.vehicleLookup.length){i=Object(s["a"])(t);try{for(i.s();!(a=i.n()).done;){n=a.value;try{n[5]=this.vehicleLookupString[n[5]]}catch(r){}}}catch(o){i.e(o)}finally{i.f()}}return e.abrupt("return",Object(Ge["a"])(t));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"parseVehicles",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=[],a=-1,e.next=4,R["forEachAsync"](t,(function(e){var t=e.path,s=e.timestamps,r=e.passengers;a++,n.vehicleLookup[a]=e.id,n.vehicleLookupString[e.id]=a;for(var o=0;o<e.path.length-1;o++)i.push({t0:s[o],t1:s[o+1],p0:t[o],p1:t[o+1],v:a,occ:r[o]})}));case 4:return e.abrupt("return",Object(Ge["a"])(i));case 5:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateDatasetFilters",value:function(){this.traceStart&&this.pathStart&&this.requestStart&&(this.SETTINGS.Routen&&(this.searchEnabled?(this.traceStart.filterAll(),this.traceEnd.filterAll()):(this.traceStart.filter([0,this.simulationTime]),this.traceEnd.filter([this.simulationTime,1/0])),this.$options.traces=this.traces.allFiltered()),this.SETTINGS.Fahrzeuge&&(this.pathStart.filter([0,this.simulationTime]),this.pathEnd.filter([this.simulationTime,1/0]),this.$options.paths=this.paths.allFiltered()),this.SETTINGS["DRT Anfragen"]&&(this.searchEnabled?(this.requestStart.filterAll(),this.requestEnd.filterAll()):(this.requestStart.filter([0,this.simulationTime]),this.requestEnd.filter([this.simulationTime,1/0])),this.$options.drtRequests=this.requests.allFiltered()))}},{key:"animate",value:function(){if(this.myState.isRunning){var e=Date.now()-this.timeElapsedSinceLastFrame;this.timeElapsedSinceLastFrame+=e,this.simulationTime+=e*this.speed*.06,this.updateDatasetFilters(),this.setWallClock(),window.requestAnimationFrame(this.animate)}}},{key:"handleVisibilityChange",value:function(){this.isPausedDueToHiding&&!document.hidden?(console.log("unpausing"),this.isPausedDueToHiding=!1,this.toggleSimulation()):this.myState.isRunning&&document.hidden&&(console.log("pausing"),this.isPausedDueToHiding=!0,this.toggleSimulation())}},{key:"parseRouteTraces",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return 0,i=-1,a=[],e.next=5,R["forEachAsync"](t,(function(e){i++;for(var t=e.timestamps[0],n=e.timestamps[0],s=[],r=function(r){n=e.timestamps[r],e.path[r][0]===e.path[r-1][0]&&e.path[r][1]===e.path[r-1][1]?(s.forEach((function(t){t.t1=e.timestamps[r-1]})),a.push.apply(a,Object($e["a"])(s)),s=[],t=n):s.push({t0:t,p0:e.path[r-1],p1:e.path[r],v:i,occ:e.passengers[r-1]})},o=1;o<e.path.length;o++)r(o);s.forEach((function(e){e.t1=n})),a.push.apply(a,Object($e["a"])(s))}));case 5:return e.abrupt("return",Object(Ge["a"])(a));case 6:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){document.removeEventListener("visibilityChange",this.handleVisibilityChange),M["a"].commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1),this.myState.isRunning=!1}},{key:"loadFiles",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return",{trips:[],drtRequests:{}});case 2:if(t=[],i=[],e.prev=4,!this.vizDetails.drtTrips.endsWith("json")){e.next=13;break}return e.next=8,this.myState.fileApi.getFileJson(this.myState.subfolder+"/"+this.vizDetails.drtTrips);case 8:a=e.sent,t=a.trips,i=a.drtRequests,e.next=31;break;case 13:if(!this.vizDetails.drtTrips.endsWith("gz")){e.next=31;break}return e.next=16,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.drtTrips);case 16:if(n=e.sent,!n){e.next=23;break}return e.next=20,Object(_["a"])(n);case 20:e.t0=e.sent,e.next=24;break;case 23:e.t0=null;case 24:return s=e.t0,e.next=27,R["run"](T.a.inflateAsync(s,{to:"string"}));case 27:r=e.sent,o=JSON.parse(r),t=o.trips,i=o.drtRequests;case 31:e.next=37;break;case 33:e.prev=33,e.t1=e["catch"](4),console.error(e.t1),this.myState.statusMessage=""+e.t1;case 37:return e.abrupt("return",{trips:t,drtRequests:i});case 38:case"end":return e.stop()}}),e,this,[[4,33]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"toggleLoaded",value:function(e){this.isLoaded=e}},{key:"rotateColors",value:function(){this.myState.colorScheme=this.myState.colorScheme===Q["a"].DarkMode?Q["a"].LightMode:Q["a"].DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],It.prototype,"root",void 0),Object(h["a"])([Object(d["b"])({required:!0})],It.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],It.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],It.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["d"])("globalState.authAttempts")],It.prototype,"authenticationChanged",null),Object(h["a"])([Object(d["d"])("globalState.colorScheme")],It.prototype,"swapTheme",null),Object(h["a"])([Object(d["d"])("searchTerm")],It.prototype,"handleSearch",null),It=Object(h["a"])([Object(d["a"])({components:{CollapsiblePanel:E["a"],SettingsPanel:J,LegendColors:P,TripViz:zt,VueSlider:m.a,PlaybackControls:W,ToggleButton:f["ToggleButton"]}})],It),M["a"].commit("registerPlugin",{kebabName:"vehicle-animation",prettyName:"Trip Viewer",description:"Deck.gl based trip viewer",filePatterns:["viz-vehicles*.y?(a)ml"],component:It});var Nt=It,Ht=Nt,Bt=(i("6a19"),Object(U["a"])(Ht,qe,We,!1,null,"428dc5f3",null)),Vt=Bt.exports,Ut=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"xy-hexagons",class:{"hide-thumbnail":!e.thumbnail},attrs:{oncontextmenu:"return false"}},[!e.thumbnail&&e.isLoaded?i("xy-hex-deck-map",{staticClass:"hex-layer",attrs:{props:e.mapProps},on:{hexClick:e.handleHexClick,emptyClick:e.handleEmptyClick}}):e._e(),e.thumbnail?e._e():i("drawing-tool",{staticClass:"drawing-tool"}),e.isLoaded&&!e.thumbnail?i("div",{staticClass:"left-side"},[i("collapsible-panel",{attrs:{direction:"left",locked:!0}},[i("div",{staticClass:"panel-items"},[i("p",{staticClass:"big"},[e._v(e._s(e.vizDetails.title))]),i("p",[e._v(e._s(e.vizDetails.description))])]),e.hexStats?i("div",{staticClass:"panel-items",staticStyle:{color:"#c0f"}},[i("p",{staticClass:"big",staticStyle:{"margin-top":"2rem"}},[e._v(e._s(e.$t("selection"))+":")]),i("h3",{staticStyle:{"margin-top":"-1rem"}},[e._v(e._s(e.$t("areas"))+": "+e._s(e.hexStats.numHexagons)+", "+e._s(e.$t("count"))+": "+e._s(e.hexStats.rows))]),i("button",{staticClass:"button",staticStyle:{color:"#c0f","border-color":"#c0f"},on:{click:e.handleShowSelectionButton}},[e._v(e._s(e.$t("showDetails")))])]):e._e()])],1):e._e(),e.isLoaded&&!e.thumbnail?i("div",{staticClass:"right-side"},[i("collapsible-panel",{attrs:{direction:"right"}},[i("div",{staticClass:"panel-items"},[e._l(Object.keys(e.aggregations),(function(t){return i("div",{key:t,staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v(e._s(t))]),i("div",{staticClass:"buttons has-addons"},e._l(e.aggregations[t],(function(a,n){return i("button",{key:n,staticClass:"button is-small aggregation-button",style:{"margin-bottom":"0.25rem",color:e.activeAggregation===t+"~"+n?"white":e.buttonColors[n],border:"1px solid "+e.buttonColors[n],"border-right":"0.4rem solid "+e.buttonColors[n],"border-radius":"4px","background-color":e.activeAggregation===t+"~"+n?e.buttonColors[n]:e.$store.state.isDarkMode?"#333":"white"},on:{click:function(i){return e.handleOrigDest(t,n)}}},[e._v(e._s(a.title))])})),0)])})),i("div",{staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v(e._s(e.$t("threedee")))]),i("toggle-button",{staticClass:"toggle",attrs:{width:40,value:e.extrudeTowers,labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(t){e.extrudeTowers=!e.extrudeTowers}}})],1),i("div",{staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v(e._s(e.$t("maxHeight"))+": "+e._s(e.maxHeight))]),i("vue-slider",{staticClass:"speed-slider",attrs:{min:50,max:500,interval:25,duration:0,dotSize:16,tooltip:"none"},model:{value:e.maxHeight,callback:function(t){e.maxHeight=t},expression:"maxHeight"}})],1),i("div",{staticClass:"panel-item"},[i("p",{staticClass:"speed-label"},[e._v("Radius: "+e._s(e.radius))]),i("vue-slider",{staticClass:"speed-slider",attrs:{min:50,max:1e3,interval:5,duration:0,dotSize:16,tooltip:"none"},model:{value:e.radius,callback:function(t){e.radius=t},expression:"radius"}})],1)],2)])],1):e._e(),!e.thumbnail&&e.myState.statusMessage?i("div",{staticClass:"message"},[i("p",{staticClass:"status-message"},[e._v(e._s(e.myState.statusMessage))])]):e._e()],1)},qt=[],Wt=i("acee"),$t=Wt["a"],Gt=(i("fbbf"),i("5ad6")),Yt=Object(U["a"])($t,Ut,qt,!1,null,"25390492",null);"function"===typeof Gt["default"]&&Object(Gt["default"])(Yt);var Xt=Yt.exports,Zt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{id:"v3-app"}},[!e.thumbnail&&e.vizDetails.network?a("animation-view",{staticClass:"anim",attrs:{vizState:e.myState,speed:e.speed,fileApi:e.fileApi,subfolder:e.subfolder,yamlConfig:e.yamlConfig,vizDetails:e.vizDetails},on:{loaded:e.toggleLoaded}}):e._e(),e.thumbnail?e._e():a("modal-markdown-dialog",{class:{"is-active":e.showHelp},attrs:{id:"help-dialog",title:"DRT Vehicles",md:"@/assets/animation-helptext.md",buttons:["OK"]},on:{click:function(t){return e.clickedCloseHelp()}}}),e.thumbnail?e._e():a("div",{staticClass:"nav"},[a("p",{staticClass:"big day"},[e._v(e._s(e.vizDetails.title))]),e.myState.statusMessage?a("p",{staticClass:"big time"},[e._v(e._s(e.myState.statusMessage))]):a("p",{staticClass:"big time"},[e._v(e._s(e.myState.clock))])]),a("div",{staticClass:"right-side"},[e.isLoaded?a("div",{staticClass:"morestuff"},[a("vue-slider",{staticClass:"speed-slider",attrs:{data:e.speedStops,duration:0,dotSize:20,tooltip:"active","tooltip-placement":"bottom","tooltip-formatter":function(e){return e+"x"}},model:{value:e.speed,callback:function(t){e.speed=t},expression:"speed"}}),a("p",{staticClass:"speed-label",style:{color:e.textColor.text}},[e._v(e._s(e.speed)+"x speed")])],1):e._e()]),e.isLoaded?a("playback-controls",{staticClass:"playback-stuff",on:{click:e.toggleSimulation}}):e._e(),e.isLoaded?a("div",{staticClass:"extra-buttons"},[a("div",{staticClass:"help-button",attrs:{title:"info"},on:{click:e.clickedHelp}},[a("i",{staticClass:"help-button-text fa fa-1x fa-question"})]),a("img",{staticClass:"theme-button",attrs:{src:i("0386"),title:"dark/light theme"},on:{click:e.rotateColors}})]):e._e()],1)},Kt=[],Jt=(i("b0c0"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"anim-container"}})}),Qt=[],ei=i("9037"),ti=i("5a89"),ii=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(e,a,n){var s;Object(o["a"])(this,i),s=t.call(this),s.tripsPerAgent={},s.midX=a,s.midY=n;for(var r=[],l=[],c=0,u=Object.keys(e);c<u.length;c++){var h=u[c],d=e[h];s.buildWaypoints(d,r,l)}return s.setAttribute("position",new ti["f"](r,3)),s.setAttribute("position2",new ti["f"](l,3)),s}return Object(l["a"])(i,[{key:"buildWaypoints",value:function(e,t,i){var a=e.time.length;if(!(a<2)){var n=0;if(0!==e.time[0]){var s=e.path[0][0]-this.midX,r=e.path[0][1]-this.midY,o=e.time[0];t.push(s,r,0),i.push(s,r,o),n++}for(var l=0;l<a-1;l++){var c=e.path[l][0]-this.midX,u=e.path[l][1]-this.midY,h=e.time[l];t.push(c,u,h);var d=e.path[l+1][0]-this.midX,p=e.path[l+1][1]-this.midY,m=e.time[l+1];i.push(d,p,m),n++}this.tripsPerAgent[e.id]=n}}}]),i}(ti["b"]),ai=ii,ni=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.call(this),e.SIMULATION_PERCENT="sim-percent",e.DRAG="sim-drag",e}return i}(d["c"]);ni=Object(h["a"])([d["a"]],ni);var si,ri,oi,li=new ni,ci=li,ui=Object(U["a"])(ci,si,ri,!1,null,null,null),hi=ui.exports;function di(){return new Worker(i.p+"js/XmlFetcher.worker.bb47ee32.worker.js")}(function(e){e["FetchXML"]="FetchXML"})(oi||(oi={}));var pi=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){return Object(o["a"])(this,i),t.call(this,new di)}return Object(l["a"])(i,[{key:"fetchXML",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(oi.FetchXML,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initialize",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postAsyncWorkerMessage(oe,t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"create",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new i,e.next=3,a.initialize(t);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(ue),mi=function(e){Object(c["a"])(a,e);var t=Object(u["a"])(a);function a(){var e;return Object(o["a"])(this,a),e=t.apply(this,arguments),e.timeFactor=600,e.myState=e.vizState,e.timeDirection=1,e.vertexShader=i("e9b2").default,e.fragmentShader=i("a278").default,e.globalState=M["a"].state,e.colors=e.myState.colorScheme==Q["a"].DarkMode?Q["b"]:Q["c"],e.simulationTime=0,e.animationTimeSinceUnpaused=0,e.clock=new ti["c"](!1),e.nextClockUpdateTime=0,e.scene=new ti["p"],e.renderer=new ti["y"]({antialias:!0}),e.network={nodes:{},links:{}},e.OrbitControl=i("d1f5"),e.linkMaterial=new ti["i"]({color:e.colors.links}),e.xRange=[1e25,-1e25],e.yRange=[1e25,-1e25],e.midpointX=36e4,e.midpointY=5715e3,e.tripList={},e.wasSimulationRunning=!0,e.networkLayers=[],e.tempStreamBuffer="",e}return Object(l["a"])(a,[{key:"speedChanged",value:function(){this.myState.isRunning=!0;var e=this.speed<0?-1:1;e!==this.timeDirection&&(this.clock.stop(),this.clock=new ti["c"](!1),this.timeDirection=e,this.clock.start(),this.animationTimeSinceUnpaused=0,requestAnimationFrame(this.moveCameraWhilePaused),console.log("done flip"))}},{key:"playPauseSim",value:function(){this.myState.isRunning?(this.clock.start(),requestAnimationFrame(this.animate)):(this.clock.stop(),this.clock=new ti["c"](!1),this.animationTimeSinceUnpaused=0,requestAnimationFrame(this.moveCameraWhilePaused))}},{key:"switchColorScheme",value:function(e){this.colors=e==Q["a"].LightMode?Q["c"]:Q["b"],this.scene.background=new ti["d"](this.colors.background);var t=this.scene.getObjectByName("network");t&&this.scene.remove(t),this.linkMaterial.dispose(),this.linkMaterial=new ti["i"]({color:this.colors.links});var i,a=Object(s["a"])(this.networkLayers);try{for(a.s();!(i=a.n()).done;){var n=i.value,r=n.name,o=this.scene.getObjectByName(r);o&&this.scene.remove(o);var l=new ti["j"](n.geometry,this.linkMaterial);l.name=r,this.scene.add(l)}}catch(c){a.e(c)}finally{a.f()}}},{key:"mounted",value:function(){this.setInitialClockTime(),this.setupSimulation(),this.setupDragListener(),window.addEventListener("resize",this.onWindowResize,!1),document.addEventListener("visibilitychange",this.handleVisibilityChange,!1)}},{key:"setInitialClockTime",value:function(){var e=""+this.$route.query.start;if(e&&NaN!=parseInt(e)){var t=parseInt(e);t>=0&&(this.simulationTime=t,this.setVisibleClock(),this.$nextTick())}}},{key:"handleVisibilityChange",value:function(){console.log("window visibility changed!! hidden:",document.hidden)}},{key:"setupDragListener",value:function(){var e=this;hi.$on(hi.DRAG,(function(t){-1===t?(e.wasSimulationRunning=e.myState.isRunning,e.myState.isRunning=!1):-2===t?e.myState.isRunning=e.wasSimulationRunning:(e.simulationTime=e.nextClockUpdateTime=t,e.animate())}))}},{key:"exitSimulation",value:function(){this.clock=new ti["c"](!1),this.simulationTime=0,this.nextClockUpdateTime=0,this.timeDirection=1;while(this.scene.children.length)this.scene.remove(this.scene.children[0])}},{key:"beforeDestroy",value:function(){this.exitSimulation(),window.removeEventListener("resize",this.onWindowResize),document.removeEventListener("visibilityChange",this.handleVisibilityChange),hi.$off(hi.DRAG),this.agentMaterial&&this.agentMaterial.dispose(),this.agentGeometry&&this.agentGeometry.dispose();var e,t=Object(s["a"])(this.networkLayers);try{for(t.s();!(e=t.n()).done;){var i=e.value;i.geometry.dispose()}}catch(a){t.e(a)}finally{t.f()}this.linkMaterial.dispose()}},{key:"onWindowResize",value:function(){if(this.container=document.getElementById("anim-container"),this.container&&this.camera){this.renderer.domElement;this.camera.aspect=this.container.clientWidth/this.container.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight)}}},{key:"setupSimulation",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.initScene(),this.myState.statusMessage="loading agents",e.next=4,this.loadTrips();case 4:return this.finishedLoadingTrips(),e.next=7,this.addNetworkToScene();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"startSimulation",value:function(){this.$emit("loaded",!0),this.myState.isShowingHelp||(this.clock.start(),this.animate(),this.myState.isRunning=!0)}},{key:"networkLayerAdder",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,i,a){var n,s,r,o,l,c,u,h,d,p,m,f,v,g,b,y=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=2e4,!(a>i.length)){e.next=5;break}return this.myState.statusMessage="",this.startSimulation(),e.abrupt("return");case 5:for(s=[],r=a,o=a+n>i.length?i.length:a+n,l=0,c=r;c<o;c++)u=i[c],h=t[u.from],d=t[u.to],h&&d?(p=new ti["x"](h.x,h.y,0),m=new ti["x"](d.x,d.y,0),f=(new ti["b"]).setFromPoints([p,m]),s.push(f)):(l++,l<20&&console.log({badlink:u}));v=ei["a"].mergeBufferGeometries(s),g=new ti["j"](v,this.linkMaterial),g.name="network"+a,this.scene.add(g),this.camera&&this.renderer.render(this.scene,this.camera),this.networkLayers.push(g),v.dispose(),b=a+n,setTimeout((function(){y.networkLayerAdder(t,i,b)}),1);case 19:case"end":return e.stop()}}),e,this)})));function t(t,i,a){return e.apply(this,arguments)}return t}()},{key:"createNodesAndLinksFromXML",value:function(e){var t,i=e,a=i.network.nodes[0].node,n=i.network.links[0].link,r=Object(s["a"])(a);try{for(r.s();!(t=r.n()).done;){var o=t.value,l=o.$;l.x=parseFloat(l.x),l.y=parseFloat(l.y),this.network.nodes[l.id]=l}}catch(p){r.e(p)}finally{r.f()}var c,u=Object(s["a"])(n);try{for(u.s();!(c=u.n()).done;){var h=c.value,d=h.$;this.network.links[d.id]=d}}catch(p){u.e(p)}finally{u.f()}}},{key:"addNetworkToScene",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.statusMessage="loading network",this.networkLayers=[],e.prev=2,this.myState.fileSystem){e.next=5;break}return e.abrupt("return");case 5:return console.log({vizDetails:this.vizDetails}),e.next=8,pi.create({fileApi:this.myState.fileSystem.url,filePath:this.myState.subfolder+"/"+this.vizDetails.network});case 8:return this._roadFetcher=e.sent,e.next=11,this._roadFetcher.fetchXML();case 11:for(a in t=e.sent,this._roadFetcher.destroy(),console.log({xml:t}),this.createNodesAndLinksFromXML(t),i={},this.network.nodes)n=this.network.nodes[a],i[a]={x:n.x-this.midpointX,y:n.y-this.midpointY};this.networkLayerAdder(i,Object.values(this.network.links),0),e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](2),console.error({e:e.t0}),this.myState.statusMessage=""+e.t0;case 24:case"end":return e.stop()}}),e,this,[[2,20]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadTrips",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.tripList={},e.prev=1,e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.vizDetails.drtTrips);case 4:t=e.sent,i=Object(s["a"])(t.split("\n"));try{for(i.s();!(a=i.n()).done;)n=a.value,n&&(r=JSON.parse(n),this.tripList[r.id]=r)}catch(o){i.e(o)}finally{i.f()}e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),this.myState.fileSystem&&this.myState.fileSystem.need_password&&401===e.t0.status&&M["a"].commit("requestLogin",this.myState.fileSystem.url);case 12:case"end":return e.stop()}}),e,this,[[1,9]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"finishedLoadingTrips",value:function(){this.agentGeometry&&this.agentGeometry.dispose(),this.agentGeometry=new ai(this.tripList,this.midpointX,this.midpointY),this.agentMaterial||(this.agentMaterial=new ti["q"]({uniforms:{simulationTime:{value:0},colorLinks:{value:new ti["d"](this.colors.links)}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,blending:ti["l"],depthTest:!0,transparent:!0}));var e=new ti["n"](this.agentGeometry,this.agentMaterial);e.name="agents";var t=this.scene.getObjectByName("agents");t&&this.scene.remove(t),this.scene.add(e),this.camera&&this.renderer.render(this.scene,this.camera),this.myState.statusMessage="loading network"}},{key:"initScene",value:function(){if(this.container=document.getElementById("anim-container"),this.container){this.scene.background=new ti["d"](this.colors.background),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.container.appendChild(this.renderer.domElement);var e=1,t=1e5;this.camera=new ti["m"](170,this.container.clientWidth/this.container.clientHeight,e,t),this.cameraControls=new this.OrbitControl.MapControls(this.camera,this.renderer.domElement),this.cameraControls.enablePan=!0,this.cameraControls.screenSpacePanning=!0,this.cameraControls.enableZoom=!0,this.cameraControls.enableRotate=!1,this.camera.position.set(0,0,750),this.camera.lookAt(0,0,-1),this.cameraControls.update(),this.renderer.render(this.scene,this.camera)}}},{key:"moveCameraWhilePaused",value:function(){this.camera&&(this.myState.isRunning||(this.renderer.render(this.scene,this.camera),this.cameraControls.update(),requestAnimationFrame(this.moveCameraWhilePaused)))}},{key:"setVisibleClock",value:function(){var e=Math.floor(this.simulationTime/3600),t=Math.floor(this.simulationTime/60)%60;this.myState.clock=(e<10?"0":"")+e+(t<10?":0":":")+t}},{key:"animate",value:function(){var e=this.clock.getElapsedTime(),t=this.timeFactor*this.speed*(e-this.animationTimeSinceUnpaused);this.animationTimeSinceUnpaused=e,this.simulationTime=this.simulationTime+t,this.simulationTime<0&&(this.myState.isRunning=!1,this.simulationTime=0),this.agentMaterial&&(this.agentMaterial.uniforms["simulationTime"].value=this.simulationTime),this.simulationTime*this.timeDirection>=this.nextClockUpdateTime*this.timeDirection&&(this.setVisibleClock(),this.nextClockUpdateTime+=60*this.timeDirection,hi.$emit(hi.SIMULATION_PERCENT,this.simulationTime/86400)),this.camera&&this.renderer.render(this.scene,this.camera),this.cameraControls.update(),this.myState.isRunning&&requestAnimationFrame(this.animate)}}]),a}(d["c"]);Object(h["a"])([Object(d["b"])({required:!1})],mi.prototype,"fileApi",void 0),Object(h["a"])([Object(d["b"])({required:!1})],mi.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],mi.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],mi.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["b"])({required:!0})],mi.prototype,"speed",void 0),Object(h["a"])([Object(d["b"])({required:!0})],mi.prototype,"vizState",void 0),Object(h["a"])([Object(d["b"])({required:!0})],mi.prototype,"vizDetails",void 0),Object(h["a"])([Object(d["d"])("speed")],mi.prototype,"speedChanged",null),Object(h["a"])([Object(d["d"])("myState.isRunning")],mi.prototype,"playPauseSim",null),Object(h["a"])([Object(d["d"])("myState.colorScheme")],mi.prototype,"switchColorScheme",null),mi=Object(h["a"])([d["a"]],mi);var fi=mi,vi=fi,gi=(i("4714"),Object(U["a"])(vi,Jt,Qt,!1,null,"dd0ec610",null)),bi=gi.exports,yi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"modal"},[i("div",{staticClass:"modal-background"}),i("div",{staticClass:"modal-card"},[i("header",{staticClass:"modal-card-head"},[i("p",{staticClass:"modal-card-title"},[e._v(e._s(e.title))]),i("button",{staticClass:"delete",attrs:{"aria-label":"close"},on:{click:function(t){return e.clicked("close")}}})]),i("section",{staticClass:"modal-card-body"},[i("div",{staticClass:"content"},[i("div",{staticClass:"my-html",domProps:{innerHTML:e._s(e.html)}})])]),i("footer",{staticClass:"modal-card-foot"},[1==e.buttons.length?i("button",{staticClass:"button is-link",on:{click:function(t){return e.clicked(e.buttons[0])}}},[e._v(e._s(e.buttons[0]))]):e._e(),e._l(e.buttons.slice(1),(function(t){return i("button",{key:t,staticClass:"button",on:{click:function(i){return e.clicked(t)}}},[e._v(e._s(t))])}))],2)])])},ki=[],Si=function(e){Object(c["a"])(a,e);var t=Object(u["a"])(a);function a(){var e;return Object(o["a"])(this,a),e=t.apply(this,arguments),e.html="",e}return Object(l["a"])(a,[{key:"mounted",value:function(){this.html=i("818f")}},{key:"clicked",value:function(e){this.$emit("click",e)}}]),a}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],Si.prototype,"title",void 0),Object(h["a"])([Object(d["b"])({required:!0})],Si.prototype,"md",void 0),Object(h["a"])([Object(d["b"])({required:!0})],Si.prototype,"buttons",void 0),Si=Object(h["a"])([Object(d["a"])({components:{},props:{}})],Si);var wi=Si,Oi=wi,Ci=(i("a722"),Object(U["a"])(Oi,yi,ki,!1,null,"5b9cdc97",null)),ji=Ci.exports,xi=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.vizDetails={network:"",drtTrips:"",projection:"",title:"",description:"",thumbnail:""},e.myState={statusMessage:"",clock:"00:00",colorScheme:Q["a"].DarkMode,isRunning:!1,isShowingHelp:!1,fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.globalState=M["a"].state,e.isDarkMode=e.myState.colorScheme===Q["a"].DarkMode,e.isLoaded=!1,e.showHelp=!1,e.speedStops=[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],e.speed=1,e.legendBits=[],e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e}return Object(l["a"])(i,[{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Pe["a"](t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"generateBreadcrumbs",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,o,l,c,u,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.slug}],i=this.myState.subfolder.split("/"),a="/",n=Object(s["a"])(i),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(o=r.value,o){e.next=12;break}return e.abrupt("continue",14);case 12:a+=o+"/",t.push({label:o,url:"/"+this.myState.fileSystem.slug+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:l=e.sent,c=y.a.parse(l),c.title&&(u=t.pop(),h=u?u.url:"/",t.push({label:c.title,url:h})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),M["a"].commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"getFileSystem",value:function(e){var t=this.$store.state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=y.a.parse(t),e.next=11;break;case 7:e.prev=7,e.t0=e["catch"](0),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.needPassword&&401===e.t0.status&&M["a"].commit("requestLogin",this.myState.fileSystem.slug);case 11:i=this.vizDetails.title?this.vizDetails.title:"Agent Animation",this.$emit("title",i),this.buildThumbnail();case 14:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,g.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.myState.colorScheme===Q["a"].DarkMode,this.updateLegendColors()}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"updateLegendColors",value:function(){var e=this.myState.colorScheme==Q["a"].LightMode?Q["c"]:Q["b"];this.legendBits=[{label:"susceptible",color:e.susceptible},{label:"latently infected",color:e.infectedButNotContagious},{label:"contagious",color:e.contagious},{label:"symptomatic",color:e.symptomatic},{label:"seriously ill",color:e.seriouslyIll},{label:"critical",color:e.critical},{label:"recovered",color:e.recovered}]}},{key:"textColor",get:function(){var e={text:"#3498db",bg:"#eeeef480"},t={text:"white",bg:"#181518aa"};return this.myState.colorScheme===Q["a"].DarkMode?t:e}},{key:"toggleSimulation",value:function(){this.myState.isRunning=!this.myState.isRunning,this.myState.isRunning&&0===this.speed&&(this.speed=1)}},{key:"mounted",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return M["a"].commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:this.generateBreadcrumbs(),this.showHelp=!1,this.updateLegendColors();case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){M["a"].commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1),this.myState.isRunning=!1}},{key:"clickedHelp",value:function(){console.log("HEEELP!"),this.myState.isRunning=!1,this.showHelp=!0,this.myState.isShowingHelp=this.showHelp}},{key:"clickedCloseHelp",value:function(){this.showHelp=!1,this.myState.isShowingHelp=this.showHelp,this.myState.isRunning=!0}},{key:"toggleLoaded",value:function(e){this.isLoaded=e}},{key:"rotateColors",value:function(){this.myState.colorScheme=this.myState.colorScheme===Q["a"].DarkMode?Q["a"].LightMode:Q["a"].DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!1})],xi.prototype,"fileApi",void 0),Object(h["a"])([Object(d["b"])({required:!1})],xi.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],xi.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],xi.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["d"])("globalState.authAttempts")],xi.prototype,"authenticationChanged",null),Object(h["a"])([Object(d["d"])("state.colorScheme")],xi.prototype,"swapTheme",null),xi=Object(h["a"])([Object(d["a"])({components:{AnimationView:bi,ModalMarkdownDialog:ji,PlaybackControls:W,VueSlider:m.a,ToggleButton:f["ToggleButton"]}})],xi),M["a"].commit("registerPlugin",{kebabName:"agent-animation",prettyName:"Agent Animation",description:"birds",filePatterns:["viz-agent-anim*.y?(a)ml"],component:xi});var Ti=xi,_i=Ti,Ri=(i("be4d"),Object(U["a"])(_i,Zt,Kt,!1,null,"e219885c",null)),Mi=Ri.exports,Ai=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"gl-viz",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[e.thumbnail?e._e():i("link-deck-map",{staticClass:"anim",attrs:{props:e.mapProps}}),e.thumbnail?e._e():i("drawing-tool"),e.thumbnail?e._e():i("div",{staticClass:"left-side"},[i("collapsible-panel",{attrs:{darkMode:e.isDarkMode,locked:!0,direction:"left"}},[i("div",{staticClass:"panel-items"},[i("div",{staticClass:"panel-item"},[i("h3",[e._v(e._s(e.vizDetails.title))]),i("p",[e._v(e._s(e.vizDetails.description))])]),i("div",{staticClass:"panel-item"},[i("config-panel",{attrs:{header:e.csvData.header,activeColumn:e.csvData.activeColumn,scaleWidth:e.scaleWidth,selectedColorRamp:e.selectedColorRamp,csvData:e.csvData,useSlider:e.vizDetails.useSlider},on:{colors:e.clickedColorRamp,column:e.handleNewDataColumn,slider:e.handleNewDataColumn,scale:e.handleScaleWidthChanged}})],1),e.csvBase.header.length?i("div",{staticClass:"panel-item diff-section"},[i("p",[i("b",[e._v(e._s(e.$t("showDiffs")))])]),i("toggle-button",{staticClass:"toggle",attrs:{width:40,value:e.showDiffs,labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(t){e.showDiffs=!e.showDiffs}}})],1):e._e()])])],1),!e.thumbnail&&e.myState.statusMessage?i("div",{staticClass:"nav"},[i("p",{staticClass:"status-message"},[e._v(e._s(e.myState.statusMessage))])]):e._e()],1)},Di=[],Ei=(i("5319"),i("cb29"),i("a434"),i("369b")),Li=i.n(Ei),Fi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.timeSlider,!1))],1)},Pi=[],zi=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.sliderValue=e.stops[0]||"...",e.timeSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,adsorb:!0,marks:e.stops.filter((function(e,t){return t%6===0})),contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},"tooltip-placement":"bottom",data:e.stops},e}return Object(l["a"])(i,[{key:"changeUseRange",value:function(e){this.sliderValue=e?[this.stops[0],this.stops[this.stops.length-1]]:[this.stops[0]],console.log("changed to: "+this.sliderValue)}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])()],zi.prototype,"useRange",void 0),Object(h["a"])([Object(d["b"])({required:!0})],zi.prototype,"stops",void 0),Object(h["a"])([Object(d["d"])("useRange")],zi.prototype,"changeUseRange",null),Object(h["a"])([Object(d["d"])("sliderValue")],zi.prototype,"sliderChangedEvent",null),zi=Object(h["a"])([Object(d["a"])({components:{"vue-slider":m.a}})],zi);var Ii=zi,Ni=Ii,Hi=(i("3432"),Object(U["a"])(Ni,Fi,Pi,!1,null,"0b2d8627",null)),Bi=Hi.exports,Vi=function(){var e=this,t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"config-panel"},[t.useSlider?a("div",{staticClass:"panel-item"},[a("p",[a("b",[t._v(t._s(t.$t("timeOfDay")))])]),t.activeColumn<0?a("button",{staticClass:"button full-width is-warning is-loading",attrs:{"aria-haspopup":"true","aria-controls":"dropdown-menu-column-selector"}}):a("time-slider",{staticClass:"time-slider",attrs:{useRange:!1,stops:t.csvData.header},on:{change:t.debounceTimeSlider}})],1):t._e(),t.useSlider?t._e():a("div",{staticClass:"panel-item"},[a("p",[a("b",[t._v(t._s(t.$t("selectColumn")))])]),a("div",{staticClass:"dropdown full-width",class:{"is-active":t.isButtonActive}},[a("div",{staticClass:"dropdown-trigger"},[a("button",{staticClass:"full-width is-warning button",class:{"is-loading":t.activeColumn<0},attrs:{"aria-haspopup":"true","aria-controls":"dropdown-menu-column-selector"},on:{click:t.handleClickDropdown}},[a("b",[t._v(t._s(t.buttonTitle))]),t._m(0)])]),a("div",{staticClass:"dropdown-menu",style:{"max-height":"24rem","overflow-y":"auto",border:"1px solid #ccc"},attrs:{id:"dropdown-menu-column-selector",role:"menu"}},[a("div",{staticClass:"dropdown-content"},t._l(t.header,(function(e){return a("a",{staticClass:"dropdown-item",on:{click:function(i){return t.handleSelectColumn(e)}}},[t._v(t._s(e))])})),0)])])]),a("div",{staticClass:"panel-item",class:{"vert-space":!t.useSlider}},[a("p",[a("b",[t._v(t._s(t.$t("bandwidths")))])]),a("div",{staticClass:"options",staticStyle:{display:"flex","flex-direction":"column"}},[a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.scaleWidthValue,expression:"scaleWidthValue",modifiers:{number:!0}}],staticClass:"input",domProps:{value:t.scaleWidthValue},on:{input:function(e){e.target.composing||(t.scaleWidthValue=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})])]),t.activeColumn>-1?a("div",{staticClass:"panel-item color-picker"},[a("p",[a("b",[t._v(t._s(t.$t("colors"))),a("div",{staticClass:"dropdown full-width",class:{"is-active":t.isColorButtonActive}},[a("div",{staticClass:"dropdown-trigger"},[a("img",{staticClass:"color-button",style:[t.isDarkMode?{transform:"scaleX(1)"}:{transform:"scaleX(-1)"}],attrs:{src:"/colors/scale-"+t.selectedColorRamp+".png"},on:{click:function(){return e.isColorButtonActive=!e.isColorButtonActive}}})]),a("div",{staticClass:"dropdown-menu",attrs:{id:"dropdown-menu-color-selector",role:"menu"}},[a("div",{staticClass:"dropdown-content",style:{padding:"0 0"}},t._l(Object.keys(t.colorRamps),(function(e){return a("a",{staticClass:"dropdown-item",style:{padding:"0.25rem 0.25rem"},on:{click:function(i){return t.handleColorRamp(e)}}},[a("img",{staticClass:"swapColor",style:[t.isDarkMode?{transform:"scaleX(1)"}:{transform:"scaleX(-1)"}],attrs:{src:"/colors/scale-"+e+".png"}}),a("p",{style:{lineHeight:"1rem",marginBottom:"0.25rem"}},[t._v(t._s(e))])])})),0)])])])])]):t._e()])},Ui=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"icon is-small"},[i("i",{staticClass:"fas fa-angle-down",attrs:{"aria-hidden":"true"}})])}],qi=i("b012"),Wi=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.isButtonActive=!1,e.isColorButtonActive=!1,e.scaleWidthValue="250",e.colorRamps={viridis:{png:"scale-viridis.png"},inferno:{png:"scale-inferno.png"},bluered:{png:"scale-salinity.png",diff:!0},picnic:{png:"scale-picnic.png"}},e.globalState=M["a"].state,e.isDarkMode=e.globalState.colorScheme===Q["a"].DarkMode,e.debounceScale=Object(qi["debounce"])(e.gotNewScale,500),e.debounceTimeSlider=Object(qi["debounce"])(e.changedTimeSlider,250),e}return Object(l["a"])(i,[{key:"mounted",value:function(){this.scaleWidthValue=""+this.scaleWidth}},{key:"handleScaleChanged",value:function(){isNaN(parseFloat(this.scaleWidthValue))||this.debounceScale()}},{key:"changeColorForDarkMode",value:function(){var e;if(this.isDarkMode?document.getElementsByClassName("color-button")[0].style.transform="scaleX(1)":document.getElementsByClassName("color-button")[0].style.transform="scaleX(-1)",this.isDarkMode)for(e=0;e<document.getElementsByClassName("swapColor").length;e++)document.getElementsByClassName("swapColor")[e].style.transform="scaleX(1)";else for(e=0;e<document.getElementsByClassName("swapColor").length;e++)document.getElementsByClassName("swapColor")[e].style.transform="scaleX(-1)"}},{key:"swapTheme",value:function(){this.isDarkMode=this.globalState.colorScheme===Q["a"].DarkMode,this.changeColorForDarkMode()}},{key:"gotNewScale",value:function(){this.$emit("scale",parseFloat(this.scaleWidthValue))}},{key:"changedTimeSlider",value:function(e){console.log("new slider!",e),e.length&&1===e.length&&(e=e[0]),this.$emit("slider",e)}},{key:"buttonTitle",get:function(){return-1===this.activeColumn?this.$i18n.t("loading"):this.header[this.activeColumn]}},{key:"handleClickDropdown",value:function(){this.isButtonActive=!this.isButtonActive}},{key:"handleColorRamp",value:function(e){console.log(e),this.isColorButtonActive=!1,this.$emit("colors",e)}},{key:"clearDropdown",value:function(){console.log("boop"),this.isButtonActive=!1}},{key:"handleSelectColumn",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("panel: selected",t),this.isButtonActive=!1,this.$emit("column",t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],Wi.prototype,"activeColumn",void 0),Object(h["a"])([Object(d["b"])({required:!0})],Wi.prototype,"header",void 0),Object(h["a"])([Object(d["b"])({required:!0})],Wi.prototype,"scaleWidth",void 0),Object(h["a"])([Object(d["b"])({required:!0})],Wi.prototype,"csvData",void 0),Object(h["a"])([Object(d["b"])({required:!0})],Wi.prototype,"useSlider",void 0),Object(h["a"])([Object(d["b"])({required:!0})],Wi.prototype,"selectedColorRamp",void 0),Object(h["a"])([Object(d["d"])("scaleWidthValue")],Wi.prototype,"handleScaleChanged",null),Object(h["a"])([Object(d["d"])("globalState.colorScheme")],Wi.prototype,"swapTheme",null),Wi=Object(h["a"])([Object(d["a"])({components:{TimeSlider:Bi}})],Wi);var $i=Wi,Gi=$i,Yi=(i("580a"),i("c450")),Xi=Object(U["a"])(Gi,Vi,Ui,!1,null,"736e8003",null);"function"===typeof Yi["default"]&&Object(Yi["default"])(Xi);var Zi,Ki=Xi.exports,Ji=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"map",attrs:{id:e.mapID}})},Qi=[],ea=i("6b0f"),ta=i("fa45");(function(e){e[e["offset"]=0]="offset",e[e["coordFrom"]=1]="coordFrom",e[e["coordTo"]=2]="coordTo"})(Zi||(Zi={}));var ia=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.mapID="map-id-".concat(Math.floor(1e12*Math.random())),e.colorPaleGrey=e.props.dark?[80,80,80,80]:[212,212,212,80],e.colorInvisible=[0,0,0,0],e.getLineColor=function(t,i){var a=e.props.buildData[t[Zi.offset]];if(!a)return e.colorPaleGrey;if(e.props.showDiffs){var n=e.props.baseData[t[Zi.offset]],s=a-n;return 0===s?0:n<a?e.color1:e.color0}var r=Math.log(a)/Math.log(e.props.build.headerMax[e.props.build.activeColumn]);return r<1e-4?e.colorPaleGrey:i(r)},e.getLineWidth=function(t){var i=e.props.buildData[t[Zi.offset]];if(e.props.showDiffs){var a=e.props.baseData[t[Zi.offset]],n=Math.abs(i-a);return n/e.props.scaleWidth}return i/e.props.scaleWidth},e}return Object(l["a"])(i,[{key:"viewState",get:function(){return this.$store.state.viewState}},{key:"viewMoved",value:function(){this.layerManager.deckInstance.setProps({viewState:this.viewState})}},{key:"swapTheme",value:function(){this.layerManager.updateStyle()}},{key:"handlePropsChanged",value:function(){this.layerManager&&this.updateLayers()}},{key:"mounted",value:function(){console.log(this.mapID),this.setupLayerManager(),this.updateLayers()}},{key:"beforeDestroy",value:function(){this.layerManager.destroy()}},{key:"setupLayerManager",value:function(){var e=this;this.layerManager=new ta["a"],this.layerManager.init({container:"#".concat(this.mapID),viewState:this.$store.state.viewState,pickingRadius:3,mapStyle:this.props.dark?Q["f"].dark:Q["f"].light,getTooltip:this.getTooltip,onViewStateChange:function(t){var i=t.viewState;e.$store.commit("setMapCamera",i)}})}},{key:"getTooltip",value:function(e){var t=e.object,i=e.x,a=e.y;if(!t)return null;var n=this.props.buildData[t[Zi.offset]],s=0,r=void 0;if(this.props.showDiffs)s=this.props.baseData[t[Zi.offset]],r=n-s;else if(void 0===n)return null;var o=s?"<p>+/- Base: ".concat(r,"</p>"):"";return{html:'<div class="tooltip">\n              <big><b>'.concat(this.props.build.header[this.props.build.activeColumn],"</b></big>\n              <p>").concat(n,"</p>\n              ").concat(o,"\n             </div>"),style:{backgroundColor:this.props.dark?"#445":"white",color:this.props.dark?"white":"#222",padding:"1rem 1rem",position:"absolute",left:i+4,top:a-80,boxShadow:"0px 2px 10px #22222266"}}}},{key:"calculateColorRamp",value:function(){var e=O()({colormap:this.props.colors,nshades:20,format:"rba"}).map((function(e){return[e[0],e[1],e[2],255]})),t=Object(ea["a"])().domain(new Array(20).fill(0).map((function(e,t){return.05*t}))).range(e).range(this.props.dark?e:e.reverse());return this.colorPaleGrey=this.props.dark?[80,80,80,40]:[212,212,212,40],this.colorInvisible=[0,0,0,0],this.color0=t(0),this.color1=t(1),t}},{key:"updateLayers",value:function(){var e=this,t=this.calculateColorRamp();this.layerManager.removeLayer("link-bandwidths"),this.layerManager.addLayer(new _t["a"]({id:"link-bandwidths",data:this.props.geojson,widthUnits:"pixels",widthMinPixels:0,widthMaxPixels:200,pickable:!0,autoHighlight:!0,opacity:1,parameters:{depthTest:!1},getSourcePosition:function(e){return e[Zi.coordFrom]},getTargetPosition:function(e){return e[Zi.coordTo]},getColor:function(i){return e.getLineColor(i,t)},getWidth:this.getLineWidth,updateTriggers:{getColor:{data:this.props.buildData,showDiffs:this.props.showDiffs,dark:this.props.dark,colors:this.props.colors,activeColumn:this.props.build.activeColumn},getWidth:{showDiffs:this.props.showDiffs,scaleWidth:this.props.scaleWidth,activeColumn:this.props.build.activeColumn}},transitions:{getColor:350,getWidth:350}}))}},{key:"renderTooltip",value:function(e){var t=e.hoverInfo;console.log("heloo");t.object;var i=t.x,a=t.y;return{text:"ye",html:"hello",style:{backgroundColor:this.props.dark?"#445":"white",color:this.props.dark?"white":"#222",padding:"1rem 1rem",position:"absolute",left:i+4,top:a-80,zIndex:100,boxShadow:"0px 2px 10px #22222266"}}}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],ia.prototype,"props",void 0),Object(h["a"])([Object(d["d"])("viewState")],ia.prototype,"viewMoved",null),Object(h["a"])([Object(d["d"])("props.dark")],ia.prototype,"swapTheme",null),Object(h["a"])([Object(d["d"])("props")],ia.prototype,"handlePropsChanged",null),ia=Object(h["a"])([Object(d["a"])({components:{}})],ia);var aa=ia,na=aa,sa=(i("8668"),Object(U["a"])(na,Ji,Qi,!1,null,"be0c871e",null)),ra=sa.exports,oa=i("7339"),la=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.buildColumnValues=[],e.baseColumnValues=[],e.mapState={center:[0,0],zoom:10,bearing:0,pitch:20},e.isButtonActiveColumn=!1,e.scaleWidth=250,e.showDiffs=!1,e.showTimeRange=!1,e.geojsonData=[],e.selectedColorRamp="viridis",e.vizDetails={title:"",description:"",csvFile:"",csvBase:"",useSlider:!1,shpFile:"",dbfFile:"",geojsonFile:"",projection:"",scaleFactor:1,thumbnail:"",sum:!1},e.myState={statusMessage:"",fileApi:void 0,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.csvData={header:[],headerMax:[],rows:new Float32Array,activeColumn:-1},e.csvBase={header:[],headerMax:[],rows:new Float32Array,activeColumn:-1},e.buildData=new Float32Array,e.baseData=new Float32Array,e.linkOffsetLookup={},e.numLinks=0,e.isDarkMode=e.$store.state.colorScheme===Q["a"].DarkMode,e.isLoaded=!1,e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.csvFilesToLoad=[],e}return Object(l["a"])(i,[{key:"mapProps",get:function(){return{geojson:this.geojsonData,buildData:this.buildData,baseData:this.baseData,showDiffs:this.showDiffs,colors:this.selectedColorRamp,scaleWidth:this.scaleWidth,dark:this.isDarkMode,build:this.csvData}}},{key:"buildFileApi",value:function(){var e=this.getFileSystem(this.root);this.myState.fileApi=new Pe["a"](e),this.myState.fileSystem=e}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"getFileSystem",value:function(e){var t=this.$store.state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 5:t=e.sent,this.vizDetails=y.a.parse(t),e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](2),console.log("failed"),this.myState.fileSystem&&this.myState.fileSystem.needPassword&&401===e.t0.status&&this.$store.commit("requestLogin",this.myState.fileSystem.slug);case 13:i=this.vizDetails.title?this.vizDetails.title:"Network Links",this.$emit("title",i);case 15:case"end":return e.stop()}}),e,this,[[2,9]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return");case 2:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=17;break}return e.prev=3,e.next=6,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 6:return t=e.sent,e.next=9,g.a.arraybuffer(t);case 9:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](3),console.error(e.t0);case 17:case"end":return e.stop()}}),e,this,[[3,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.$store.state.colorScheme===Q["a"].DarkMode}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"buttonTitle",get:function(){return-1===this.csvData.activeColumn?"Loading...":this.csvData.header[this.csvData.activeColumn]}},{key:"clickedColorRamp",value:function(e){this.selectedColorRamp=e}},{key:"handleScaleWidthChanged",value:function(e){this.scaleWidth=e}},{key:"handleNewDataColumn",value:function(e){console.log("handling column:",e);var t=this.csvData.header.indexOf(e);if(-1!==t){if(!this.csvData.headerMax[t]){var i=0;this.buildColumnValues[t].forEach((function(e){return i=Math.max(i,e)})),i&&(this.csvData.headerMax[t]=i)}this.buildData=this.buildColumnValues[t],this.baseData=this.baseColumnValues[t],this.csvData.activeColumn=t,this.isButtonActiveColumn=!1}}},{key:"findCenter",value:function(e){return[13.45,52.53]}},{key:"mounted",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$store.commit("setFullScreen",!this.thumbnail),this.buildFileApi(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:return this.myState.statusMessage="Dateien laden...",e.next=9,this.loadGeojsonFeatures();case 9:if(t=e.sent,t){e.next=12;break}return e.abrupt("return");case 12:this.geojsonData=t,this.isLoaded=!0,this.mapState.center=this.findCenter([]),this.buildThumbnail(),this.myState.statusMessage="",this.loadCSVFiles();case 18:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadGeojsonFeatures",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,this.linkOffsetLookup={},this.numLinks=0,this.myState.statusMessage="Loading network...",t="/".concat(this.myState.subfolder,"/").concat(this.vizDetails.geojsonFile),e.next=9,this.myState.fileApi.getFileText(t);case 9:for(i=e.sent,a=JSON.parse(i),this.numLinks=a.features.length,n=[],s=0;s<this.numLinks;s++)r=a.features[s],o=[s,r.geometry.coordinates[0],r.geometry.coordinates[1]],n.push(o),this.linkOffsetLookup[r.properties.id]=s;return e.abrupt("return",n);case 17:return e.prev=17,e.t0=e["catch"](2),this.myState.statusMessage=""+e.t0,this.$store.commit("setStatus",{type:Q["g"].WARNING,msg:"Could not find: ".concat(this.myState.subfolder,"/").concat(this.vizDetails.geojsonFile)}),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,this,[[2,17]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){this.$store.commit("setFullScreen",!1)}},{key:"handleClickColumnSelector",value:function(){console.log("click!"),this.isButtonActiveColumn=!this.isButtonActiveColumn}},{key:"loadCSVFiles",value:function(){this.myState.statusMessage="Loading CSV data...",this.csvFilesToLoad=[this.vizDetails.csvFile],this.vizDetails.csvBase&&this.csvFilesToLoad.push(this.vizDetails.csvBase),this.loadCSVFile(this.csvFilesToLoad[0])}},{key:"finishedLoadingCSV",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,o,l,c,u,h,d,p,m,f,v=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(i=this.csvFilesToLoad.shift(),console.log("FINISHED PARSING: ",i),this.myState.statusMessage="Analyzing...",a=[],n=t.data[0].length-(this.vizDetails.useSlider?0:1),console.log("number of columns",n),r=0;r<n;r++)a.push(new Float32Array(this.numLinks));o=0,l=Object(s["a"])(t.data.splice(1)),e.prev=9,u=function(){var e=c.value,t=v.linkOffsetLookup[e[0].toString()];if(void 0===t)return"continue";if(v.vizDetails.useSlider){var i=e.slice(1),n=i.reduce((function(e,t){return e+t}),0);o=Math.max(o,n),a[0][t]=n,i.forEach((function(e,i){a[i+1][t]=e}))}else{var s=e.slice(1);s.forEach((function(e,i){a[i][t]=e}))}},l.s();case 12:if((c=l.n()).done){e.next=18;break}if(h=u(),"continue"!==h){e.next=16;break}return e.abrupt("continue",16);case 16:e.next=12;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e["catch"](9),l.e(e.t0);case 23:return e.prev=23,l.f(),e.finish(23);case 26:d=t.data[0],p=d.slice(1),this.vizDetails.useSlider&&p.unshift("".concat(this.$t("all"))),m=p.map((function(e){return e.replace(":00:00","")})),f={header:m,headerMax:this.vizDetails.useSlider?new Array(this.csvData.header.length).fill(o):[],rows:new Float32Array,activeColumn:-1},this.csvFilesToLoad.length?(this.buildColumnValues=a,this.csvData=f,this.handleNewDataColumn(this.csvData.header[0])):this.vizDetails.csvBase?(this.baseColumnValues=a,this.csvBase=f):(this.buildColumnValues=a,this.csvData=f,this.handleNewDataColumn(this.csvData.header[0])),this.csvFilesToLoad.length?(this.myState.statusMessage="Loading CSV Baseline...",this.loadCSVFile(this.csvFilesToLoad[0])):(this.myState.statusMessage="",this.handleNewDataColumn(this.csvData.header[0]));case 33:case"end":return e.stop()}}),e,this,[[9,20,23,26]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"loadCSVFile",value:function(e){if(this.myState.fileApi){var t=this.myState.fileApi.cleanURL("".concat(this.myState.subfolder,"/").concat(e));try{Li.a.parse(t,{download:!0,header:!1,skipEmptyLines:!0,dynamicTyping:!0,worker:!0,complete:this.finishedLoadingCSV})}catch(i){return console.error(i),this.$store.commit("setStatus",{type:Q["g"].WARNING,msg:"Could not find: ".concat(this.myState.subfolder,"/").concat(e)}),{allColumns:[],header:[],headerMax:[]}}}}},{key:"changedTimeSlider",value:function(e){e.length&&1===e.length&&(e=e[0]),this.handleNewDataColumn(e)}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],la.prototype,"root",void 0),Object(h["a"])([Object(d["b"])({required:!0})],la.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],la.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],la.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["d"])("$store.state.colorScheme")],la.prototype,"swapTheme",null),la=Object(h["a"])([Object(d["a"])({components:{CollapsiblePanel:E["a"],ConfigPanel:Ki,DrawingTool:oa["a"],LinkDeckMap:ra,TimeSlider:Bi,ToggleButton:f["ToggleButton"]}})],la),M["a"].commit("registerPlugin",{kebabName:"links-gl",prettyName:"Links",description:"Network link attributes",filePatterns:["viz-gl-link*.y?(a)ml"],component:la});var ca=la,ua=ca,ha=(i("ef3f"),i("8c14")),da=Object(U["a"])(ua,Ai,Di,!1,null,"4d4a450e",null);"function"===typeof ha["default"]&&Object(ha["default"])(da);var pa=da.exports,ma=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"link-container",style:{background:e.urlThumbnail}},[e.thumbnail?e._e():i("div",{staticClass:"map-container"},[i("div",{staticClass:"mymap",attrs:{id:e.mapId}})]),e.thumbnail||e.myState.loadingText?e._e():i("left-data-panel",{staticClass:"left-panel"},[i("div",{staticClass:"info-header"},[i("h3",{staticStyle:{"text-align":"center",padding:"0.5rem 1rem","font-weight":"normal",color:"white"}},[e._v(e._s(this.vizDetails.title?this.vizDetails.title:"O/D Flows"))])]),this.vizDetails.description?i("div",{staticClass:"info-description",staticStyle:{padding:"0px 0.5rem"}},[i("p",{staticClass:"description"},[e._v(e._s(this.vizDetails.description))])]):e._e(),i("div",{staticClass:"widgets"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.headers.length>2,expression:"headers.length > 2"}],staticClass:"uhrzeit"},[i("h4",{staticClass:"heading"},[e._v("Uhrzeit")]),e.headers.length>0?i("time-slider",{staticClass:"time-slider",attrs:{useRange:e.showTimeRange,stops:e.headers},on:{change:e.bounceTimeSlider}}):e._e(),i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showTimeRange,expression:"showTimeRange"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showTimeRange)?e._i(e.showTimeRange,null)>-1:e.showTimeRange},on:{change:function(t){var i=e.showTimeRange,a=t.target,n=!!a.checked;if(Array.isArray(i)){var s=null,r=e._i(i,s);a.checked?r<0&&(e.showTimeRange=i.concat([s])):r>-1&&(e.showTimeRange=i.slice(0,r).concat(i.slice(r+1)))}else e.showTimeRange=n}}}),e._v(" Zeitraum")])],1),i("h4",{staticClass:"heading"},[e._v("Linienbreiten")]),e.headers.length>0?i("scale-slider",{staticClass:"time-slider",attrs:{stops:e.SCALE_STOPS},on:{change:e.bounceScale}}):e._e(),i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showAllRoads,expression:"showAllRoads"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showAllRoads)?e._i(e.showAllRoads,null)>-1:e.showAllRoads},on:{change:function(t){var i=e.showAllRoads,a=t.target,n=!!a.checked;if(Array.isArray(i)){var s=null,r=e._i(i,s);a.checked?r<0&&(e.showAllRoads=i.concat([s])):r>-1&&(e.showAllRoads=i.slice(0,r).concat(i.slice(r+1)))}else e.showAllRoads=n}}}),e._v(" Gesamtes Straßennetz anzeigen")])],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.myState.loadingText,expression:"myState.loadingText"}],staticClass:"status-blob"},[i("h4",[e._v(e._s(e.myState.loadingText))])])],1)},fa=[],va=(i("498a"),i("c26a")),ga=i("b7d4"),ba=i.n(ga),ya=i("323e"),ka=i.n(ya),Sa=i("a79f"),wa=i("595b");function Oa(e,t){return Object(Sa["default"])(e,"WGS84",t)}Sa["default"].defs([["EPSG:2048","+proj=tmerc +lat_0=0 +lon_0=19 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"],["EPSG:31468","+proj=tmerc +lat_0=0 +lon_0=12 +k=1 +x_0=4500000 +y_0=0 +ellps=bessel +datum=potsdam +units=m +no_defs"],["EPSG:25833","+proj=utm +zone=33 +ellps=GRS80 +units=m +no_defs"],["EPSG:25832","+proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs"]]),Sa["default"].defs("DK4",Sa["default"].defs("EPSG:31468")),Sa["default"].defs("GK4",Sa["default"].defs("EPSG:31468")),Sa["default"].defs("Cottbus",Sa["default"].defs("EPSG:25833")),Sa["default"].defs("Berlin",Sa["default"].defs("EPSG:31468")),Sa["default"].defs("South Africa",Sa["default"].defs("EPSG:2048"));var Ca={toLngLat:Oa},ja=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"datapanel"}},[i("div",{staticClass:"content-area",class:{"is-hidden":e.isHidden,bye:e.isLeaving}},[e.title?i("div",{staticClass:"info-header"},[i("h3",{staticStyle:{padding:"0.5rem 3rem","font-size":"1rem","font-weight":"normal",color:"white"}},[e._v(e._s(e.title))])]):e._e(),i("div",{staticClass:"top-area"},[e._t("default")],2)]),i("div",{staticClass:"restore-button",class:{"add-margin":!e.isHidden}},[i("button",{staticClass:"button is-small hide-button",on:{click:e.toggleHidePanel}},[e.isHidden?e._e():i("i",{staticClass:"fa fa-arrow-left"}),e.isHidden?i("i",{staticClass:"fa fa-arrow-right"}):e._e()])])])},xa=[],Ta=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.isHidden=!1,e.isLeaving=!1,e}return Object(l["a"])(i,[{key:"toggleHidePanel",value:function(){var e=this;this.isHidden?this.isHidden=!this.isHidden:(this.isLeaving=!0,setTimeout((function(){e.isHidden=!0,e.isLeaving=!1}),300))}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({type:String})],Ta.prototype,"title",void 0),Ta=Object(h["a"])([d["a"]],Ta);var _a=Ta,Ra=_a,Ma=(i("90da"),Object(U["a"])(Ra,ja,xa,!1,null,"82194458",null)),Aa=Ma.exports,Da=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.scaleSlider,!1))],1)},Ea=[],La=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.sliderValue=1,e.scaleSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom",data:e.stops},e}return Object(l["a"])(i,[{key:"created",value:function(){}},{key:"mounted",value:function(){this.scaleSlider.data=this.stops}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],La.prototype,"stops",void 0),Object(h["a"])([Object(d["d"])("sliderValue")],La.prototype,"sliderChangedEvent",null),La=Object(h["a"])([Object(d["a"])({components:{"vue-slider":m.a}})],La);var Fa=La,Pa=Fa,za=(i("acace"),Object(U["a"])(Pa,Da,Ea,!1,null,"2fde1874",null)),Ia=za.exports,Na=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.timeSlider,!1))],1)},Ha=[],Ba=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.TOTAL_MSG="Alle >>",e.sliderValue=e.TOTAL_MSG,e.timeSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,marks:[e.stops[0],e.stops[Math.floor(e.stops.length/2)],e.stops[e.stops.length-1]],contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom",data:e.stops},e}return Object(l["a"])(i,[{key:"clockTime",get:function(){return this.convertSecondsToClockTime(this.sliderValue)}},{key:"created",value:function(){}},{key:"mounted",value:function(){}},{key:"initialTimeChanged",value:function(e){this.sliderValue=e}},{key:"changeUseRange",value:function(e){this.sliderValue=e?[this.stops[0],this.stops[this.stops.length-1]]:[this.stops[0]],console.log("changed to: "+this.sliderValue)}},{key:"setStops",value:function(e){console.log({newStops:e}),this.stops=e}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}},{key:"dataFunction",value:function(){return{value:this.sliderValue,data:this.stops}}},{key:"convertSecondsToClockTimeMinutes",value:function(e){try{var t=N(e),i=("00"+t.minutes).slice(-2);return"".concat(t.hours,":").concat(i)}catch(a){return"0:00"}}},{key:"convertSecondsToClockTime",value:function(e){var t=N(e),i=("00"+t.minutes).slice(-2),a=("00"+t.seconds).slice(-2);return"".concat(t.hours,":").concat(i,":").concat(a)}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])()],Ba.prototype,"initialTime",void 0),Object(h["a"])([Object(d["b"])()],Ba.prototype,"useRange",void 0),Object(h["a"])([Object(d["b"])()],Ba.prototype,"stops",void 0),Object(h["a"])([Object(d["d"])("initialTime")],Ba.prototype,"initialTimeChanged",null),Object(h["a"])([Object(d["d"])("useRange")],Ba.prototype,"changeUseRange",null),Object(h["a"])([Object(d["d"])("stops")],Ba.prototype,"setStops",null),Object(h["a"])([Object(d["d"])("sliderValue")],Ba.prototype,"sliderChangedEvent",null),Ba=Object(h["a"])([Object(d["a"])({components:{"vue-slider":m.a}})],Ba);var Va=Ba,Ua=Va,qa=(i("83c7"),Object(U["a"])(Ua,Na,Ha,!1,null,"e2ace8c0",null)),Wa=qa.exports,$a=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.TOTAL_MSG="Alle >>",e.SCALE_STOPS=[.01,.1,.2,.5,1,2,5,10,100],e.WIDTH_SCALE=.005,e.globalState=M["a"].state,e.showAllRoads=!1,e.mapExtentXYXY=[180,90,-180,-90],e.mapId="m".concat(Math.floor(Math.random()*Math.floor(1e10))),e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,loadingText:"Dateien laden...",visualization:null,project:{}},e.vizDetails={csvFile:"",csvFile2:"",shpFile:"",dbfFile:"",geojsonFile:"",projection:"",scaleFactor:1,title:"",description:"",thumbnail:"",sum:!1},e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.sampleRate=1,e.geojson={},e.headers=[],e.showTimeRange=!1,e.bounceTimeSlider=Object(qi["debounce"])(e.changedTimeSlider,200),e.bounceScale=Object(qi["debounce"])(e.changedScale,200),e.currentTimeBin=e.TOTAL_MSG,e.currentScale=e.SCALE_STOPS[0],e.sumElements=[],e.dataset={},e.idLookup={},e.dailyGrandTotal=0,e.dailyTotals=[],e.idColumn="",e.hoveredStateId=null,e.currentChart={},e}return Object(l["a"])(i,[{key:"toggleShowAllRoads",value:function(){this.changedTimeSlider(this.currentTimeBin)}},{key:"toggleShowTimeRange",value:function(){!this.showTimeRange&&this.headers.length&&(this.currentTimeBin=this.headers[0]),this.changedTimeSlider(this.currentTimeBin)}},{key:"destroyed",value:function(){M["a"].commit("setFullScreen",!1)}},{key:"mounted",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return M["a"].commit("setFullScreen",!this.thumbnail),this.yamlConfig||this.buildRouteFromUrl(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=7;break}return this.myState.loadingText="",e.abrupt("return");case 7:this.generateBreadcrumbs(),this.setupMap();case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateMapExtent",value:function(e){this.mapExtentXYXY[0]=Math.min(this.mapExtentXYXY[0],e[0]),this.mapExtentXYXY[1]=Math.min(this.mapExtentXYXY[1],e[1]),this.mapExtentXYXY[2]=Math.max(this.mapExtentXYXY[2],e[0]),this.mapExtentXYXY[3]=Math.max(this.mapExtentXYXY[3],e[1])}},{key:"setMapExtent",value:function(){this.mapExtentXYXY=Object(wa["bbox"])(this.geojson),localStorage.setItem(this.myState.subfolder+"-bounds",JSON.stringify(this.mapExtentXYXY));var e=this.thumbnail?{animate:!1}:{padding:{top:10,bottom:10,right:10,left:250},animate:!1};this.map.fitBounds(this.mapExtentXYXY,e)}},{key:"generateBreadcrumbs",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,o,l,c,u,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileSystem){e.next=2;break}return e.abrupt("return",[]);case 2:t=[{label:this.myState.fileSystem.name,url:"/"+this.myState.fileSystem.slug}],i=this.myState.subfolder.split("/"),a="/",n=Object(s["a"])(i),e.prev=6,n.s();case 8:if((r=n.n()).done){e.next=16;break}if(o=r.value,o){e.next=12;break}return e.abrupt("continue",14);case 12:a+=o+"/",t.push({label:o,url:"/"+this.myState.fileSystem.slug+a});case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](6),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:return e.prev=24,e.next=27,this.myState.fileApi.getFileText(this.myState.subfolder+"/metadata.yml");case 27:l=e.sent,c=y.a.parse(l),c.title&&(u=t.pop(),h=u?u.url:"/",t.push({label:c.title,url:h})),e.next=34;break;case 32:e.prev=32,e.t1=e["catch"](24);case 34:return t.push({label:this.vizDetails.title?this.vizDetails.title:"",url:"#"}),M["a"].commit("setBreadCrumbs",t),e.abrupt("return",t);case 37:case"end":return e.stop()}}),e,this,[[6,18,21,24],[24,32]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){var t=this.$store.state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Pe["a"](t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"setupMap",value:function(){try{this.map=new ba.a.Map({bearing:0,container:this.mapId,logoPosition:"bottom-right",style:"mapbox://styles/mapbox/streets-v11",pitch:0}),this.findCenter(),this.map.on("style.load",this.mapIsReady),this.map.addControl(new ba.a.NavigationControl,"top-right")}catch(e){console.log(e)}}},{key:"findCenter",value:function(){try{var e=localStorage.getItem(this.myState.subfolder+"-bounds");if(e){var t=JSON.parse(e),i={top:5,bottom:5,right:5,left:30};this.thumbnail?this.map.fitBounds(t,{animate:!1}):this.map.fitBounds(t,{padding:i,animate:!1})}}catch(a){}}},{key:"getVizDetails",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=y.a.parse(t),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.myState.fileSystem&&this.myState.fileSystem.needPassword&&401===e.t0.status&&M["a"].commit("requestLogin",this.myState.fileSystem.slug);case 10:this.$emit("title",this.vizDetails.title),this.vizDetails.shpFileIdProperty||(this.vizDetails.shpFileIdProperty="Id"),this.sampleRate=this.vizDetails.sampleRate?this.vizDetails.sampleRate:1,this.buildThumbnail(),ka.a.done();case 15:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=15;break}return e.prev=1,e.next=4,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 4:return t=e.sent,e.next=7,g.a.arraybuffer(t);case 7:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,this,[[1,12]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"loadFiles",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,this.myState.loadingText="Dateien laden...",e.next=4,this.myState.fileApi.getFileText(this.myState.subfolder+this.vizDetails.csvFile);case 4:if(t=e.sent,i="",!this.vizDetails.csvFile2){e.next=10;break}return e.next=9,this.myState.fileApi.getFileText(this.myState.subfolder+this.vizDetails.csvFile2);case 9:i=e.sent;case 10:if(a=null,n=null,s=null,!this.vizDetails.geojsonFile){e.next=28;break}return console.log("reading",this.vizDetails.geojsonFile),e.next=17,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.geojsonFile);case 17:if(r=e.sent,!r){e.next=24;break}return e.next=21,Object(_["a"])(r);case 21:e.t0=e.sent,e.next=25;break;case 24:e.t0=null;case 25:s=e.t0,e.next=41;break;case 28:return console.log("reading",this.vizDetails.shpFile),e.next=31,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.shpFile);case 31:return o=e.sent,e.next=34,g.a.arraybuffer(o);case 34:return a=e.sent,e.next=37,this.myState.fileApi.getFileBlob(this.myState.subfolder+this.vizDetails.dbfFile);case 37:return l=e.sent,e.next=40,g.a.arraybuffer(l);case 40:n=e.sent;case 41:return e.abrupt("return",{shpFile:a,dbfFile:n,linkFlows:i||t,linkBaseFlows:i?t:i,geojsonFile:s});case 44:return e.prev=44,e.t1=e["catch"](0),console.error({e:e.t1}),this.myState.loadingText=""+e.t1,e.abrupt("return",null);case 49:case"end":return e.stop()}}),e,this,[[0,44]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"changedScale",value:function(e){this.currentScale=e,this.changedTimeSlider(this.currentTimeBin)}},{key:"changedTimeSlider",value:function(e){e.length&&1===e.length&&(e=e[0]),this.currentTimeBin=e;var t=this.WIDTH_SCALE*this.currentScale;if(0==this.showTimeRange){this.map.setPaintProperty("my-layer","line-width",["*",t,["abs",["get",e]]]),this.map.setPaintProperty("my-layer","line-offset",["*",.5*t,["abs",["get",e]]]),this.map.setPaintProperty("my-layer","line-color",["case",["boolean",["feature-state","hover"],!1],"#ff0",["==",["get",e],null],"#8ca",["<",["get",e],0],"#5f5",this.vizDetails.csvFile2?"#900":"#55b"]);var i=this.showAllRoads?null:["!=",["get",this.currentTimeBin],null];this.map.setFilter("my-layer",i)}else{var a,n=["+"],r=!1,o=Object(s["a"])(this.headers);try{for(o.s();!(a=o.n()).done;){var l=a.value;l===e[0]&&(r=!0),l!==this.TOTAL_MSG&&(r&&n.push(["get",l]),l===e[1]&&(r=!1))}}catch(c){o.e(c)}finally{o.f()}this.map.setPaintProperty("my-layer","line-width",["*",t,n]),this.map.setPaintProperty("my-layer","line-offset",["*",.5*t,n]),this.map.setPaintProperty("my-layer","line-color",["case",["boolean",["feature-state","hover"],!1],"#0f6",["==",n,null],"#8ca",["<",n,0],"#fc0","#559"])}}},{key:"processHeaders",value:function(e){var t=e.split("\n"),i=t[0].indexOf(";")>0?";":",",a=t[0].split(i).map((function(e){return e.trim()}));this.headers=[this.TOTAL_MSG].concat(a.slice(1))}},{key:"processGeojsonFile",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText="Verkehrsnetz laden...",e.next=3,R["run"](T.a.inflateAsync(t.geojsonFile,{to:"string"}));case 3:return i=e.sent,a=JSON.parse(i),n=this.vizDetails.shpFileIdProperty?this.vizDetails.shpFileIdProperty:"Id",s=0,e.next=9,R["forEachAsync"](a.features,(function(e){e.properties&&(e.id=s++,r.idLookup[e.properties[n]]=e.id)}));case 9:return e.abrupt("return",a);case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"processShapefile",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText="Verkehrsnetz laden...",e.next=3,va["a"](t.shpFile,t.dbfFile);case 3:return i=e.sent,this.myState.loadingText="Converting coordinates...",a=0,n=this.vizDetails.shpFileIdProperty?this.vizDetails.shpFileIdProperty:"Id",s=0,e.next=10,R["forEachAsync"](i.features,(function(e){e.properties&&(e.id=s++,r.idLookup[e.properties[n]]=e.id);try{"MultiPolygon"===e.geometry.type?r.convertMultiPolygonCoordinatesToWGS84(e):"LineString"===e.geometry.type?r.convertLineStringCoordinatesToWGS84(e):r.convertPolygonCoordinatesToWGS84(e)}catch(t){a++,a<5&&(console.error("ERR with feature: "+e),console.error(t))}}));case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"convertLineStringCoordinatesToWGS84",value:function(e){var t,i=[],a=e.geometry.coordinates,n=Object(s["a"])(a);try{for(n.s();!(t=n.n()).done;){var r=t.value,o=Ca.toLngLat(this.vizDetails.projection,r);i.push(o),this.updateMapExtent(o)}}catch(l){n.e(l)}finally{n.f()}a.length=0,a.push.apply(a,i)}},{key:"convertPolygonCoordinatesToWGS84",value:function(e){var t,i=Object(s["a"])(e.geometry.coordinates);try{for(i.s();!(t=i.n()).done;){var a,n=t.value,r=[],o=Object(s["a"])(n);try{for(o.s();!(a=o.n()).done;){var l=a.value,c=Ca.toLngLat(this.vizDetails.projection,l);r.push(c)}}catch(u){o.e(u)}finally{o.f()}n.length=0,n.push.apply(n,r)}}catch(u){i.e(u)}finally{i.f()}}},{key:"origConvertMultiPolygonCoordinatesToWGS84",value:function(e){var t,i=Object(s["a"])(e.geometry.coordinates);try{for(i.s();!(t=i.n()).done;){var a,n=t.value,r=n[0],o=[],l=Object(s["a"])(r);try{for(l.s();!(a=l.n()).done;){var c=a.value,u=Object(Sa["default"])(this.vizDetails.projection,"WGS84",c);o.push(u)}}catch(h){l.e(h)}finally{l.f()}n[0]=o}}catch(h){i.e(h)}finally{i.f()}}},{key:"convertMultiPolygonCoordinatesToWGS84",value:function(e){e.geometry.coordinates=this.recurseWGS84(e.geometry.coordinates)}},{key:"recurseWGS84",value:function(e){var t,i=[],a=Object(s["a"])(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;Array.isArray(n[0])?i.push(this.recurseWGS84(n)):i.push(Object(Sa["default"])(this.vizDetails.projection,"WGS84",n))}}catch(r){a.e(r)}finally{a.f()}return i}},{key:"mapIsReady",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:if(t=e.sent,t){e.next=6;break}return this.myState.loadingText="Fehler mit Dateien, sorry",e.abrupt("return");case 6:if(!this.vizDetails.geojsonFile){e.next=12;break}return e.next=9,this.processGeojsonFile(t);case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,this.processShapefile(t);case 14:e.t0=e.sent;case 15:return this.geojson=e.t0,this.setMapExtent(),e.next=19,this.processCSVFiles(t);case 19:return this.processHeaders(t.linkFlows),e.next=22,this.calculateLinkProperties(this.geojson);case 22:return this.addJsonToMap(this.geojson),this.changedScale(1),this.setupMapListeners(),this.myState.loadingText="",e.next=28,this.$nextTick();case 28:ka.a.done();case 29:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processCSVFiles",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.dataset={},i=",";try{a=t.linkFlows.substring(0,t.linkFlows.indexOf("\n")),a.indexOf(",")>-1?i=",":a.indexOf(";")>-1?i=";":a.indexOf("\t")>-1?i="\t":a.indexOf(" ")>-1&&(i=" ")}catch(o){i=","}return n=Li.a.parse(t.linkFlows,{header:!0,dynamicTyping:!0,delimiter:i}),s=n.meta.fields[0],this.idColumn=s,e.next=8,R["forEachAsync"](n.data,(function(e){var t=e[s],i=r.idLookup[t];r.dataset[i]=e}));case 8:if(!t.linkBaseFlows){e.next=11;break}return e.next=11,this.subtractBaseFlows(t.linkBaseFlows,i);case 11:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"subtractBaseFlows",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,i){var a,n,s,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText=this.vizDetails.sum?"Summen berechnen...":"Differenzen berechnen...",a=Li.a.parse(t,{header:!0,dynamicTyping:!0,delimiter:i}),n=a.meta.fields[0],s=0,e.next=6,R["forEachAsync"](a.data,(function(e){var t=e[n],i=r.idLookup[t];if(r.dataset[i]){var a=r.dataset[i];if(r.vizDetails.sum)for(var o=0,l=Object.keys(e);o<l.length;o++){var c=l[o];a[c]=a[c]+e[c]}else for(var u=0,h=Object.keys(e);u<h.length;u++){var d=h[u];a[d]=a[d]-e[d]}r.dataset[i]=a,s++}else{if(!r.vizDetails.sum)for(var p=0,m=Object.keys(e);p<m.length;p++){var f=m[p];isNaN(e[f])||(e[f]=-1*e[f])}r.dataset[i]=e}}));case 6:console.log(s,"total DIFFs happened");case 7:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"calculateLinkProperties",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.myState.loadingText="Berechnen...",e.next=3,R["forEachAsync"](t.features,(function(e){var t=e.id,a=i.dataset[t];if(a){for(var n=0,s=0,r=Object.keys(a);s<r.length;s++){var o=r[s];if(o!==i.idColumn&&!isNaN(a[o])){var l=a[o]/i.sampleRate;e.properties[o]=l,n+=l,i.dailyTotals[o]||(i.dailyTotals[o]=0),i.dailyTotals[o]+=l}}e.properties[i.TOTAL_MSG]=n}}));case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addJsonToMap",value:function(e){this.map&&(this.map.addSource("my-data",{data:e,type:"geojson"}),this.map.addLayer({id:"my-layer",source:"my-data",type:"line",paint:{"line-opacity":1,"line-width":["get","width"],"line-offset":["+",.25,["*",.5,["get","width"]]],"line-color":["case",["boolean",["feature-state","hover"],!1],"#fb0","#559"]},layout:{"line-cap":"round"}}))}},{key:"setupMapListeners",value:function(){var e=this;if(this.map){var t="my-layer",i=this;this.map.on("click",t,(function(t){e.clickedOnElement(t)})),this.map.on("mousemove",t,(function(t){e.map&&(e.map.getCanvas().style.cursor=t?"pointer":"auto")})),this.map.on("mouseleave",t,(function(){e.map&&(e.map.getCanvas().style.cursor="auto")})),this.map.on("mousemove",t,(function(e){var t=i.map.queryRenderedFeatures(e.point);t.length>0&&(i.hoveredStateId&&i.map.setFeatureState({source:"my-data",id:i.hoveredStateId},{hover:!1}),i.hoveredStateId=t[0].id,i.map.setFeatureState({source:"my-data",id:i.hoveredStateId},{hover:!0}))})),this.map.on("mouseleave",t,(function(){i.hoveredStateId&&i.map.setFeatureState({source:"my-data",id:i.hoveredStateId},{hover:!1}),i.hoveredStateId=null}))}}},{key:"clickedOnElement",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,r,o,l,c,u,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.features){e.next=2;break}return e.abrupt("return");case 2:if(i=t.features[0],a=[],n=0,!i.properties){e.next=28;break}r=this.headers,o=Object(s["a"])(r),e.prev=8,o.s();case 10:if((l=o.n()).done){e.next=20;break}if(c=l.value,c!==this.TOTAL_MSG){e.next=14;break}return e.abrupt("continue",18);case 14:u=i.properties[c],u||(u=0),n+=u,a.push({hour:c,trips:u});case 18:e.next=10;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](8),o.e(e.t0);case 25:return e.prev=25,o.f(),e.finish(25);case 28:n||(n=0),h='<p style="text-align: center; min-width: max-content;"><b>Details</b><br/>Insgesamt: '+n+"</p>",n&&(h+='<div id="chart" style="width: 300px; height:250px;"></div>'),this._popup&&this._popup.remove(),this._popup=new ba.a.Popup({closeOnClick:!0}).setLngLat(t.lngLat).setHTML(h),this._popup.addTo(this.map),console.log({data:a}),n&&(this.currentChart=new Morris.Bar({element:"chart",data:a,stacked:!0,xkey:"hour",ykeys:["trips"],labels:["Trips"],barColors:["#3377cc"],xLabels:"Uhr",xLabelAngle:90,hideHover:!0,parseTime:!1,resize:!0}));case 36:case"end":return e.stop()}}),e,this,[[8,22,25,28]])})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!1})],$a.prototype,"fileApi",void 0),Object(h["a"])([Object(d["b"])({required:!1})],$a.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],$a.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],$a.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["d"])("showAllRoads")],$a.prototype,"toggleShowAllRoads",null),Object(h["a"])([Object(d["d"])("showTimeRange")],$a.prototype,"toggleShowTimeRange",null),$a=Object(h["a"])([Object(d["a"])({components:{LeftDataPanel:Aa,ScaleSlider:Ia,TimeSlider:Wa}})],$a),M["a"].commit("registerPlugin",{kebabName:"link-volumes",prettyName:"Volumes",description:"Aggregate volumes on network links",filePatterns:["viz-link*.y?(a)ml"],component:$a});var Ga,Ya=$a,Xa=Ya,Za=(i("e65f"),Object(U["a"])(Xa,ma,fa,!1,null,"f7827866",null)),Ka=Za.exports,Ja=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"transit-viz",class:{"hide-thumbnail":!e.thumbnail}},[i("div",{staticClass:"map-container",class:{"hide-thumbnail":!e.thumbnail}},[i("div",{staticStyle:{height:"100%",width:"100%",flex:"1"},attrs:{id:e.mapID}},e._l(e.stopMarkers,(function(e){return i("div",{key:e.i,staticClass:"stop-marker",style:{transform:"translate(-50%,-50%) rotate("+e.bearing+"deg)",left:e.xy.x+"px",top:e.xy.y+"px"}})})),0)]),e.thumbnail?e._e():i("drawing-tool"),e.thumbnail?e._e():i("collapsible-panel",{staticClass:"left-side",attrs:{darkMode:e.isDarkMode,locked:"true",direction:"left"}},[i("div",{staticClass:"panel-items"},[i("div",{staticClass:"panel-item"},[i("h3",[e._v(e._s(e.vizDetails.title))]),i("p",[e._v(e._s(e.vizDetails.description))])]),e.routesOnLink.length>0?i("div",{staticClass:"route-list"},e._l(e.routesOnLink,(function(t){return i("div",{key:t.uniqueRouteID,staticClass:"route",class:{highlightedRoute:e.selectedRoute&&t.id===e.selectedRoute.id},on:{click:function(i){return e.showRouteDetails(t.id)}}},[i("h3",{staticClass:"mytitle"},[e._v(e._s(t.id))]),i("div",{staticClass:"detailed-route-data"},[i("div",{staticClass:"col"},[i("p",[i("b",[e._v(e._s(t.departures)+" departures")])]),i("p",[e._v("First: "+e._s(t.firstDeparture))]),i("p",[e._v("Last: "+e._s(t.lastDeparture))])]),t.passengersAtArrival?i("div",{staticClass:"col"},[i("p",[i("b",[e._v(e._s(t.passengersAtArrival)+" passengers")])]),i("p",[e._v(e._s(t.totalVehicleCapacity)+" capacity")])]):e._e()])])})),0):e._e()])]),e.thumbnail?e._e():i("collapsible-panel",{staticClass:"right-side",attrs:{darkMode:e.isDarkMode,width:300,direction:"right"}},[i("div",{staticClass:"panel-item"},[i("h3",[e._v(e._s(e.$t("metrics"))+":")]),i("div",{staticClass:"metric-buttons"},e._l(e.metrics,(function(t,a){return i("button",{key:t.field,staticClass:"button is-small metric-button",style:{color:e.activeMetric===t.field?"white":e.buttonColors[a],border:"1px solid "+e.buttonColors[a],"border-right":"0.4rem solid "+e.buttonColors[a],"border-radius":"4px","background-color":e.activeMetric===t.field?e.buttonColors[a]:e.isDarkMode?"#333":"white"},on:{click:function(i){return e.handleClickedMetric(t)}}},[e._v(e._s("de"===e.$i18n.locale?t.name_de:t.name_en))])})),0)]),i("legend-box",{attrs:{rows:e.legendRows}})],1),!e.thumbnail&&e.loadingText?i("div",{staticClass:"status-corner"},[i("p",[e._v(e._s(e.loadingText))])]):e._e()],1)},Qa=[];i("6062");function en(){return new Worker(i.p+"js/TransitSupplyHelper.worker.97972ff9.worker.js")}(function(e){e["CreateNodesAndLinks"]="CreateNodesAndLinks",e["ConvertCoordinates"]="ConvertCoordinates",e["ProcessTransit"]="ProcessTransit"})(Ga||(Ga={}));var tn=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){return Object(o["a"])(this,i),t.call(this,new en)}return Object(l["a"])(i,[{key:"createNodesAndLinks",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(Ga.CreateNodesAndLinks,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"convertCoordinates",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(Ga.ConvertCoordinates,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processTransit",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",this.postAsyncWorkerMessage(Ga.ProcessTransit,{}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initialize",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.postAsyncWorkerMessage(oe,t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}],[{key:"create",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=new i,e.next=3,a.initialize(t);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),i}(ue),an=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"legend-container"}},[i("h3",[e._v("Legend")]),e._l(e.rows,(function(t){return i("div",{key:t[0],staticClass:"legend-item"},[i("div",{staticClass:"legend-col-1",style:{"background-color":t[0]}}),i("span",{staticClass:"legend-col-2"},[e._v(e._s(t[1]))])])}))],2)},nn=[],sn=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){return Object(o["a"])(this,i),t.apply(this,arguments)}return Object(l["a"])(i,[{key:"created",value:function(){}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({type:Array,required:!0})],sn.prototype,"rows",void 0),sn=Object(h["a"])([d["a"]],sn);var rn=sn,on=rn,ln=(i("55f7"),Object(U["a"])(on,an,nn,!1,null,"42071d2a",null)),cn=ln.exports;function un(){return new Worker(i.p+"js/GzipFetcher.worker.e6168617.worker.js")}var hn="EPSG:31468",dn=10,pn=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.mapPopup=new ga["Popup"]({closeButton:!1,closeOnClick:!1}),e.buttonColors=["#5E8AAE","#BF7230","#269367","#9C439C"],e.metrics=[{field:"departures",name_en:"Departures",name_de:"Abfahrten"}],e.activeMetric=e.metrics[0].field,e.vizDetails={transitSchedule:"",network:"",demand:"",projection:"",title:"",description:""},e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.isDarkMode=e.$store.state.colorScheme===Q["a"].DarkMode,e.loadingText="MATSim Transit Inspector",e.mapID="map-id-".concat(Math.floor(1e12*Math.random())),e.project={},e.projection=hn,e.routesOnLink=[],e.selectedRoute={},e.stopMarkers=[],e.isMapMoving=!1,e.cfDemand=null,e.cfDemandLink=null,e.hoverWait=!1,e}return Object(l["a"])(i,[{key:"created",value:function(){this._attachedRouteLayers=[],this._departures={},this._mapExtentXYXY=[180,90,-180,-90],this._maximum=0,this._network={nodes:{},links:{}},this._routeData={},this._stopFacilities={},this._transitLines={},this.selectedRoute=null}},{key:"destroyed",value:function(){this.$store.commit("setFullScreen",!1)}},{key:"handleResize",value:function(){this.mymap&&this.mymap.resize()}},{key:"mapMoved",value:function(e){var t=e.bearing,i=e.longitude,a=e.latitude,n=e.zoom,s=e.pitch;this.mymap&&!this.isMapMoving?n&&(this.mymap.off("move",this.handleMapMotion),this.mymap.jumpTo({bearing:t,zoom:n,center:[i,a],pitch:s}),this.mymap.on("move",this.handleMapMotion),this.stopMarkers.length>0&&this.showTransitStops()):this.isMapMoving=!1}},{key:"swapTheme",value:function(){var e=this;this.isDarkMode=this.$store.state.colorScheme===Q["a"].DarkMode,this.mymap&&(this.removeAttachedRoutes(),this.mymap.setStyle(this.isDarkMode?Q["f"].dark:Q["f"].light),this.mymap.on("style.load",(function(){e._geoTransitLinks&&e.addTransitToMap(e._geoTransitLinks),e.highlightAllAttachedRoutes(),e.selectedRoute&&e.showTransitRoute(e.selectedRoute.id)})))}},{key:"beforeDestroy",value:function(){this._roadFetcher&&this._roadFetcher.destroy(),this._transitFetcher&&this._transitFetcher.destroy(),this._transitHelper&&this._transitHelper.destroy()}},{key:"buildFileApi",value:function(){var e=this.getFileSystem(this.root);this.myState.fileApi=new Pe["a"](e),this.myState.fileSystem=e}},{key:"mounted",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$store.commit("setFullScreen",!this.thumbnail),this.fileApi||this.buildFileApi(),e.next=4,this.getVizDetails();case 4:if(!this.thumbnail){e.next=6;break}return e.abrupt("return");case 6:this.setupMap();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileSystem",value:function(e){console.log(this.$store.state.svnProjects),console.log(e);var t=this.$store.state.svnProjects.filter((function(t){return t.slug===e}));if(console.log(t.length),0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.myState.yamlConfig.endsWith("yaml")&&!this.myState.yamlConfig.endsWith("yml")){e.next=3;break}return this.loadYamlConfig(),e.abrupt("return");case 3:return t=this.myState.yamlConfig.replaceAll("transitSchedule","network"),e.next=6,this.myState.fileApi.getDirectory(this.myState.subfolder);case 6:i=e.sent,a=i.files,n=a.filter((function(e){return e.endsWith("pt_stop2stop_departures.csv.gz")})),s=""+this.$i18n.t("viewer"),this.vizDetails={transitSchedule:this.myState.yamlConfig,network:t,title:s,description:"",demand:n.length?n[0]:"",projection:"EPSG:31468"},this.$emit("title",s),this.projection=this.vizDetails.projection;case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadYamlConfig",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:t=e.sent,this.vizDetails=y.a.parse(t),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),this.myState.fileSystem&&this.myState.fileSystem.needPassword&&401===e.t0.status&&this.$store.commit("requestLogin",this.myState.fileSystem.slug);case 10:i=this.vizDetails.title?this.vizDetails.title:"Transit Ridership",this.$emit("title",i),this.projection=this.vizDetails.projection,ka.a.done();case 14:case"end":return e.stop()}}),e,this,[[0,7]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"legendRows",get:function(){return[["#a03919","Rail"],["#448","Bus"]]}},{key:"isMobile",value:function(){var e=window,t=document,i=t.documentElement,a=t.getElementsByTagName("body")[0],n=e.innerWidth||i.clientWidth||a.clientWidth;e.innerHeight||i.clientHeight||a.clientHeight;return n<640}},{key:"setupMap",value:function(){try{this.mymap=new ba.a.Map({bearing:0,container:this.mapID,logoPosition:"bottom-left",style:this.isDarkMode?Q["f"].dark:Q["f"].light,pitch:0});var e=localStorage.getItem(this.$route.fullPath+"-bounds");if(e){var t=JSON.parse(e),i=this.isMobile()?0:1,a={top:50*i,bottom:50*i,right:50*i,left:50*i};this.mymap.fitBounds(t,{animate:!1,padding:a})}}catch(n){console.error({E:n})}this.mymap.on("load",this.mapIsReady),this.mymap.on("move",this.handleMapMotion),this.mymap.on("click",this.handleEmptyClick),this.mymap.keyboard.disable(),this.mymap.addControl(new ba.a.NavigationControl,"top-right")}},{key:"handleClickedMetric",value:function(e){console.log("transit metric:",e.field),this.activeMetric=e.field;var t=3;switch(e.field){case"departures":t=["max",2,["*",.03,["get","departures"]]];break;case"pax":t=["max",2,["*",.003,["get","pax"]]];break;case"loadfac":t=["max",2,["*",200,["get","loadfac"]]];break}this.mymap.setPaintProperty("transit-link","line-width",t)}},{key:"handleMapMotion",value:function(){var e={longitude:this.mymap.getCenter().lng,latitude:this.mymap.getCenter().lat,bearing:this.mymap.getBearing(),zoom:this.mymap.getZoom(),pitch:this.mymap.getPitch()};this.isMapMoving||this.$store.commit("setMapCamera",e),this.isMapMoving=!0,this.stopMarkers.length>0&&this.showTransitStops()}},{key:"handleEmptyClick",value:function(e){this.removeStopMarkers(),this.removeSelectedRoute(),this.removeAttachedRoutes(),this.routesOnLink=[]}},{key:"showRouteDetails",value:function(e){(e||this.selectedRoute)&&(console.log({routeID:e}),e?this.showTransitRoute(e):this.showTransitRoute(this.selectedRoute.id),this.showTransitStops())}},{key:"mapIsReady",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadNetworks();case 2:t=e.sent,t&&this.processInputs(t),this.setupKeyListeners();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setupKeyListeners",value:function(){var e=this;window.addEventListener("keyup",(function(t){27===t.keyCode&&e.pressedEscape()})),window.addEventListener("keydown",(function(t){38===t.keyCode&&e.pressedArrowKey(-1),40===t.keyCode&&e.pressedArrowKey(1)}))}},{key:"loadNetworks",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,this.myState.fileSystem){e.next=3;break}return e.abrupt("return");case 3:return this.loadingText="Loading networks...",e.next=6,pi.create({fileApi:this.myState.fileSystem.slug,filePath:this.myState.subfolder+"/"+this.vizDetails.network});case 6:return this._roadFetcher=e.sent,e.next=9,pi.create({fileApi:this.myState.fileSystem.slug,filePath:this.myState.subfolder+"/"+this.vizDetails.transitSchedule});case 9:return this._transitFetcher=e.sent,t=this._roadFetcher.fetchXML(),i=this._transitFetcher.fetchXML(),e.next=14,Promise.all([t,i]);case 14:return a=e.sent,this._roadFetcher.destroy(),this._transitFetcher.destroy(),n=this.loadDemandData(this.vizDetails.demand),e.abrupt("return",{roadXML:a[0],transitXML:a[1],ridership:n});case 21:return e.prev=21,e.t0=e["catch"](0),console.error({e:e.t0}),this.loadingText=""+e.t0,e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,this,[[0,21]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadDemandData",value:function(e){var t=this;if(!e)return[];this.loadingText="Loading demand...";var i=new un;i.onmessage=function(e){t.loadingText="Processing demand...";var i=e.data,a=new TextDecoder("utf-8"),n=a.decode(i);Li.a.parse(n,{header:!0,skipEmptyLines:!0,dynamicTyping:!0,worker:!0,complete:function(e){t.processDemand(e)}})},i.postMessage({filePath:this.myState.subfolder+"/"+e,fileSystem:this.myState.fileSystem})}},{key:"processDemand",value:function(e){this.loadingText="Processing demand data...",console.log("BUILD crossfilter"),this.cfDemand=Object(Ge["a"])(e.data),this.cfDemandLink=this.cfDemand.dimension((function(e){return e.linkIdsSincePreviousStop})),console.log("COUNTING RIDERSHIP");var t={},i=this.cfDemandLink.group();i.reduceSum((function(e){return e.passengersAtArrival})).all().map((function(e){t[e.key]=e.value}));var a={};i.reduceSum((function(e){return e.totalVehicleCapacity})).all().map((function(e){a[e.key]=e.value}));var n,r=Object(s["a"])(this._transitLinks.features);try{for(r.s();!(n=r.n()).done;){var o=n.value;o.properties["pax"]=t[o.properties.id],o.properties["cap"]=a[o.properties.id],o.properties["loadfac"]=Math.round(1e3*t[o.properties.id]/a[o.properties.id])/1e3}}catch(c){r.e(c)}finally{r.f()}this.metrics=this.metrics.concat([{field:"pax",name_en:"Passengers",name_de:"Passagiere"},{field:"loadfac",name_en:"Load Factor",name_de:"Auslastung"}]);var l=this.mymap.getSource("transit-source");l.setData(this._transitLinks),this.loadingText=""}},{key:"processInputs",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Preparing...",e.next=3,tn.create({xml:t,projection:this.projection});case 3:return this._transitHelper=e.sent,this.loadingText="Crunching road network...",e.next=7,this._transitHelper.createNodesAndLinks();case 7:return this.loadingText="Converting coordinates...",e.next=10,this._transitHelper.convertCoordinates();case 10:return this.loadingText="Crunching transit network...",e.next=13,this._transitHelper.processTransit();case 13:return i=e.sent,a=i.network,n=i.routeData,s=i.stopFacilities,r=i.transitLines,o=i.mapExtent,this._network=a,this._routeData=n,this._stopFacilities=s,this._transitLines=r,this._mapExtentXYXY=o,this.loadingText="Summarizing departures...",e.next=27,this.processDepartures();case 27:return e.next=29,this.constructDepartureFrequencyGeoJson();case 29:this._transitLinks=e.sent,this.addTransitToMap(this._transitLinks),this.handleClickedMetric({field:"departures"}),localStorage.setItem(this.$route.fullPath+"-bounds",JSON.stringify(this._mapExtentXYXY)),this.mymap.fitBounds(this._mapExtentXYXY,{animate:!1}),this.vizDetails.demand||(this.loadingText=""),ka.a.done();case 36:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"processDepartures",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,o,l,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(t in this.loadingText="Processing departures...",this._transitLines)if(this._transitLines.hasOwnProperty(t)){i=this._transitLines[t],a=Object(s["a"])(i.transitRoutes);try{for(a.s();!(n=a.n()).done;){r=n.value,o=Object(s["a"])(r.route);try{for(o.s();!(l=o.n()).done;)c=l.value,c in this._departures||(this._departures[c]={total:0,routes:new Set}),this._departures[c].total+=r.departures,this._departures[c].routes.add(r.id),this._maximum=Math.max(this._maximum,this._departures[c].total)}catch(u){o.e(u)}finally{o.f()}}}catch(u){a.e(u)}finally{a.f()}}case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"addTransitToMap",value:function(e){var t=this;this._geoTransitLinks=e,this.mymap.addSource("transit-source",{data:e,type:"geojson"}),this.mymap.addLayer({id:"transit-link",source:"transit-source",type:"line",paint:{"line-opacity":1,"line-width":1,"line-color":["get","color"]}}),this.mymap.on("click","transit-link",(function(e){t.clickedOnTransitLink(e)})),this.mymap.on("mousemove","transit-link",(function(e){t.mymap.getCanvas().style.cursor=e?"pointer":"grab",t.hoveredOnElement(e)})),this.mymap.on("mouseleave","transit-link",(function(){t.mymap.getCanvas().style.cursor="grab",t.mapPopup.remove()}))}},{key:"hoveredOnElement",value:function(e){var t,i=e.features[0].properties,a='<div class="map-popup">',n=Object(s["a"])(this.metrics);try{for(n.s();!(t=n.n()).done;){var r=t.value,o="de"==this.$i18n.locale?r.name_de:r.name_en;o=o.replaceAll(" ","&nbsp;"),isNaN(i[r.field])||(a+='\n          <div style="display: flex">\n            <div>'.concat(o,':&nbsp;&nbsp;</div>\n            <b style="margin-left: auto; text-align: right">').concat(i[r.field],"</b>\n          </div>"))}}catch(l){n.e(l)}finally{n.f()}a+="<div>",this.mapPopup.setLngLat(e.lngLat).setHTML(a).addTo(this.mymap)}},{key:"constructDepartureFrequencyGeoJson",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,o,l,c,u,h,d,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(i in t=[],this._departures)if(this._departures.hasOwnProperty(i)){a=this._network.links[i],n=[[this._network.nodes[a.from].x,this._network.nodes[a.from].y],[this._network.nodes[a.to].x,this._network.nodes[a.to].y]],r=this._departures[i].total,o=.25+.75*(r-1)/this._maximum,l=Math.floor(dn*o),c=!0,u=Object(s["a"])(this._departures[i].routes);try{for(u.s();!(h=u.n()).done;)d=h.value,"bus"===this._routeData[d].transportMode&&(c=!1)}catch(m){u.e(m)}finally{u.f()}p={type:"Feature",geometry:{type:"LineString",coordinates:n},properties:{color:c?"#a03919":fn[l],colorBin:l,departures:r,id:i,isRail:c,from:a.from,to:a.to}},p=this.offsetLineByMeters(p,15),t.push(p)}return t.sort((function(e,t){return e.isRail&&!t.isRail?-1:t.isRail&&!e.isRail?1:0})),e.abrupt("return",{type:"FeatureCollection",features:t});case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"offsetLineByMeters",value:function(e,t){try{var i=wa["lineOffset"](e,t,{units:"meters"});return i}catch(a){}return e}},{key:"removeStopMarkers",value:function(){this.stopMarkers=[]}},{key:"showTransitStops",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,o,l,c,u,h,d,p,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.removeStopMarkers(),t=this.selectedRoute,"stopmarker",i=this.mymap.getBearing(),n=Object(s["a"])(t.routeProfile.entries());try{for(n.s();!(r=n.n()).done;)o=Object(pe["a"])(r.value,2),l=o[0],c=o[1],u=[this._stopFacilities[c.refId].x,this._stopFacilities[c.refId].y],l<t.routeProfile.length-1&&(h=wa["point"]([u[0],u[1]]),d=wa["point"]([this._stopFacilities[t.routeProfile[l+1].refId].x,this._stopFacilities[t.routeProfile[l+1].refId].y]),a=wa["bearing"](h,d)-i),p=this.mymap.project([u[0],u[1]]),m={i:l,bearing:a,xy:{x:Math.floor(p.x),y:Math.floor(p.y)}},this.stopMarkers.push(m)}catch(f){n.e(f)}finally{n.f()}case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"showTransitRoute",value:function(e){if(e){var t=this._routeData[e];console.log({selectedRoute:t}),this.selectedRoute=t;var i=this.mymap.getSource("selected-route-data");i?i.setData(t.geojson):this.mymap.addSource("selected-route-data",{data:t.geojson,type:"geojson"}),this.mymap.getLayer("selected-route")||this.mymap.addLayer({id:"selected-route",source:"selected-route-data",type:"line",paint:{"line-opacity":1,"line-width":5,"line-color":"#097c43"}})}}},{key:"removeSelectedRoute",value:function(){this.selectedRoute&&(this.mymap.removeLayer("selected-route"),this.selectedRoute=null)}},{key:"clickedOnTransitLink",value:function(e){this.removeStopMarkers(),this.removeSelectedRoute();var t=e.features[0].properties,i=this._departures[t.id].routes;this.calculatePassengerVolumes(t.id);var a,n=[],r=Object(s["a"])(i);try{for(r.s();!(a=r.n()).done;){var o=a.value;n.push(this._routeData[o])}}catch(l){r.e(l)}finally{r.f()}n.sort((function(e,t){return e.departures>t.departures?-1:1})),this.routesOnLink=n,this.highlightAllAttachedRoutes(),n.length>0&&this.showRouteDetails(n[0].id)}},{key:"calculatePassengerVolumes",value:function(e){if(this.cfDemandLink&&this.cfDemand){this.cfDemandLink.filter(e);var t=this.cfDemand.allFiltered(),i=0;t.map((function(e){i=i+e.passengersBoarding+e.passengersAtArrival-e.passengersAlighting})),console.log({sum:i,allLinks:t})}}},{key:"removeAttachedRoutes",value:function(){var e,t=Object(s["a"])(this._attachedRouteLayers);try{for(t.s();!(e=t.n()).done;){var i=e.value;try{this.mymap.removeLayer("route-"+i),this.mymap.removeSource("source-route-"+i)}catch(a){}}}catch(n){t.e(n)}finally{t.f()}this._attachedRouteLayers=[]}},{key:"highlightAllAttachedRoutes",value:function(){this.removeAttachedRoutes();var e,t=Object(s["a"])(this.routesOnLink);try{for(t.s();!(e=t.n()).done;){var i=e.value;this.mymap.addSource("source-route-"+i.id,{data:i.geojson,type:"geojson"}),this.mymap.addLayer({id:"route-"+i.id,source:"source-route-"+i.id,type:"line",paint:{"line-opacity":.7,"line-width":8,"line-color":"#ccff33"}}),this._attachedRouteLayers.push(i.id)}}catch(a){t.e(a)}finally{t.f()}}},{key:"pressedEscape",value:function(){this.removeSelectedRoute(),this.removeStopMarkers(),this.removeAttachedRoutes(),this.selectedRoute=null,this.routesOnLink=[]}},{key:"pressedArrowKey",value:function(e){if(this.selectedRoute){var t=this.routesOnLink.indexOf(this.selectedRoute);t+=e,t<0||t>=this.routesOnLink.length||this.showRouteDetails(this.routesOnLink[t].id)}}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],pn.prototype,"root",void 0),Object(h["a"])([Object(d["b"])({required:!1})],pn.prototype,"fileApi",void 0),Object(h["a"])([Object(d["b"])({required:!1})],pn.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],pn.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],pn.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["d"])("$store.state.resizeEvents")],pn.prototype,"handleResize",null),Object(h["a"])([Object(d["d"])("$store.state.viewState")],pn.prototype,"mapMoved",null),Object(h["a"])([Object(d["d"])("$store.state.colorScheme")],pn.prototype,"swapTheme",null),pn=Object(h["a"])([Object(d["a"])({components:{CollapsiblePanel:E["a"],LeftDataPanel:Aa,LegendBox:cn,DrawingTool:oa["a"]}})],pn),M["a"].commit("registerPlugin",{kebabName:"transit-demand",prettyName:"Transit Demand",description:"Transit passengers and ridership",filePatterns:["*output_transitSchedule.xml?(.gz)"],component:pn});var mn=pn,fn=O()({colormap:"viridis",nshades:dn}),vn=mn,gn=(i("a998"),i("d8a0")),bn=Object(U["a"])(vn,Ja,Qa,!1,null,"28d8cc66",null);"function"===typeof gn["default"]&&Object(gn["default"])(bn);var yn=bn.exports,kn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"gl-viz",class:{"hide-thumbnail":!e.thumbnail},style:{background:e.urlThumbnail},attrs:{oncontextmenu:"return false"}},[!e.thumbnail&&e.isLoaded?i("polygon-layer",{staticClass:"anim",attrs:{props:e.mapProps}}):e._e(),e.isLoaded&&!e.thumbnail?i("div",{staticClass:"left-side"},[i("collapsible-panel",{attrs:{direction:"left",locked:!0}},[i("div",{staticClass:"panel-items"},[i("p",{staticClass:"big"},[e._v(e._s(e.vizDetails.title))]),i("p",[e._v(e._s(e.vizDetails.description))])])])],1):e._e(),e.isLoaded&&!e.thumbnail?i("div",{staticClass:"right-side"},[i("collapsible-panel",{staticClass:"selector-panel",attrs:{direction:"right"}},[i("div",{staticClass:"panel-items"},[i("div",{staticClass:"panel-item"},[i("p",[i("b",[e._v(e._s(e.$t("selectColumn")))])]),i("div",{staticClass:"dropdown full-width is-hoverable is-right"},[i("div",{staticClass:"dropdown-trigger"},[i("button",{staticClass:"button full-width is-warning",class:{"is-loading":""===e.activeHeader},attrs:{"aria-haspopup":"true","aria-controls":"dropdown-menu-column-selector"}},[i("b",[e._v(e._s(e.buttonTitle))]),i("span",{staticClass:"icon is-small"},[i("i",{staticClass:"fas fa-angle-down",attrs:{"aria-hidden":"true"}})])])]),i("div",{staticClass:"dropdown-menu",style:{"max-height":"16rem","overflow-y":"auto",border:"1px solid #ccc"},attrs:{id:"dropdown-menu-column-selector",role:"menu"}},[i("div",{staticClass:"dropdown-content"},e._l(e.shapefile.header,(function(t){return i("a",{staticClass:"dropdown-item",on:{click:function(i){return e.handleNewDataColumn(t)}}},[e._v(e._s(t))])})),0)])])])]),i("polygon-configurator",{on:{opacity:e.handleOpacity}})],1)],1):e._e(),!e.thumbnail&&e.myState.statusMessage?i("div",{staticClass:"nav"},[i("p",{staticClass:"status-message"},[e._v(e._s(e.myState.statusMessage))])]):e._e()],1)},Sn=[],wn=i("7ca5"),On=i.n(wn),Cn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"configurator"},[i("div",{staticClass:"panel-section"},[i("h3",[e._v(e._s(e.$t("opacity")))]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.sliderOpacity,expression:"sliderOpacity"}],staticClass:"slider has-output is-fullwidth is-danger",attrs:{id:"sliderOpacity",min:"0",max:"100",step:"5",type:"range"},domProps:{value:e.sliderOpacity},on:{__r:function(t){e.sliderOpacity=t.target.value}}}),i("p",[i("output",{attrs:{for:"sliderOpacity"}},[e._v(e._s(e.sliderOpacity))])])])])},jn=[],xn=i("25d3"),Tn=i.n(xn);d["c"].use(ze["VuePlugin"]);var _n=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.activeHeader="",e.isButtonActiveColumn=!1,e.maxValueForScaling=1e3,e.selectedColorRamp="viridis",e.sliderOpacity=30,e.colorRamps={viridis:{png:"scale-viridis.png"},inferno:{png:"scale-inferno.png"},bluered:{png:"scale-salinity.png",diff:!0},picnic:{png:"scale-picnic.png"}},e.isDarkMode=e.$store.state.isDarkMode,e}return Object(l["a"])(i,[{key:"mounted",value:function(){Tn.a.attach()}},{key:"handleOpacity",value:function(){this.$emit("opacity",this.sliderOpacity)}},{key:"buttonTitle",get:function(){return this.activeHeader?this.activeHeader:this.$t("loading")}}]),i}(d["c"]);Object(h["a"])([Object(d["d"])("sliderOpacity")],_n.prototype,"handleOpacity",null),_n=Object(h["a"])([Object(d["a"])({components:{TimeSlider:Bi,ToggleButton:f["ToggleButton"]}})],_n);var Rn=_n,Mn=Rn,An=(i("9c40"),i("648f")),Dn=Object(U["a"])(Mn,Cn,jn,!1,null,"0e960e5f",null);"function"===typeof An["default"]&&Object(An["default"])(Dn);var En=Dn.exports,Ln=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"map",attrs:{id:e.mapID}})},Fn=[],Pn=(i("4fad"),i("7306")),zn=Object(ea["a"])().domain([0,.1,.2,.3,.4,.5,.6,.7,.8,.9]).range([[26,152,80],[102,189,99],[166,217,106],[217,239,139],[255,255,191],[254,224,139],[253,174,97],[244,109,67],[215,48,39],[168,0,0]]),In=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.mapID="map-id-".concat(Math.floor(1e12*Math.random())),e}return Object(l["a"])(i,[{key:"viewState",get:function(){return this.$store.state.viewState}},{key:"viewMoved",value:function(){this.layerManager.deckInstance.setProps({viewState:this.viewState})}},{key:"swapTheme",value:function(){this.layerManager.updateStyle()}},{key:"handlePropsChanged",value:function(){this.layerManager&&this.updateLayers()}},{key:"mounted",value:function(){console.log(this.mapID),this.setupLayerManager(),this.updateLayers()}},{key:"beforeDestroy",value:function(){this.layerManager.destroy()}},{key:"setupLayerManager",value:function(){var e=this;this.layerManager=new ta["a"],this.layerManager.init({container:"#".concat(this.mapID),viewState:this.$store.state.viewState,pickingRadius:3,getTooltip:this.getTooltip,onViewStateChange:function(t){var i=t.viewState;e.$store.commit("setMapCamera",i)}})}},{key:"handleClick",value:function(){console.log("click!")}},{key:"getTooltip",value:function(e){var t=e.object,i=e.x,a=e.y;if(t){t.properties.centerX&&delete t.properties.centerX,t.properties.centerY&&delete t.properties.centerY;for(var n=0,s=Object.keys(t.properties);n<s.length;n++){var r=s[n],o=t.properties[r];isNaN(o)||(t.properties[r]=Math.round(1e3*o)/1e3)}var l=24+22*Object.keys(t.properties).length;a+l<window.innerHeight&&(l=0);for(var c='<div id="shape-tooltip" class="tooltip">',u=0,h=Object.entries(t.properties);u<h.length;u++){var d=Object(pe["a"])(h[u],2),p=d[0],m=d[1];c+="<div>".concat(p,":&nbsp;<b>").concat(m,"</b></div>")}return{html:c,style:{backgroundColor:this.props.dark?"#445":"white",color:this.props.dark?"white":"#222",fontSize:"0.9rem",padding:"1rem 1rem",position:"absolute",left:i+10,top:a-l,boxShadow:"0px 2px 10px #22222266"}}}}},{key:"updateLayers",value:function(){var e=this;this.layerManager.removeLayer("shapefile"),this.layerManager.addLayer(new Pn["a"]({id:"shapefileLayer",data:this.props.shapefile.data,filled:!0,lineWidthUnits:"pixels",lineWidthMinPixels:1,pickable:!0,stroked:!0,opacity:.01*this.props.opacity,autoHighlight:!0,parameters:{depthTest:!0},getLineColor:[255,255,255,128],getFillColor:function(t){return zn(t.properties[e.props.activeColumn]/e.props.maxValue)},getLineWidth:2,getTooltip:this.getTooltip,updateTriggers:{getFillColor:{dark:this.props.dark,colors:this.props.colors,activeColumn:this.props.activeColumn,maxValue:this.props.maxValue}},transitions:{getFillColor:250}}))}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],In.prototype,"props",void 0),Object(h["a"])([Object(d["d"])("viewState")],In.prototype,"viewMoved",null),Object(h["a"])([Object(d["d"])("props.dark")],In.prototype,"swapTheme",null),Object(h["a"])([Object(d["d"])("props")],In.prototype,"handlePropsChanged",null),In=Object(h["a"])([Object(d["a"])({components:{}})],In);var Nn=In,Hn=Nn,Bn=Object(U["a"])(Hn,Ln,Fn,!1,null,null,null),Vn=Bn.exports;d["c"].use(ze["VuePlugin"]);var Un=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.shapefile={data:[],prj:"",header:[],bbox:{minX:0,minY:0,maxX:0,maxY:0}},e.activeHeader="",e.isButtonActiveColumn=!1,e.center=[13.45,52.53],e.maxValueForScaling=1e3,e.opacity=70,e.selectedColorRamp="viridis",e.colorRamps={viridis:{png:"scale-viridis.png"},inferno:{png:"scale-inferno.png"},bluered:{png:"scale-salinity.png",diff:!0},picnic:{png:"scale-picnic.png"}},e.vizDetails={title:"",description:"",csvFile:"",csvBase:"",useSlider:!1,shpFile:"",dbfFile:"",geojsonFile:"",projection:"",scaleFactor:1,thumbnail:"",sum:!1},e.myState={statusMessage:"",fileApi:void 0,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.globalState=M["a"].state,e.isDarkMode=e.globalState.colorScheme===Q["a"].DarkMode,e.isLoaded=!1,e.thumbnailUrl="url('assets/thumbnail.jpg') no-repeat;",e.columnMax={},e}return Object(l["a"])(i,[{key:"buildFileApi",value:function(){var e=this.getFileSystem(this.root);this.myState.fileApi=new Pe["a"](e),this.myState.fileSystem=e}},{key:"urlThumbnail",get:function(){return this.thumbnailUrl}},{key:"mapProps",get:function(){return{shapefile:this.shapefile,dark:this.isDarkMode,colors:this.selectedColorRamp,activeColumn:this.activeHeader,maxValue:this.maxValueForScaling,opacity:this.opacity}}},{key:"getFileSystem",value:function(e){var t=M["a"].state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.vizDetails.title="Shapefile",t=decodeURI(this.myState.yamlConfig.replaceAll("_"," ").replace(".shp","")),this.vizDetails.description=t,this.$emit("title","Shapefile: ".concat(this.myState.yamlConfig.slice(0,this.myState.yamlConfig.length-4)));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"buildThumbnail",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return");case 2:if(!this.thumbnail||!this.vizDetails.thumbnail){e.next=17;break}return e.prev=3,e.next=6,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail);case 6:return t=e.sent,e.next=9,g.a.arraybuffer(t);case 9:i=e.sent,a=this.arrayBufferToBase64(i),a&&(this.thumbnailUrl="center / cover no-repeat url(data:image/png;base64,".concat(a,")")),e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](3),console.error(e.t0);case 17:case"end":return e.stop()}}),e,this,[[3,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"swapTheme",value:function(){this.isDarkMode=this.globalState.colorScheme===Q["a"].DarkMode}},{key:"arrayBufferToBase64",value:function(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}},{key:"buttonTitle",get:function(){return this.activeHeader?this.activeHeader:this.$t("loading")}},{key:"clickedColorRamp",value:function(e){this.selectedColorRamp=e,console.log(this.selectedColorRamp)}},{key:"handleNewDataColumn",value:function(e){if(!this.columnMax[e]){var t=0;Object.values(this.shapefile.data).forEach((function(i){t=Math.max(t,i.properties[e])})),t&&(this.columnMax[e]=t||1)}this.activeHeader=e,this.maxValueForScaling=this.columnMax[e],this.isButtonActiveColumn=!1}},{key:"findCenter",value:function(e){return[13.45,52.53]}},{key:"mounted",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return M["a"].commit("setFullScreen",!this.thumbnail),this.buildFileApi(),e.next=4,this.getVizDetails();case 4:if(this.buildThumbnail(),!this.thumbnail){e.next=7;break}return e.abrupt("return");case 7:this.myState.statusMessage="Dateien laden...",this.loadShapefile(),this.center=this.findCenter([]),this.isLoaded=!0,this.myState.statusMessage="";case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestroy",value:function(){M["a"].commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1)}},{key:"loadShapefile",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r,o,l,c,u,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return");case 2:return console.log("loading shapefile"),t="".concat(this.myState.subfolder,"/").concat(this.myState.yamlConfig),console.log(t),i={},e.prev=6,s=this.myState.fileApi.getFileBlob(t),r=this.myState.fileApi.getFileBlob(t.replace(".shp",".dbf")),e.next=11,Promise.all([s,r]);case 11:return e.next=13,s;case 13:if(e.t1=a=e.sent,e.t0=null===e.t1,e.t0){e.next=17;break}e.t0=void 0===a;case 17:if(!e.t0){e.next=21;break}e.t2=void 0,e.next=22;break;case 21:e.t2=a.arrayBuffer();case 22:return e.next=24,e.t2;case 24:return o=e.sent,e.next=27,r;case 27:if(e.t4=n=e.sent,e.t3=null===e.t4,e.t3){e.next=31;break}e.t3=void 0===n;case 31:if(!e.t3){e.next=35;break}e.t5=void 0,e.next=36;break;case 35:e.t5=n.arrayBuffer();case 36:return e.next=38,e.t5;case 38:if(l=e.sent,o&&l){e.next=41;break}return e.abrupt("return");case 41:return e.next=43,va["a"](o,l);case 43:i=e.sent,e.next=51;break;case 46:return e.prev=46,e.t6=e["catch"](6),console.error(e.t6),this.myState.statusMessage=""+e.t6,e.abrupt("return");case 51:return c="",e.prev=52,e.next=55,this.myState.fileApi.getFileText(t.replace(".shp",".prj"));case 55:c=e.sent,e.next=60;break;case 58:e.prev=58,e.t7=e["catch"](52);case 60:c&&(i=On.a.toWgs84(i,c)),console.log({geojson:i}),u=i.bbox,console.log({bbox:u}),h=Object.keys(i.features[0].properties),this.shapefile={data:i.features,prj:c,header:h,bbox:u},this.$store.commit("setMapCamera",{longitude:.5*(u[2]+u[0]),latitude:.5*(u[3]+u[1]),bearing:0,pitch:0,zoom:8}),this.handleNewDataColumn(this.shapefile.header[0]);case 68:case"end":return e.stop()}}),e,this,[[6,46],[52,58]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"handleOpacity",value:function(e){this.opacity=e}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],Un.prototype,"root",void 0),Object(h["a"])([Object(d["b"])({required:!0})],Un.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],Un.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],Un.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["d"])("$store.state.colorScheme")],Un.prototype,"swapTheme",null),Un=Object(h["a"])([Object(d["a"])({components:{CollapsiblePanel:E["a"],PolygonConfigurator:En,PolygonLayer:Vn,TimeSlider:Bi,ToggleButton:f["ToggleButton"]}})],Un),M["a"].commit("registerPlugin",{kebabName:"shape-file",prettyName:"Shapefile",description:"Shapefile Viewer",filePatterns:["*.shp"],component:Un});var qn=Un,Wn=qn,$n=(i("c27d"),i("a2d2")),Gn=Object(U["a"])(Wn,kn,Sn,!1,null,"69df7336",null);"function"===typeof $n["default"]&&Object($n["default"])(Gn);var Yn=Gn.exports,Xn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"mycomponent",attrs:{id:e.containerId}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!e.thumbnail&&e.loadingText,expression:"!thumbnail && loadingText"}],staticClass:"status-blob"},[i("p",[e._v(e._s(e.loadingText))])]),e.thumbnail||e.isMobile()?e._e():i("div",{staticClass:"map-complications"},[i("legend-box",{staticClass:"complication",attrs:{rows:e.legendRows}}),i("scale-box",{staticClass:"complication",attrs:{rows:e.scaleRows}})],1),i("div",{staticClass:"map-container"},[i("div",{staticClass:"mymap",attrs:{id:e.mapId}})]),e.thumbnail||e.loadingText?e._e():i("collapsible-panel",{staticClass:"left-panel",attrs:{darkMode:e.isDarkMode,direction:"left",locked:!0}},[i("div",{staticClass:"info-header",staticStyle:{padding:"0 0.5rem"}},[i("h3",[e._v(e._s(this.vizDetails.title?this.vizDetails.title:"O/D Flows"))])]),this.vizDetails.description?i("div",{staticClass:"info-description",staticStyle:{padding:"0 0.5rem"}},[i("p",{staticClass:"description"},[e._v(e._s(this.vizDetails.description))])]):e._e(),i("div",{staticClass:"widgets"},[i("h4",{staticClass:"heading"},[e._v("Uhrzeit")]),e.headers.length>0?i("time-slider",{staticClass:"time-slider",attrs:{useRange:e.showTimeRange,stops:e.headers},on:{change:e.bounceTimeSlider}}):e._e(),i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showTimeRange,expression:"showTimeRange"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showTimeRange)?e._i(e.showTimeRange,null)>-1:e.showTimeRange},on:{change:function(t){var i=e.showTimeRange,a=t.target,n=!!a.checked;if(Array.isArray(i)){var s=null,r=e._i(i,s);a.checked?r<0&&(e.showTimeRange=i.concat([s])):r>-1&&(e.showTimeRange=i.slice(0,r).concat(i.slice(r+1)))}else e.showTimeRange=n}}}),e._v(" Zeitraum")]),i("h4",{staticClass:"heading"},[e._v("Kreise")]),i("div",{staticClass:"white-box"},[i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showCentroids,expression:"showCentroids"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showCentroids)?e._i(e.showCentroids,null)>-1:e.showCentroids},on:{change:function(t){var i=e.showCentroids,a=t.target,n=!!a.checked;if(Array.isArray(i)){var s=null,r=e._i(i,s);a.checked?r<0&&(e.showCentroids=i.concat([s])):r>-1&&(e.showCentroids=i.slice(0,r).concat(i.slice(r+1)))}else e.showCentroids=n}}}),e._v(" Kreise anzeigen")]),i("label",{staticClass:"checkbox"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.showCentroidLabels,expression:"showCentroidLabels"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.showCentroidLabels)?e._i(e.showCentroidLabels,null)>-1:e.showCentroidLabels},on:{change:function(t){var i=e.showCentroidLabels,a=t.target,n=!!a.checked;if(Array.isArray(i)){var s=null,r=e._i(i,s);a.checked?r<0&&(e.showCentroidLabels=i.concat([s])):r>-1&&(e.showCentroidLabels=i.slice(0,r).concat(i.slice(r+1)))}else e.showCentroidLabels=n}}}),e._v(" Nummern anzeigen")])]),i("h4",{staticClass:"heading"},[e._v("Strecken")]),i("div",{staticClass:"white-box"},[i("div",{staticClass:"subheading"},[e._v("Linienbreiten")]),i("scale-slider",{staticClass:"scale-slider",attrs:{stops:e.scaleValues,initialTime:1},on:{change:e.bounceScaleSlider}}),i("div",{staticClass:"subheading"},[e._v("Ausblenden bis")]),i("line-filter-slider",{staticClass:"scale-slider",attrs:{initialValue:e.lineFilter},on:{change:e.bounceLineFilter}})],1),i("h4",{staticClass:"heading"},[e._v("Insgesamt für")]),i("div",{staticClass:"buttons-bar"},[i("button",{staticClass:"button",class:{"is-link":e.isOrigin,"is-active":e.isOrigin},on:{click:e.clickedOrigins}},[e._v("Quellen")]),i("button",{staticClass:"button",class:{"is-link":!e.isOrigin,"is-active":!e.isOrigin},attrs:{hint:"hide"},on:{click:e.clickedDestinations}},[e._v("Zielorte")])])],1)])],1)},Zn=[],Kn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"legend-container"}},[i("p",{staticClass:"title"},[e._v("Legende:")]),e._l(e.rows,(function(t){return i("div",{staticClass:"legend-item"},["string"===typeof t&&t.includes("#")?i("div",{staticClass:"legend-col",style:{"background-color":t}}):e._e(),"string"!==typeof t||t.includes("#")||"↓"!=t?e._e():i("div",{staticClass:"legend-element1"},[e._v(e._s(t))]),"string"!==typeof t||t.includes("#")||"↓"==t?e._e():i("div",{staticClass:"legend-element2"},[e._v(e._s(t))])])}))],2)},Jn=[],Qn=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){return Object(o["a"])(this,i),t.apply(this,arguments)}return i}(d["c"]);Object(h["a"])([Object(d["b"])({type:Array,required:!0})],Qn.prototype,"rows",void 0),Qn=Object(h["a"])([d["a"]],Qn);var es=Qn,ts=es,is=(i("a78e"),Object(U["a"])(ts,Kn,Jn,!1,null,"58dab486",null)),as=is.exports,ns=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.scaleSlider,!1))],1)},ss=[],rs=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.sliderValue=0,e.scaleSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:0,data:[0,1,2,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100,"Alle"],marks:[0,25,50,75,"Alle"],contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom"},e}return Object(l["a"])(i,[{key:"created",value:function(){}},{key:"mounted",value:function(){this.sliderValue=this.initialValue}},{key:"setStops",value:function(e){console.log({newStops:e}),this.stops=e}},{key:"sliderChangedEvent",value:function(e){console.log(e),this.$emit("change",e)}},{key:"dataFunction",value:function(){return{value:this.sliderValue,data:this.stops}}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])()],rs.prototype,"initialValue",void 0),Object(h["a"])([Object(d["b"])()],rs.prototype,"useRange",void 0),Object(h["a"])([Object(d["b"])()],rs.prototype,"stops",void 0),Object(h["a"])([Object(d["d"])("stops")],rs.prototype,"setStops",null),Object(h["a"])([Object(d["d"])("sliderValue")],rs.prototype,"sliderChangedEvent",null),rs=Object(h["a"])([Object(d["a"])({components:{"vue-slider":m.a}})],rs);var os=rs,ls=os,cs=(i("f0aa"),Object(U["a"])(ls,ns,ss,!1,null,"25daa34f",null)),us=cs.exports,hs=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"scale-container"}},[i("p",{staticClass:"title"},[e._v("Linienbreite:")]),i("div",{staticClass:"scale-element"},[e._v(e._s("|↔︎|"))]),i("div",{staticClass:"scale-scale"},[e._v(e._s("~ "+this.rows[0]+" Fahrten"))]),i("p")])},ds=[],ps=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){return Object(o["a"])(this,i),t.apply(this,arguments)}return Object(l["a"])(i,[{key:"created",value:function(){}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({type:Array,required:!0})],ps.prototype,"rows",void 0),ps=Object(h["a"])([d["a"]],ps);var ms=ps,fs=ms,vs=(i("f6f0"),Object(U["a"])(fs,hs,ds,!1,null,"35b58d78",null)),gs=vs.exports,bs=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"time-slider-main-content"},[i("vue-slider",e._b({staticClass:"time-slider",model:{value:e.sliderValue,callback:function(t){e.sliderValue=t},expression:"sliderValue"}},"vue-slider",e.timeSlider,!1))],1)},ys=[],ks=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.TOTAL_MSG="All >>",e.sliderValue=e.TOTAL_MSG,e.timeSlider={height:6,piecewise:!0,show:!1,"enable-cross":!1,minRange:1,marks:[e.stops[0],e.stops[Math.floor(e.stops.length/2)],e.stops[e.stops.length-1]],contained:!0,sliderStyle:[{backgroundColor:"#f05b72"},{backgroundColor:"#3498db"}],processStyle:{backgroundColor:"#00bb5588",borderColor:"#f05b72"},tooltip:"always","tooltip-placement":"bottom",data:e.stops},e}return Object(l["a"])(i,[{key:"clockTime",get:function(){return this.convertSecondsToClockTime(this.sliderValue)}},{key:"created",value:function(){}},{key:"mounted",value:function(){}},{key:"initialTimeChanged",value:function(e){this.sliderValue=e}},{key:"changeUseRange",value:function(e){this.sliderValue=e?[this.stops[0],this.stops[this.stops.length-1]]:[this.stops[0]],console.log("changed to: "+this.sliderValue)}},{key:"setStops",value:function(e){console.log({newStops:e}),this.stops=e}},{key:"sliderChangedEvent",value:function(e){this.$emit("change",e)}},{key:"dataFunction",value:function(){return{value:this.sliderValue,data:this.stops}}},{key:"convertSecondsToClockTimeMinutes",value:function(e){try{var t=N(e),i=("00"+t.minutes).slice(-2);return"".concat(t.hours,":").concat(i)}catch(a){return"0:00"}}},{key:"convertSecondsToClockTime",value:function(e){var t=N(e),i=("00"+t.minutes).slice(-2),a=("00"+t.seconds).slice(-2);return"".concat(t.hours,":").concat(i,":").concat(a)}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])()],ks.prototype,"initialTime",void 0),Object(h["a"])([Object(d["b"])()],ks.prototype,"useRange",void 0),Object(h["a"])([Object(d["b"])()],ks.prototype,"stops",void 0),Object(h["a"])([Object(d["d"])("initialTime")],ks.prototype,"initialTimeChanged",null),Object(h["a"])([Object(d["d"])("useRange")],ks.prototype,"changeUseRange",null),Object(h["a"])([Object(d["d"])("stops")],ks.prototype,"setStops",null),Object(h["a"])([Object(d["d"])("sliderValue")],ks.prototype,"sliderChangedEvent",null),ks=Object(h["a"])([Object(d["a"])({components:{"vue-slider":m.a}})],ks);var Ss=ks,ws=Ss,Os=(i("fc60"),Object(U["a"])(ws,bs,ys,!1,null,"9a42ac2e",null)),Cs=Os.exports,js="Alle >>",xs=0,Ts=[1,3,5,10,25,50,100,150,200,300,400,450,500],_s=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.globalState=M["a"].state,e.myState={fileApi:void 0,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.vizDetails={csvFile:"",shpFile:"",dbfFile:"",projection:"",scaleFactor:1,title:"",description:""},e.containerId="c".concat(Math.floor(1e12*Math.random())),e.mapId="map-"+e.containerId,e.centroids={},e.centroidSource={},e.linkData={},e.spiderLinkFeatureCollection={},e.zoneData={},e.dailyData={},e.marginals={},e.hoveredStateId=0,e.rowName="",e.colName="",e.headers=[],e.geojson={},e.idColumn="",e.showTimeRange=!1,e.showCentroids=!0,e.showCentroidLabels=!0,e.isOrigin=!0,e.selectedCentroid=0,e.maxZonalTotal=0,e.loadingText="Aggregierte Quell-Ziel Muster",e.project={},e.scaleFactor=1,e.sliderValue=[1,500],e.scaleValues=Ts,e.currentScale=Ts[0],e.currentTimeBin=js,e.lineFilter=0,e.bounceTimeSlider=Object(qi["debounce"])(e.changedTimeSlider,100),e.bounceScaleSlider=Object(qi["debounce"])(e.changedScale,50),e.bounceLineFilter=Object(qi["debounce"])(e.changedLineFilter,250),e.isMapMoving=!1,e.isDarkMode=e.$store.state.colorScheme===Q["a"].DarkMode,e}return Object(l["a"])(i,[{key:"buildFileApi",value:function(){var e=this.getFileSystem(this.root);this.myState.fileApi=new Pe["a"](e),this.myState.fileSystem=e}},{key:"created",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this._mapExtentXYXY=[180,90,-180,-90],this._maximum=0;case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"destroyed",value:function(){M["a"].commit("setFullScreen",!1)}},{key:"mounted",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return M["a"].commit("setFullScreen",!this.thumbnail),this.buildFileApi(),e.next=4,this.getVizDetails();case 4:this.setupMap();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"mapMoved",value:function(e){var t=e.bearing,i=e.longitude,a=e.latitude,n=e.zoom,s=e.pitch;!this.mymap||this.isMapMoving||this.thumbnail?this.isMapMoving=!1:n&&(this.mymap.off("move",this.handleMapMotion),this.mymap.jumpTo({bearing:t,zoom:n,center:[i,a],pitch:s}),this.mymap.on("move",this.handleMapMotion))}},{key:"swapTheme",value:function(){var e=this;this.isDarkMode=this.$store.state.colorScheme===Q["a"].DarkMode,this.mymap&&(this.mymap.setStyle(this.isDarkMode?Q["f"].dark:Q["f"].light),this.mymap.on("style.load",(function(){e.buildCentroids(e.geojson),e.buildSpiderLinks(),e.addGeojsonToMap(e.geojson)})))}},{key:"handleResize",value:function(){this.mymap&&this.mymap.resize()}},{key:"clickedRange",value:function(e){console.log(e)}},{key:"clickedShowCentroids",value:function(){this.updateCentroidLabels()}},{key:"clickedShowCentroidBubbles",value:function(){this.updateCentroidLabels()}},{key:"handleMapMotion",value:function(){var e={longitude:this.mymap.getCenter().lng,latitude:this.mymap.getCenter().lat,bearing:this.mymap.getBearing(),zoom:this.mymap.getZoom(),pitch:this.mymap.getPitch()};this.$store.commit("setMapCamera",e),this.isMapMoving||(this.isMapMoving=!0)}},{key:"getFileSystem",value:function(e){var t=this.$store.state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 5:t=e.sent,this.vizDetails=y.a.parse(t),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](2),this.myState.fileSystem&&this.myState.fileSystem.needPassword&&401===e.t0.status&&M["a"].commit("requestLogin",this.myState.fileSystem.slug);case 12:this.$emit("title",this.vizDetails.title),this.scaleFactor=this.vizDetails.scaleFactor,this.projection=this.vizDetails.projection,this.idColumn=this.vizDetails.idColumn?this.vizDetails.idColumn:"id",ka.a.done();case 17:case"end":return e.stop()}}),e,this,[[2,9]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFiles",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,this.loadingText="Dateien laden...",e.next=6,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.vizDetails.csvFile);case 6:return t=e.sent,e.next=9,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.shpFile);case 9:return i=e.sent,e.next=12,g.a.arraybuffer(i);case 12:return a=e.sent,e.next=15,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.dbfFile);case 15:return n=e.sent,e.next=18,g.a.arraybuffer(n);case 18:return s=e.sent,e.abrupt("return",{shpFile:a,dbfFile:s,odFlows:t});case 22:return e.prev=22,e.t0=e["catch"](2),console.error({e:e.t0}),this.loadingText=""+e.t0,e.abrupt("return",null);case 27:case"end":return e.stop()}}),e,this,[[2,22]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"legendRows",get:function(){return["#00aa66","#880033","↓","↑"]}},{key:"setupMap",value:function(){this.mymap=new ba.a.Map({container:this.mapId,logoPosition:"bottom-right",style:this.isDarkMode?Q["f"].dark:Q["f"].light});try{var e=localStorage.getItem(this.$route.fullPath+"-bounds");if(e){var t=JSON.parse(e);this.isMobile();this.$store.commit("setMapCamera",{longitude:.5*(t[0]+t[2]),latitude:.5*(t[1]+t[3]),zoom:8,pitch:0,bearing:0,jump:!0})}}catch(g){}if(this.mymap.on("click",this.handleEmptyClick),this.mymap.on("load",this.mapIsReady),this.mymap.addControl(new ba.a.NavigationControl,"top-right"),this.mymap.on("move",this.handleMapMotion),this.thumbnail){var i,a=document.getElementsByClassName("mapboxgl-ctrl mapboxgl-ctrl-attrib mapboxgl-compact"),n=Object(s["a"])(a);try{for(n.s();!(i=n.n()).done;){var r=i.value;r.setAttribute("style","display: none")}}catch(b){n.e(b)}finally{n.f()}a=document.getElementsByClassName("mapboxgl-ctrl mapboxgl-ctrl-group");var o,l=Object(s["a"])(a);try{for(l.s();!(o=l.n()).done;){var c=o.value;c.setAttribute("style","display: none")}}catch(b){l.e(b)}finally{l.f()}a=document.getElementsByClassName("mapboxgl-ctrl-logo");var u,h=Object(s["a"])(a);try{for(h.s();!(u=h.n()).done;){var d=u.value;d.setAttribute("style","display: none")}}catch(b){h.e(b)}finally{h.f()}}else{var p,m=document.getElementsByClassName("mapboxgl-ctrl-logo"),f=Object(s["a"])(m);try{for(f.s();!(p=f.n()).done;){var v=p.value;v.setAttribute("style","margin-bottom: 3rem;")}}catch(b){f.e(b)}finally{f.f()}}}},{key:"handleEmptyClick",value:function(e){this.fadeUnselectedLinks(-1),this.isMobile()}},{key:"mapIsReady",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:if(t=e.sent,!t){e.next=18;break}return e.next=6,this.processShapefile(t);case 6:return this.geojson=e.sent,e.next=9,this.processHourlyData(t.odFlows);case 9:return e.next=11,this.getDailyDataSummary();case 11:this.marginals=e.sent,this.buildCentroids(this.geojson),this.convertRegionColors(this.geojson),this.addGeojsonToMap(this.geojson),this.setMapExtent(),this.buildSpiderLinks(),this.setupKeyListeners();case 18:this.loadingText="",ka.a.done();case 20:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"isMobile",value:function(){var e=window,t=document,i=t.documentElement,a=t.getElementsByTagName("body")[0],n=e.innerWidth||i.clientWidth||a.clientWidth;e.innerHeight||i.clientHeight||a.clientHeight;return n<640}},{key:"scaleRows",get:function(){return[Math.min(Math.round((1200*Math.pow(this.currentScale,-1)+20)*Math.sqrt(this.scaleFactor)),1e3*this.scaleFactor)]}},{key:"createSpiderLinks",value:function(){var e=this;this.spiderLinkFeatureCollection={type:"FeatureCollection",features:[]};for(var t=0,i=Object.keys(this.linkData);t<i.length;t++){var a=i[t],n=this.linkData[a];if(!(n.daily<=this.lineFilter))try{(function(){var t=e.centroids[n.orig].geometry.coordinates,i=e.centroids[n.dest].geometry.coordinates,s=t[1]-i[1]>0?"#00aa66":"#880033",r=.7,o={id:a,orig:n.orig,dest:n.dest,daily:n.daily,color:s,fade:r};o[js]=n.daily,n.values.forEach((function(t,i){o[e.headers[i+1]]=t||0}));var l={type:"Feature",properties:o,geometry:{type:"LineString",coordinates:[t,i]}};e.spiderLinkFeatureCollection.features.push(l)})()}catch(s){}}}},{key:"updateSpiderLinks",value:function(){if(this.createSpiderLinks(),this.selectedCentroid)this.fadeUnselectedLinks(this.selectedCentroid);else{var e=this.mymap;e.getSource("spider-source").setData(this.spiderLinkFeatureCollection)}}},{key:"buildSpiderLinks",value:function(){this.mymap.getSource("spider-source")||(this.createSpiderLinks(),this.mymap.addSource("spider-source",{data:this.spiderLinkFeatureCollection,type:"geojson"})),this.mymap.getLayer("spider-layer")&&this.mymap.removeLayer("spider-layer"),this.mymap.addLayer({id:"spider-layer",source:"spider-source",type:"line",paint:{"line-color":["get","color"],"line-width":["*",.002*this.scaleFactor,["get","daily"]],"line-offset":["*",.5,["get","daily"]],"line-opacity":["get","fade"]}},"centroid-layer"),this.changedScale(this.currentScale);var e=this;this.mymap.on("click","spider-layer",(function(t){e.clickedOnSpiderLink(t)})),this.mymap.on("mousemove","spider-layer",(function(t){e.mymap.getCanvas().style.cursor=t?"pointer":"grab"})),this.mymap.on("mouseleave","spider-layer",(function(){e.mymap.getCanvas().style.cursor="grab"}))}},{key:"clickedOrigins",value:function(){this.isOrigin=!0,this.updateCentroidLabels(),this.convertRegionColors(this.geojson);var e=this.mymap;e.getSource("shpsource").setData(this.geojson)}},{key:"clickedDestinations",value:function(){this.isOrigin=!1,this.updateCentroidLabels(),this.convertRegionColors(this.geojson);var e=this.mymap;e.getSource("shpsource").setData(this.geojson)}},{key:"updateCentroidLabels",value:function(){var e=this.isOrigin?"{dailyFrom}":"{dailyTo}",t=this.isOrigin?"widthFrom":"widthTo";this.mymap.getLayer("centroid-layer")&&this.mymap.removeLayer("centroid-layer"),this.mymap.getLayer("centroid-label-layer")&&this.mymap.removeLayer("centroid-label-layer"),this.showCentroids&&this.mymap.addLayer({id:"centroid-layer",source:"centroids",type:"circle",paint:{"circle-color":"#ec0","circle-radius":["get",t],"circle-stroke-width":3,"circle-stroke-color":"white"}}),this.showCentroidLabels&&this.mymap.addLayer({id:"centroid-label-layer",source:"centroids",type:"symbol",layout:{"text-field":e,"text-size":11},paint:this.showCentroids?{}:{"text-halo-color":"white","text-halo-width":2}})}},{key:"unselectAllCentroids",value:function(){this.fadeUnselectedLinks(-1),this.selectedCentroid=0}},{key:"clickedOnCentroid",value:function(e){e.originalEvent.stopPropagating=!0;var t=e.features[0].properties,i=t.id;i!==this.selectedCentroid?(this.selectedCentroid=i,this.fadeUnselectedLinks(i)):this.unselectAllCentroids()}},{key:"fadeUnselectedLinks",value:function(e){var t,i=this.mymap,a=Object(s["a"])(this.spiderLinkFeatureCollection.features);try{for(a.s();!(t=a.n()).done;){var n=t.value,r=n.properties.id.split(":"),o=r[0]===String(e)||r[1]===String(e)?.7:xs;-1===e&&(o=.7),n.properties.fade=o}}catch(l){a.e(l)}finally{a.f()}i.getSource("spider-source").setData(this.spiderLinkFeatureCollection)}},{key:"clickedOnSpiderLink",value:function(e){if(!e.originalEvent.stopPropagating){var t=e.features[0].properties,i=t.daily*this.scaleFactor,a=0,n=t.dest+":"+t.orig;this.linkData[n]&&(a=this.linkData[n].daily*this.scaleFactor);var s=i+a,r="<h1>".concat(s," Bidirectional Trips</h1><br/>");r+="<p> -----------------------------</p>",r+="<p>".concat(i," trips : ").concat(a," reverse trips</p>"),new ba.a.Popup({closeOnClick:!0}).setLngLat(e.lngLat).setHTML(r).addTo(this.mymap)}}},{key:"convertRegionColors",value:function(e){var t,i=Object(s["a"])(e.features);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.properties){var n=this.isOrigin?a.properties.dailyFrom:a.properties.dailyTo,r=n/this.maxZonalTotal,o=128+127*(1-r);o||(o=255),a.properties.blue=o}}}catch(l){i.e(l)}finally{i.f()}}},{key:"handleCentroidsForTimeOfDayChange",value:function(e){var t,i={type:"FeatureCollection",features:[]},a=Object(s["a"])(this.geojson.features);try{for(a.s();!(t=a.n()).done;){var n=t.value,r=wa["centerOfMass"](n);r.properties.id=n.id;var o=this.calculateCentroidValuesForZone(e,n);r.properties.dailyFrom=o.from*this.scaleFactor,r.properties.dailyTo=o.to*this.scaleFactor,this.dailyFrom=r.properties.dailyFrom,this.dailyTo=r.properties.dailyTo,r.properties.widthFrom=Math.min(35,Math.max(12,Math.pow(this.dailyFrom/this.scaleFactor,.3)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),r.properties.widthTo=Math.min(35,Math.max(12,Math.pow(this.dailyTo/this.scaleFactor,.3)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),n.properties||(n.properties={}),n.properties.dailyFrom=o.from,n.properties.dailyTo=o.to,r.properties.dailyFrom+r.properties.dailyTo>0&&(i.features.push(r),n.properties&&(this.centroids[n.properties[this.idColumn]]=r))}}catch(c){a.e(c)}finally{a.f()}this.centroidSource=i;var l=this.mymap;l.getSource("centroids").setData(this.centroidSource),this.updateCentroidLabels()}},{key:"calculateCentroidValuesForZone",value:function(e,t){var i=0,a=0;if("Alle >>"===e)return i=Math.round(this.marginals.rowTotal[t.id]),a=Math.round(this.marginals.colTotal[t.id]),{from:i,to:a};var n=this.marginals.from[t.id],s=this.marginals.to[t.id];if(Array.isArray(e)){var r=this.headers.indexOf(e[0])-1;r<0&&(r=0);for(var o=this.headers.indexOf(e[1])-1,l=r;l<=o;l++)i+=n?Math.round(n[l]):0,a+=s?Math.round(s[l]):0;return{from:i,to:a}}var c=this.headers.indexOf(e)-1;return i=n?Math.round(n[c]):0,a=s?Math.round(s[c]):0,{from:i,to:a}}},{key:"buildCentroids",value:function(e){var t,i={type:"FeatureCollection",features:[]},a=Object(s["a"])(e.features);try{for(a.s();!(t=a.n()).done;){var n=t.value;if(n.id){var r=wa["centerOfMass"](n);r.properties.id=n.id,r.id=n.id;var o=Math.round(this.marginals.rowTotal[n.id]),l=Math.round(this.marginals.colTotal[n.id]);o||(o=0),l||(l=0),r.properties.dailyFrom=o*this.scaleFactor,r.properties.dailyTo=l*this.scaleFactor,this.dailyFrom=r.properties.dailyFrom,this.dailyTo=r.properties.dailyTo,r.properties.widthFrom=Math.min(70,Math.max(12,Math.sqrt(this.dailyFrom/this.scaleFactor)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),r.properties.widthTo=Math.min(70,Math.max(12,Math.sqrt(this.dailyTo/this.scaleFactor)*(1.5+this.scaleFactor/(this.scaleFactor+50)))),o&&(this.maxZonalTotal=Math.max(this.maxZonalTotal,o)),l&&(this.maxZonalTotal=Math.max(this.maxZonalTotal,l)),n.properties||(n.properties={}),n.properties.dailyFrom=o,n.properties.dailyTo=l,r.properties.dailyFrom+r.properties.dailyTo>0&&(i.features.push(r),n.properties&&(this.centroids[n.id]=r),this.updateMapExtent(r.geometry.coordinates))}}}catch(u){a.e(u)}finally{a.f()}this.centroidSource=i,this.mymap.getSource("centroids")||this.mymap.addSource("centroids",{data:this.centroidSource,type:"geojson"}),this.updateCentroidLabels();var c=this;this.mymap.on("click","centroid-layer",(function(e){c.clickedOnCentroid(e)})),this.mymap.on("mousemove","centroid-layer",(function(e){c.mymap.getCanvas().style.cursor=e?"pointer":"grab"})),this.mymap.on("mouseleave","centroid-layer",(function(){c.mymap.getCanvas().style.cursor="grab"}))}},{key:"setMapExtent",value:function(){localStorage.setItem(this.$route.fullPath+"-bounds",JSON.stringify(this._mapExtentXYXY));var e=this.thumbnail?{animate:!1}:{padding:{top:50,bottom:100,right:100,left:300},animate:!1};this.mymap.fitBounds(this._mapExtentXYXY,e)}},{key:"setupKeyListeners",value:function(){var e=this;window.addEventListener("keyup",(function(t){27===t.keyCode&&e.pressedEscape()})),window.addEventListener("keydown",(function(t){38===t.keyCode&&e.pressedArrowKey(-1),40===t.keyCode&&e.pressedArrowKey(1)}))}},{key:"processShapefile",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Verkehrsnetz bauarbeiten...",e.next=3,va["a"](t.shpFile,t.dbfFile);case 3:return i=e.sent,i.features.length>150&&(this.lineFilter=10),this.loadingText="Koordinaten berechnen...",e.next=8,Object(R["forEachAsync"])(i.features,(function(e){!a.idColumn&&e.properties&&(a.idColumn=Object.keys(e.properties)[0]),e.properties&&(e.id=e.properties[a.idColumn]);try{"MultiPolygon"===e.geometry.type?a.convertMultiPolygonCoordinatesToWGS84(e):a.convertPolygonCoordinatesToWGS84(e)}catch(t){console.error("ERR with feature: "+e),console.error(t)}}));case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"convertPolygonCoordinatesToWGS84",value:function(e){var t,i=Object(s["a"])(e.geometry.coordinates);try{for(i.s();!(t=i.n()).done;){var a,n=t.value,r=[],o=Object(s["a"])(n);try{for(o.s();!(a=o.n()).done;){var l=a.value,c=Ca.toLngLat(this.projection,l);r.push(c)}}catch(u){o.e(u)}finally{o.f()}n.length=0,n.push.apply(n,r)}}catch(u){i.e(u)}finally{i.f()}}},{key:"origConvertMultiPolygonCoordinatesToWGS84",value:function(e){var t,i=Object(s["a"])(e.geometry.coordinates);try{for(i.s();!(t=i.n()).done;){var a,n=t.value,r=n[0],o=[],l=Object(s["a"])(r);try{for(l.s();!(a=l.n()).done;){var c=a.value,u=Object(Sa["default"])(this.projection,"WGS84",c);o.push(u)}}catch(h){l.e(h)}finally{l.f()}n[0]=o}}catch(h){i.e(h)}finally{i.f()}}},{key:"convertMultiPolygonCoordinatesToWGS84",value:function(e){e.geometry.coordinates=this.recurseWGS84(e.geometry.coordinates)}},{key:"recurseWGS84",value:function(e){var t,i=[],a=Object(s["a"])(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;Array.isArray(n[0])?i.push(this.recurseWGS84(n)):i.push(Object(Sa["default"])(this.projection,"WGS84",n))}}catch(r){a.e(r)}finally{a.f()}return i}},{key:"getDailyDataSummary",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,s,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={},i={},a={},n={},e.next=6,Object(R["forEachAsync"])(Object.keys(this.zoneData),(function(e){a[e]=Array(r.headers.length-1).fill(0);for(var s=0,o=Object.keys(r.zoneData[e]);s<o.length;s++){var l=o[s];t[e]||(t[e]=0),i[l]||(i[l]=0),r.dailyData[e][l]&&(t[e]+=r.dailyData[e][l],i[l]+=r.dailyData[e][l]),n[l]||(n[l]=Array(r.headers.length-1).fill(0));for(var c=0;c<r.headers.length-1;c++)r.zoneData[e][l][c]&&(a[e][c]+=r.zoneData[e][l][c],n[l][c]+=r.zoneData[e][l][c])}}));case 6:for(s in this.zoneData);return e.abrupt("return",{rowTotal:t,colTotal:i,from:a,to:n});case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"processHourlyData",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadingText="Uhrzeitdaten entwicklen...",i=t.split("\n"),a=i[0].indexOf(";")>0?";":",",n=i[0].split(a).map((function(e){return e.trim()})),this.rowName=n[0],this.colName=n[1],this.headers=[js].concat(n.slice(2)),e.next=9,Object(R["forEachAsync"])(i.slice(1),(function(e){var t=e.split(a),i=t.slice(2).map((function(e){return parseFloat(e)})),n=t[0],r=t[1];s.zoneData[n]||(s.zoneData[n]={}),s.zoneData[n][r]=i;var o=i.reduce((function(e,t){return e+t}),0);if(s.dailyData[n]||(s.dailyData[n]={}),s.dailyData[n][r]=o,0!==o){var l=String(t[0])+":"+String(t[1]);s.linkData[l]={orig:t[0],dest:t[1],daily:o,values:i}}}));case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateMapExtent",value:function(e){this._mapExtentXYXY[0]=Math.min(this._mapExtentXYXY[0],e[0]),this._mapExtentXYXY[1]=Math.min(this._mapExtentXYXY[1],e[1]),this._mapExtentXYXY[2]=Math.max(this._mapExtentXYXY[2],e[0]),this._mapExtentXYXY[3]=Math.max(this._mapExtentXYXY[3],e[1])}},{key:"addGeojsonToMap",value:function(e){this.addGeojsonLayers(e),this.addNeighborhoodHoverEffects()}},{key:"addGeojsonLayers",value:function(e){this.mymap.getSource("shpsource")||this.mymap.addSource("shpsource",{data:e,type:"geojson"}),this.mymap.getLayer("shplayer-fill")&&this.mymap.removeLayer("shplayer-fill"),this.mymap.addLayer({id:"shplayer-fill",source:"shpsource",type:"fill",paint:{"fill-color":["rgb",["get","blue"],["get","blue"],255],"fill-opacity":.5}},"water"),this.mymap.getLayer("shplayer-border")&&this.mymap.removeLayer("shplayer-border"),this.mymap.addLayer({id:"shplayer-border",source:"shpsource",type:"line",paint:{"line-color":"#66f","line-opacity":.5,"line-width":["case",["boolean",["feature-state","hover"],!1],3,1]}},"centroid-layer")}},{key:"addNeighborhoodHoverEffects",value:function(){var e=this;this.mymap.on("mousemove","shplayer-fill",(function(t){var i=e.mymap;t.features.length>0&&(e.hoveredStateId&&i.setFeatureState({source:"shpsource",id:e.hoveredStateId},{hover:!1}),e.hoveredStateId=t.features[0].properties[e.idColumn],i.setFeatureState({source:"shpsource",id:e.hoveredStateId},{hover:!0}))})),this.mymap.on("mouseleave","shplayer-fill",(function(){var t=e.mymap;e.hoveredStateId&&t.setFeatureState({source:"shpsource",id:e.hoveredStateId},{hover:!1}),e.hoveredStateId=null}))}},{key:"offsetLineByMeters",value:function(e,t){try{var i=wa["lineOffset"](e,t,{units:"meters"});return i}catch(a){}return e}},{key:"pressedEscape",value:function(){this.unselectAllCentroids()}},{key:"pressedArrowKey",value:function(e){}},{key:"changedTimeSlider",value:function(e){this.currentTimeBin=e;var t=this.currentScale/500*this.scaleFactor;if(0==this.showTimeRange)this.mymap.setPaintProperty("spider-layer","line-width",["*",t,["get",e]]),this.mymap.setPaintProperty("spider-layer","line-offset",["*",.5*t,["get",e]]);else{var i,a=["+"],n=!1,r=Object(s["a"])(this.headers);try{for(r.s();!(i=r.n()).done;){var o=i.value;o===e[0]&&(n=!0),o!==js&&(n&&a.push(["get",o]),o===e[1]&&(n=!1))}}catch(l){r.e(l)}finally{r.f()}this.mymap.setPaintProperty("spider-layer","line-width",["*",t,a]),this.mymap.setPaintProperty("spider-layer","line-offset",["*",.5*t,a])}this.handleCentroidsForTimeOfDayChange(e)}},{key:"changedScale",value:function(e){this.currentScale=e,this.changedTimeSlider(this.currentTimeBin)}},{key:"changedLineFilter",value:function(e){this.lineFilter="Alle"===e?1/0:e,this.updateSpiderLinks()}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],_s.prototype,"root",void 0),Object(h["a"])([Object(d["b"])({required:!0})],_s.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],_s.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],_s.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["d"])("$store.state.viewState")],_s.prototype,"mapMoved",null),Object(h["a"])([Object(d["d"])("$store.state.colorScheme")],_s.prototype,"swapTheme",null),Object(h["a"])([Object(d["d"])("$store.state.resizeEvents")],_s.prototype,"handleResize",null),Object(h["a"])([Object(d["d"])("showTimeRange")],_s.prototype,"clickedRange",null),Object(h["a"])([Object(d["d"])("showCentroids")],_s.prototype,"clickedShowCentroids",null),Object(h["a"])([Object(d["d"])("showCentroidLabels")],_s.prototype,"clickedShowCentroidBubbles",null),_s=Object(h["a"])([Object(d["a"])({components:{CollapsiblePanel:E["a"],LegendBox:as,LineFilterSlider:us,ScaleBox:gs,ScaleSlider:Ia,TimeSlider:Cs}})],_s),M["a"].commit("registerPlugin",{kebabName:"aggregate-od",prettyName:"Origin/Destination Patterns",description:"Depicts aggregate O/D flows between areas.",filePatterns:["viz-od*.y?(a)ml"],component:_s});var Rs=_s,Ms=Rs,As=(i("6d32"),Object(U["a"])(Ms,Xn,Zn,!1,null,"5903374f",null)),Ds=As.exports,Es=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"sankey-container",class:{"show-thumbnail":e.myState.thumbnail},style:{"overflow-y":e.myState.thumbnail?"hidden":"auto"}},[i("div",{staticClass:"main-area",class:{"center-area":!e.myState.thumbnail}},[e.myState.thumbnail?e._e():i("div",{staticClass:"labels"},[i("h3",{staticClass:"center"},[e._v(e._s(e.vizDetails.title))]),i("h5",{staticClass:"center"},[e._v(e._s(e.vizDetails.description))]),i("p",{staticClass:"center"},[e._v(e._s(e.totalTrips.toLocaleString())+" total trips")])]),i("svg",{staticClass:"chart-area",attrs:{id:e.cleanConfigId}})])])},Ls=[],Fs=(i("caad"),i("ed18")),Ps=i("00a5"),zs=i("df19"),Is=i("a968"),Ns=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.globalState=M["a"].state,e.myState={fileApi:void 0,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.vizDetails={csv:"",title:"",description:""},e.loadingText="",e.jsonChart={},e.totalTrips=0,e}return Object(l["a"])(i,[{key:"cleanConfigId",get:function(){var e=this.myState.yamlConfig.replace(/[\W_]+/g,"");return e}},{key:"mounted",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.buildFileApi(),e.next=3,this.getVizDetails();case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"buildFileApi",value:function(){var e=this.getFileSystem(this.root);this.myState.fileApi=new Pe["a"](e),this.myState.fileSystem=e}},{key:"getFileSystem",value:function(e){var t=this.$store.state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"getVizDetails",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:t=e.sent,t&&(this.jsonChart=this.processInputs(t)),this.loadingText="",this.doD3(),ka.a.done();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFiles",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.myState.fileApi){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,this.loadingText="Loading files...",e.next=6,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);case 6:return t=e.sent,this.vizDetails=y.a.parse(t),this.$emit("title",this.vizDetails.title),e.next=11,this.myState.fileApi.getFileText(this.myState.subfolder+"/"+this.vizDetails.csv);case 11:return i=e.sent,e.abrupt("return",{flows:i});case 15:e.prev=15,e.t0=e["catch"](2),console.error({e:e.t0}),this.loadingText=""+e.t0,this.myState.fileSystem&&this.myState.fileSystem.needPassword&&401===e.t0.status&&M["a"].commit("requestLogin",this.myState.fileSystem.slug);case 20:case"end":return e.stop()}}),e,this,[[2,15]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"processInputs",value:function(e){this.loadingText="Building node graph...";var t=[],i=[],a=[];this.totalTrips=0;var n,r=e.flows.split("\n"),o=Object(s["a"])(r.slice(1));try{for(o.s();!(n=o.n()).done;){var l=n.value,c=l.trim().split(";");if(c&&!(c.length<2)){t.includes(c[0])||t.push(c[0]),i.includes(c[1])||i.push(c[1]);var u=parseFloat(c[2]);u>0&&(a.push([c[0],c[1],u]),this.totalTrips+=u)}}}catch(g){o.e(g)}finally{o.f()}var h={nodes:[],links:[]},d={},p={};t.forEach((function(e,t){h.nodes.push({id:t,title:e}),d[e]=t})),i.forEach((function(e,i){h.nodes.push({id:i+t.length,title:e}),p[e]=i+t.length}));for(var m=0,f=a;m<f.length;m++){var v=f[m];h.links.push({source:d[v[0]],target:p[v[1]],value:v[2]})}return h}},{key:"doD3",value:function(){var e=this.jsonChart;e.order=[[[4,1,2,3,0,5]],[[6,7,8,9,10,11]]],e.alignTypes=!0,e.alignLinkTypes=!0;var t=Object(Fs["sankey"])().extent([[100,100],[700,600]]).nodeWidth(3),i=Object(zs["a"])(Is["a"]),a=Object(Fs["sankeyDiagram"])().linkColor((function(e){var t=i(e.source.id);return t+"bb"}));Object(Ps["a"])("#"+this.cleanConfigId).datum(t(e)).call(a).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 800 800")}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!0})],Ns.prototype,"root",void 0),Object(h["a"])([Object(d["b"])({required:!0})],Ns.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],Ns.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],Ns.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["d"])("yamlConfig")],Ns.prototype,"changedYaml",null),Object(h["a"])([Object(d["d"])("subfolder")],Ns.prototype,"changedSubfolder",null),Ns=Object(h["a"])([Object(d["a"])({components:{}})],Ns),M["a"].commit("registerPlugin",{kebabName:"sankey-diagram",prettyName:"Flow Diagram",description:"Depicts flows between choices",filePatterns:["sankey*.y?(a)ml"],component:Ns});var Hs=Ns,Bs=Hs,Vs=(i("a28f"),Object(U["a"])(Bs,Es,Ls,!1,null,"58c39582",null)),Us=Vs.exports,qs=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.myState.yamlConfig?i("div",{attrs:{id:"vega-container"}},[i("div",{staticClass:"main-area"},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.myState.thumbnail,expression:"myState.thumbnail"}],staticClass:"labels"},[i("h5",{staticClass:"center"},[e._v(e._s(e.vizDetails.description))])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.myState.thumbnail,expression:"!(myState.thumbnail)"}],staticClass:"labels"},[i("h3",{staticClass:"center"},[e._v(e._s(e.title))]),i("h5",{staticClass:"center"},[e._v(e._s(e.description))])]),e.hasFacets?i("div",{staticClass:"chart-area center-chart"},[i("div",{staticClass:"vega-chart",style:{padding:e.thumbnail?"0 0":"1rem 1rem"},attrs:{id:e.cleanConfigId}})]):e._e(),e.hasFacets?e._e():i("div",{staticClass:"vega-chart",style:{padding:e.thumbnail?"0 0":"1rem 1rem"},attrs:{id:e.cleanConfigId}})])]):e._e()},Ws=[],$s=i("87e7"),Gs=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.globalState=M["a"].state,e.myState={fileApi:e.fileApi,fileSystem:void 0,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail},e.vizDetails={title:"",description:""},e.title="",e.description="",e.loadingText="Flow Diagram",e.jsonChart={},e.totalTrips=0,e}return Object(l["a"])(i,[{key:"cleanConfigId",get:function(){return this.myState.yamlConfig.replace(/[\W_]+/g,"")}},{key:"mounted",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.yamlConfig||this.buildRouteFromUrl(),e.next=3,this.getVizDetails();case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"authenticationChanged",value:function(){console.log("AUTH CHANGED - Reload"),this.getVizDetails()}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"hasFacets",get:function(){return!!this.vizDetails&&(!!this.vizDetails.encoding&&!!(this.vizDetails.encoding.facet||this.vizDetails.encoding.row||this.vizDetails.encoding.column))}},{key:"getFileSystem",value:function(e){var t=M["a"].state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Pe["a"](t),this.myState.fileSystem=t;var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.loadFiles();case 2:this.vizDetails=e.sent,this.vizDetails&&(this.jsonChart=this.processInputs()),this.loadingText="",ka.a.done();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadFiles",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={data:{}},e.prev=1,this.loadingText="Loading chart...",e.next=5,this.myState.fileApi.getFileJson(this.myState.subfolder+"/"+this.myState.yamlConfig);case 5:t=e.sent,this.description=t.description?t.description:"",this.title=t.title?t.title:this.myState.yamlConfig.substring(0,this.myState.yamlConfig.length-10).replace(/_/g," "),this.$emit("title",this.title),e.next=17;break;case 11:return e.prev=11,e.t0=e["catch"](1),console.error({e:e.t0}),this.loadingText=""+e.t0,this.myState.fileSystem&&this.myState.fileSystem.needPassword&&401===e.t0.status&&M["a"].commit("requestLogin",this.myState.fileSystem.slug),e.abrupt("return");case 17:if(!t.data.url){e.next=38;break}if(e.prev=18,i="",a=this.myState.subfolder+"/"+t.data.url,!t.data.url.endsWith(".json")){e.next=28;break}return e.next=24,this.myState.fileApi.getFileJson(a);case 24:i=e.sent,i&&(t.data={values:i}),e.next=33;break;case 28:if(!t.data.url.endsWith(".csv")){e.next=33;break}return e.next=31,this.myState.fileApi.getFileText(a);case 31:i=e.sent,i&&(t.data={values:i,format:{type:"csv"}});case 33:e.next=38;break;case 35:e.prev=35,e.t1=e["catch"](18),console.warn(e.t1);case 38:return e.abrupt("return",t);case 39:case"end":return e.stop()}}),e,this,[[1,11],[18,35]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"processInputs",value:function(){this.loadingText="Building chart...";var e={export:!0,source:!1,compiled:!1,editor:!1},t={actions:!this.thumbnail&&e,hover:!0,scaleFactor:2,padding:{top:2,left:8,right:8,bottom:8}};if(this.thumbnail&&this.vizDetails.encoding)for(var i=0,a=Object.keys(this.vizDetails.encoding);i<a.length;i++){var n=a[i];this.vizDetails.encoding[n].legend=null}Object($s["a"])("#".concat(this.cleanConfigId),this.vizDetails,t)}}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!1})],Gs.prototype,"fileApi",void 0),Object(h["a"])([Object(d["b"])({required:!1})],Gs.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],Gs.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],Gs.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["d"])("globalState.authAttempts")],Gs.prototype,"authenticationChanged",null),Object(h["a"])([Object(d["d"])("yamlConfig")],Gs.prototype,"changedYaml",null),Object(h["a"])([Object(d["d"])("subfolder")],Gs.prototype,"changedSubfolder",null),Gs=Object(h["a"])([Object(d["a"])({components:{}})],Gs),M["a"].commit("registerPlugin",{kebabName:"vega-lite",prettyName:"Chart",description:"Interactive chart visualization",filePatterns:["*.vega.json"],component:Gs});var Ys=Gs,Xs=Ys,Zs=(i("4978"),Object(U["a"])(Xs,qs,Ws,!1,null,"4a6d6772",null)),Ks=Zs.exports,Js=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{style:{padding:e.thumbnail?"0 0":"0 20px 20px 20px"},attrs:{id:"container"}},[e.thumbnail?e._e():i("h3",[e._v(e._s(e.title))]),i("div",{staticClass:"vid-container"},[e.movieSource?i("video-player",{ref:"videoPlayer",staticClass:"vjs-default-skin vjs-big-play-centered",attrs:{options:e.playerOptions}}):e._e()],1)])},Qs=[],er=i("d6d3"),tr=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.globalState=M["a"].state,e.movieSource="",e.title="",e.playerOptions={muted:!1,language:"en",playbackRates:[.5,1,1.5,2,5],preload:"metadata",responsive:!0,fluid:!0,playsInline:!0,controls:!0,sources:[]},e.myState={fileApi:e.fileApi,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,imageData:""},e.aspect=0,e}return Object(l["a"])(i,[{key:"destroyed",value:function(){window.removeEventListener("resize",this.onResize),this.thumbnail||M["a"].commit("setFullScreen",!1)}},{key:"mounted",value:function(){if(this.thumbnail||M["a"].commit("setFullScreen",!0),this.yamlConfig){var e=this.getFileSystem(this.$route.name);this.buildMovieSource(e.slug,this.subfolder+"/",this.yamlConfig)}else this.buildRouteFromUrl();this.getVizDetails(),this.thumbnail||this.generateBreadcrumbs(),this.thumbnail||window.addEventListener("resize",this.onResize)}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"buildMovieSource",value:function(e,t,i){this.movieSource="".concat(e,"/").concat(t).concat(i),this.playerOptions.sources.push({type:"video/mp4",src:this.movieSource})}},{key:"getFileSystem",value:function(e){var t=M["a"].state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length&&(t=M["a"].state.svnProjects.filter((function(t){return t.url===e.substring(8)}))),0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Pe["a"](t);var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n,this.buildMovieSource(t.slug,a,n)}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"onResize",value:function(){var e=document.getElementsByClassName("vid-container")[0],t=document.getElementsByClassName("video-js")[0];this.aspect||(this.aspect=t.clientHeight/t.clientWidth);e.clientWidth;var i=window.innerHeight,a=window.innerWidth;e.style.width="100%",e.style.margin="auto auto";var n=i-120,s=Math.floor(n/this.aspect);t.style.width="".concat(s,"px"),t.style.height="".concat(s*this.aspect,"px"),e.style.width="".concat(s,"px"),e.style.height="".concat(s*this.aspect,"px");var r=a-60;if(t.clientWidth>r){var o=r;t.style.width="".concat(o,"px"),t.style.height="".concat(o*this.aspect,"px"),e.style.width="".concat(o,"px"),e.style.height="".concat(o*this.aspect,"px")}}},{key:"generateBreadcrumbs",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a,n,r,o,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.getFileSystem(this.$route.params.project),t){e.next=3;break}return e.abrupt("return",[]);case 3:i=[{label:t.name,url:"/"+t.slug}],a=this.myState.subfolder.split("/"),n="/",r=Object(s["a"])(a),e.prev=7,r.s();case 9:if((o=r.n()).done){e.next=17;break}if(l=o.value,l){e.next=13;break}return e.abrupt("continue",15);case 13:n+=l+"/",i.push({label:l,url:"/"+t.slug+n});case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e["catch"](7),r.e(e.t0);case 22:return e.prev=22,r.f(),e.finish(22);case 25:return M["a"].commit("setBreadCrumbs",i),e.abrupt("return",i);case 27:case"end":return e.stop()}}),e,this,[[7,19,22,25]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getVizDetails",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.title=this.myState.yamlConfig.replace(/_/g," "),this.title=this.title.substring(0,this.title.lastIndexOf(".")),this.title&&this.$emit("title",this.title);case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!1})],tr.prototype,"fileApi",void 0),Object(h["a"])([Object(d["b"])({required:!1})],tr.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],tr.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],tr.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["d"])("yamlConfig")],tr.prototype,"changedYaml",null),Object(h["a"])([Object(d["d"])("subfolder")],tr.prototype,"changedSubfolder",null),tr=Object(h["a"])([Object(d["a"])({components:{"video-player":er["videoPlayer"]}})],tr),M["a"].commit("registerPlugin",{kebabName:"video-player",prettyName:"Video",description:"",filePatterns:["*.mp4"],component:tr});var ir=tr,ar=ir,nr=(i("9a5c"),Object(U["a"])(ar,Js,Qs,!1,null,"373919de",null)),sr=nr.exports,rr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.myState.yamlConfig?i("div",{staticClass:"image-container",class:{zthumbnail:e.thumbnail}},[i("img",{staticClass:"medium-zoom",class:{"invert-colors":e.isDarkMode},attrs:{src:e.myState.imageData}})]):e._e()},or=[],lr=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e;return Object(o["a"])(this,i),e=t.apply(this,arguments),e.globalState=M["a"].state,e.myState={fileApi:e.fileApi,subfolder:e.subfolder,yamlConfig:e.yamlConfig,thumbnail:e.thumbnail,imageData:""},e.matsimPngTitles={"modestats.png":"Mode statistics","ph_modestats.png":"Passenger hours traveled per mode","pkm_modestats.png":"Passenger km traveled per mode","scorestats.png":"Score statistics","stopwatch.png":"Stopwatch: computation time","traveldistancestatslegs.png":"Leg travel distance","traveldistancestatstrips.png":"Trip travel distance"},e}return Object(l["a"])(i,[{key:"isDarkMode",get:function(){return this.globalState.colorScheme==Q["a"].DarkMode}},{key:"mounted",value:function(){this.yamlConfig||this.buildRouteFromUrl(),this.getVizDetails()}},{key:"changedYaml",value:function(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()}},{key:"changedSubfolder",value:function(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},{key:"getFileSystem",value:function(e){var t=M["a"].state.svnProjects.filter((function(t){return t.slug===e}));if(0===t.length)throw console.log("no such project"),Error;return t[0]}},{key:"buildRouteFromUrl",value:function(){var e=this.$route.params;if(e.project&&e.pathMatch){var t=this.getFileSystem(e.project);this.myState.fileApi=new Pe["a"](t);var i=1+e.pathMatch.lastIndexOf("/"),a=e.pathMatch.substring(0,i),n=e.pathMatch.substring(i);this.myState.subfolder=a,this.myState.yamlConfig=n}else console.log("I CANT EVEN: NO PROJECT/PARHMATCH")}},{key:"getVizDetails",value:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){var t,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.myState.yamlConfig);case 3:if(t=e.sent,t){e.next=7;break}return console.log("no blob! :-("),e.abrupt("return");case 7:return e.next=9,g.a.dataurl(t);case 9:i=e.sent,this.myState.imageData=i,a=this.matsimPngTitles[this.yamlConfig]?this.matsimPngTitles[this.yamlConfig]:this.yamlConfig,this.$emit("title",a),e.next=19;break;case 15:return e.prev=15,e.t0=e["catch"](0),console.error({e:e.t0}),e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,this,[[0,15]])})));function t(){return e.apply(this,arguments)}return t}()}]),i}(d["c"]);Object(h["a"])([Object(d["b"])({required:!1})],lr.prototype,"fileApi",void 0),Object(h["a"])([Object(d["b"])({required:!1})],lr.prototype,"subfolder",void 0),Object(h["a"])([Object(d["b"])({required:!1})],lr.prototype,"yamlConfig",void 0),Object(h["a"])([Object(d["b"])({required:!1})],lr.prototype,"thumbnail",void 0),Object(h["a"])([Object(d["d"])("yamlConfig")],lr.prototype,"changedYaml",null),Object(h["a"])([Object(d["d"])("subfolder")],lr.prototype,"changedSubfolder",null),lr=Object(h["a"])([Object(d["a"])({components:{}})],lr),M["a"].commit("registerPlugin",{kebabName:"image-view",prettyName:"Image",description:"",filePatterns:["!(*thumbnail*).(png|jpg)"],component:lr});var cr=lr,ur=cr,hr=(i("0d03"),Object(U["a"])(ur,rr,or,!1,null,"440a1bdc",null)),dr=hr.exports,pr={VehicleAnimation:Vt,CarrierViewer:Ue,XyHexagons:Xt,AgentAnimation:Mi,LinksGl:pa,LinkVolumes:Ka,ShapeFile:Yn,SankeyDiagram:Us,VegaLite:Ks,AggregateOd:Ds,TransitDemand:yn,VideoPlayer:sr,ImageView:dr};t["a"]=pr},b944:function(e,t,i){e.exports=i.p+"img/tu-logo.b7699757.png"},b95e:function(e,t,i){},b998:function(e,t,i){"use strict";var a=i("9cbf"),n=i.n(a);t["default"]=n.a},bade:function(e,t,i){},bb86:function(e,t,i){},be4d:function(e,t,i){"use strict";i("1ef6")},beea:function(e,t,i){"use strict";var a=i("1da1"),n=(i("96cf"),i("ace4"),i("d3b7"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("db05")),s=i.n(n),r=i("083c"),o=i.n(r);function l(e){for(var t="",i=new Uint8Array(e),a=i.byteLength,n=0;n<a;n++)t+=String.fromCharCode(i[n]);return window.btoa(t)}function c(e,t){var i,a=this;return function(){for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];clearTimeout(i),i=setTimeout((function(){i=null,e.apply(a,s)}),t)}}function u(e,t){if(e.indexOf(t)>-1)return[t];var i=s()(e,t);return i.length?i:[]}function h(e,t){return d.apply(this,arguments)}function d(){return d=Object(a["a"])(regeneratorRuntime.mark((function e(t,i){var a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=function(){return{strict:!0,trim:!0,preserveChildrenOrder:!0,explicitChildren:!0,explicitArray:!0}},n=Object.assign(a,i),s=new o.a.Parser(n),e.abrupt("return",new Promise((function(e,i){s.parseString(t,(function(t,a){t?i(t):e(a)}))})));case 4:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}t["a"]={arrayBufferToBase64:l,debounce:c,findMatchingGlobInFiles:u,parseXML:h}},c27d:function(e,t,i){"use strict";i("258b")},c2a5:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"all":"All","opacity":"Opacity","colors":"Colors","scale":"Scale","loading":"Loading","selectColumn":"Select data column","timeOfDay":"Time of Day"},"de":{"all":"Alle","opacity":"Transparenz","colors":"Farben","loading":"Wird geladen","selectColumn":"Datenspalte wählen","timeOfDay":"Uhrzeit","scale":"Scale"}}'),delete e.options._Ctor}},c450:function(e,t,i){"use strict";var a=i("4219"),n=i.n(a);t["default"]=n.a},c4c6:function(e,t,i){"use strict";i("3eea")},cab3:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHQAAACACAYAAADamU0oAAAACXBIWXMAAAUjAAAFIwGBB/sRAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAD4ZJREFUeJztnX10HNV5xp/37qykgOzjgtP4IyanxJHsxDYklG/sGAKmAVx/4EF7Z2UjwIg6TVrOaUtPQtKz/YhDykkD+SipkhCBunN3GTA2JnUdIBgKIUBTDNZxLQFNDMQmQEOQbSxpd+btH1r52GZ3Je3Ovaul8/sP3bvv85pnZ3bm3vfeS3gfYNt2LB6PL2HmFQDOYOYZRDQbwDCAfUS0j5kfD4JgSzabfb7G6WqFap1ANXR0dDQNDg5+nohuAvDBcX5sDzN/JZPJ3AeANaZXE+rWUMdxLgNwBzOfUmGIpwF0KKX2hJhWzRG1TqASHMf5c2Z+oAozAeBsAM9IKZeHlddkoO4MdRznVma+DUAshHBTANyfSCTWhBBrUlBXt1wp5dUAujWEPhwEwaez2eyzGmIbpW4MlVIuAvAsgAYd8YnolVgs9vGenp5DOuKbop5uuV+HJjMBgJlPyefzN+qKb4q6uEITicRSInrUgNQAgI8qpd4yoKWFurhCiWi9IampAK4ypKWFigzt7OyMSymnL1261Ao7oWJaAC7TrTMKEa0wpaWDcd1yHcc5PQiCFUR0GYCPAPhQoSkA8AaAl4joQWbeEvaLuuM4S5j5sTBjjsGwZVkn1evDUdkrLJFInAfgH5n5fKKi3gsAMwDMYOYLANwipXwKwE1KqSdCyvHUkOKMl4ZcLtcC4DnDuqFQ1FDbtk+yLKsbQCWjKOcCeFxK2XPw4MENW7dufbfS5GzbPiUIgitLfJl0MgvvF0Mdx/kYMz8AYF4VcQnAuubm5tMcx1nhuu7e8X6wra1tvhBiNRGtZuZPVZFDxQghTqiFbhgcY2hbW1sLMz8F4KSQ4p/GzP9h2/ZZnue9XqqT4zhnBEGwmohWo/BFYq7dREgQBBXfVWrNEUOTyeTUIAg2ITwzR5ljWdaDtm0v9jzvMACkUimxZ8+e84UQq5h5NTN/pAa31ZIQ0au1zqFSjhjKzF0APqFJ5wzLsjZKKe8jIruvr28NEc2q5VVYhsF8Pv9irZOoFAKAtra2M4UQT6NORo40s1Up9ce1TqJSBADEYrGvITITAEBEW2qdQzUI27ZnM/NFtU6kBLuJ6G8BtMFQuYjv+wtM6OjCisfjq5h5slydPjP/XAjh5XK5ez3P+/Vog5TSBqB9IloIcaOUsqG1tfULqVQq0K0XNhYzL6txDoPM/DARbYrH4w/cfffd/1usExF9iZk/C+BEAzl9rr+/f1pnZ2dHV1dXzoBeaJCUcieA0wzrHmbmR4QQHhFtTqfTA+P5UCKRWEVE98LQLBERPZLL5VZ6nnfQhF4YkJTyTQDTDWr+xrKsj1Y6+C2l/CKAjSHnVI5n4vH4ZaXuHJMNgZFCKZP41cxkKKW+xsxJAIMh5PIWEY1VR3RWLpf7qW3bM0LQ047AyPSXSaq+fWUyGRfARQB2VRHmx0KIT+ZyuQsA3DNG30WxWOxn7e3tc6vQM4IAsN+w5ithBFFKPdXa2no6EV0DYLwjOwzgCWa+UCl1RTqdfs3zvOF8Pu8URspKQkR/4Pv+48lkcmHVyWuEpJR3AVhnUPNWpdRNYQdNJpMLfd9fIYQ4j5lPBTANgA/gt8zcT0SPCCEeSKfTr5UIQVLKrwL44hhSbwO4XCn1VIjphwYlEok1ROSZEhRCXJBOp580pTdRpJRfAHAbyjxJE9G7vu+vyWaz28xlNj6E7/v/jnAeMMbDG8PDwz83pFURSqlvA7gaQL5UH2Y+QQix2XGchLnMxofwPO8gM//IhBgRfcfzPN+EVjUopf4VwGoAh8t0a2BmV0o5qWp5BQDE4/EUgAOatd5oamq6TbNGaCiltgL4LEZqdUtBAL6ZSCRuMZPV2MQA4IUXXji0cOFCH8AluoSYeUNPT09drR3p7e3du2jRoocArEKZIUciumDBggXT16xZs33Hjh01neQ9elCepJRpAFKDzu1KqUl1a5oIUsp5RLR9HMsX01OmTLmmluO/Rz/J8cGDB9czc9hPoFv379//lyHHNIpSak8QBOdi7IGM5MDAwCbbtj9gIq9iHLPGsr+/Pzdnzpx0Y2Pjh4no9GqDM3PX66+/fvWOHTtKPjHWC729vQfmz5+fJaJPE9GHS/UjohYhxOL58+ffv3v37iGTOQJlqhQcx+lk5r8H8PsVxN1LRH/luq6x91tTrF279kTf9zeNY9qxl5kvzWQy+4wkVqDsxPa11147ZXBw8C+Y+ToAJb+VR/EygDsaGxu/293dberd1ji2bTdYlpXG2BPu/xMEwbJsNvuyibyA8dcRUSKROIOIfoziV+zLQohV6XS6msHyusK27ZhlWXcAuH6MrvuFEJea+n8zodITKeUuAMVqbn6qlPpMOCnVFSSlvAXAWGPTxsZ/tS8HfJ/DSqm/dhxnHzN/E6UvkN8D8JDjOFe6rru9WIfCEpC5RDSTmU8ioneCIPg1Ef1KKbUL4yySi67QkHAcZx0z/xDlL5JhAGuVUvcAR0xcD2Alyq+ye5WZtwC4M5PJlF1EFRkaIo7jrGDmDICmMt18AF8CMBfANZjYXTIgokwsFvtyT0/PL4t1qIsl+fWC67pbCouiy42LxzCyAcj1mPhPnmBmJ5/P73IcZ3XRDhMMGDEGrus+Wihc17nxxonMfG+hYO4YIkM1kMlk/jMIgiUAdK5iIwAbpZQ3HP3HyFBNZLPZ/yaixQD6NUt9K5FILB79j8hQjRRWri8BoHMDjgYi+kFht5jIUN0w81LoX77RMjAwcB0QGaodIrrZkM6XU6mUiAzVSKEw21Qd7+y+vr6zI0M14vt+0XdFXTDzishQvZxpUoyIFkeGaoSZZxqWnBsZqhEiMm3otMhQvZgu6QwiQ/VitJ4IwNuRoRohItOGvhgZqpEgCH5mUo+IHo0M1Yjv+5th8Hc0CIItkaEa8TzvFYwcTWKClzOZzM7IUM0UdkIzQQoAR4ZqxnXdfyOiRzTLPN/a2uoC0WyLKTYA+K2m2IeIqGN0G7vIUAO4rvsiEbWhzDL/CmFmvs513Z2jf4gMNYTrug8TkUNEYW1/nmPmGzKZTPboP0aGGqSwGm8JgFJb64yXN4no4kwm8/3jGyJDDeO67i8OHTr0cSKqpMwzx8xdlmUtcF338WIdorUtNaC5uflsZh73hplE9F8ANgdB0JPJZH5Vrm9kaA1g5j8p09YjhHgCwLDv+/uIqFcpNe4x4chQwxR29Sx6SAERvdvY2Phn3d3dv6s0fvQbaph4PH49gHixNmZOV2MmEBlqlFQqJQrbGxSFiP6lWo3olmuQvr6+yzFyXOd7YOZnlVK/qFYjukLNckOpBiFE1VcnEBlqDNu2TwHwRyWa34nFYpkwdCJDDRGLxW7AcRt9jUJEd4V1onBkqAE6OzvjRNRRqt33/fcM4VVKZKgBDhw4sAojpwYX4/FsNtsbllZkqBlKPgwxcygPQ6NEhmqmsALtwhLNbzU1NW0KUy8yVDO+729A6e2D7gx7T8TIUI0U9s29ukQzE9EPwtaMDNWIZVlXATi5RPNPXNcN/WjoyFC9GHsYGiUyVBNSykUAzi3RvH/q1KkP6tCNDNVEuUlsIurSddBAZKgGbNtuJqJkiWYfgLaDj6LpMw1YlpUEMLVYGzM/qJTaq0s7ukI1QESdZdq+p1M7MjRkksnkOcz8qWJtzPzL1tbWn+jUjwwNGd/3S76qEFHX6BoUXUSGhkhHR8c0IcRVJZqHofFhaJTooShEhoaGOgCcUKJ5k1LqN7pziK7QcFlfpk3rw9AokaEhkUgklgL4RInmPUqpomtRwiYyNCSEEOVGhr4HQ5tnTMhQIio6r8fMU2zbbggnpfrDtu0PMvPKEs2Hc7lcj6lcxjy3ZenSpdbMmTNtAFdi5KTbUl+CASLaFgTBvfPmzduk+/HcJFLKDwFYDuAijBzqNwNAMxHtD4JgHxE1A1ha4uM/UkpdaybTMQx1HOdiZv4nTHwT391ElKr34yYdxzmLmf8BwGdQ4c8TM5+TyWSeDjez0hQ1tKOjo2loaOj7ANqrjJ9ubGxcX29HT0oppwP4Z4wcJzmh06eO43mlVNUH606E93zr2tvbZw4NDT2B6s0EgOTQ0NBD69atKzVrP+loa2trAfAkABvVmQkierXaGBPlmEruQg3MdiL6wxA1TvF9//w5c+akX3rpJT/EuKHT1tZ2phDiSZSuoZ0oLQsWLDi5t7d3W0jxxuToK5Qsy7qLiELfVpuIzp82bdp3wo4bJu3t7TOFEJsATAkzLhF9Xkr5uTBjluOIoVJKGyO3GV2sl1JeojF+xaRSKZHP5zdhfMdSV8LtiUTibE2xj0EAI68mAEzsSXdrKpWadIMZ/f39kojO0ShhEdHtMPB7KgBg1qxZDoB5usUAnNbX11d0f4FaYdt2AzP/nQGpsx3H0f5vFwDAzGOd9h4mVxrUGpOGhoZlKH+6bmiUKxwLC7F8+fITiMjk6bxXTKZhwiAIVhiUuzCZTBatNQoLMXXq1E8yc6k5PB1ME0IUO/a5VlxuUKvR9/1lOgUs3/dnlhhz14YQ4lLHccyKFiGfzzcBMH22yiIA9+oKbgkhZjObPl4EG5l5o2nR44nFiq6Q1woRzdYZXwRBYNzN/88QkdazRIUQYr9OgYhjYeaw9sstimDmyFCzaD2cR1iW9RyAupreqmeYeZfO+KKnp+cQMz+sUyTiCDkhhNbKeQsAhBD3MfMVOoVGKRRMPWdCa5yczswbDGk95rru2zoFLABobm5ODwwM3ExEc3WKAXihpaXlTydTvVGhOmM59M20HIGIfqhbQwBAV1dXTgjxFd1iRHTTZDITALq7uweJKGVAamdLS8s9ukWOTGW5rpsFcL8uIWbudl13u6741ZDL5boB7ByrXxUEAG408WU+em6S8/l8EkDVe7YW4al33nlH+0xDpXie5zPzKgBvapK4WSn1mKbYx3DMZLPneYeFECsBPB+ixtOWZa3ctm3bUIgxQ6dw2oKNkF/hiKhHKfX1MGOW4z3VA+l0+jXLss5n5jC2LMvk8/kLe3p63gghlnaUUo8x83kAXg0jHhF9q6WlpQMGzxAtO+MhpVwO4BsAPjbBuHuI6G/qtdDatu3Z8Xj8TmaudKrrdWa+8fhjrEww5hRWZ2dn/MCBAw5GKg0uBvCBEl0PMfN2APf5vp/1PG9Sl2yOBynlJcz81QlUQv6OmW/zff8bnucd1JpcCSY0J7l27doTc7ncmQBOJaLpGLmVvEVEL+dyuWc9zzusJcsa097ePjefz68komUA5hHRyczcCOBtAHuZ+Rlm3hwEwQ7P84Zrmev/Aal8fmNSBxWtAAAAAElFTkSuQmCC"},cd49:function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var a=i("2b0e"),n=i("a925"),s=i("289d"),r=(i("2ca0"),localStorage.getItem("locale")?""+localStorage.getItem("locale"):(navigator.language||navigator.userLanguage).startsWith("de")?"de":"en"),o=r,l=i("3a0b"),c=i("b85c"),u=(i("d3b7"),i("3ca3"),i("ddb0"),i("99af"),i("8c4f")),h=i("a504");a["default"].use(u["a"]);var d=[{path:"/sql",component:function(){return i.e("sql").then(i.bind(null,"e254"))}},{path:"/*",component:function(){return Promise.all([i.e("sql"),i.e("split")]).then(i.bind(null,"aef8"))}},{path:"*",redirect:"/"}];function p(){var e,t=[],i=Object(c["a"])(l["a"].state.svnProjects);try{var a=function(){var i=e.value;t.push({path:"/"+i.slug+"*",name:i.slug,component:h["a"],props:function(e){return{root:i.slug,xsubfolder:e.path.substring(i.slug.length+2)}}})};for(i.s();!(e=i.n()).done;)a()}catch(n){i.e(n)}finally{i.f()}return t}function m(){var e,t=[],i=Object(c["a"])(l["a"].state.visualizationTypes.values());try{for(i.s();!(e=i.n()).done;){var a=e.value;t.push({path:"/v/"+a.kebabName+"/:project/*",name:a.kebabName,component:a.component,props:function(e){return{project:e.params.project,root:e.params.project}}})}}catch(n){i.e(n)}finally{i.f()}return t}var f=new u["a"]({mode:"history",base:"/",routes:p().concat(m()).concat(d),scrollBehavior:function(e,t,i){return i||{x:0,y:0}}}),v=f,g=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:{"full-page-app":!0,"dark-mode":e.isDarkMode},attrs:{id:"main-app"}},[i("div",{staticClass:"center-area"},[i("login-panel",{staticClass:"login-panel"}),i("router-view",{staticClass:"main-content"})],1),e.state.statusErrors.length?i("div",{staticClass:"message-zone"},[e._l(e.state.statusErrors,(function(t,a){return i("div",{staticClass:"message-error"},[e._m(0,!0),i("p",{domProps:{innerHTML:e._s(t)}})])})),i("button",{staticClass:"button is-small",on:{click:function(t){return e.removeAllErrors()}}},[e._v("CLEAR")])],2):e._e()])},b=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("p",[i("i",{staticClass:"fa fa-icon fa-exclamation-triangle",staticStyle:{color:"orange"}})])}],y=i("d4ec"),k=i("bee2"),S=i("262e"),w=i("2caf"),O=i("9ab4"),C=i("b7d4"),j=i.n(C),x=i("60a3"),T=i("10a0"),_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"sidebar-page"},[a("section",{staticClass:"sidebar-layout"},[a("b-sidebar",{attrs:{type:"is-light",fullheight:e.fullheight,fullwidth:e.fullwidth,overlay:e.overlay,right:e.right,open:e.open},on:{"update:open":function(t){e.open=t}}},[a("div",{staticClass:"all-stuff"},[a("div",{staticClass:"block"},[a("a",{attrs:{href:"/"}},[a("img",{staticClass:"vsp-logo",attrs:{src:i("e046"),alt:"TU Berlin VSP Department"}})])]),a("b-menu-list",{attrs:{label:"Login Required"}}),a("p",{staticClass:"my-label"},[e._v(e._s(e.whichLogin)+": access to this site requires a login.")]),a("b-menu-list",{attrs:{label:"Username"}}),a("b-input",{attrs:{placeholder:"VSP username",maxlength:"30"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),a("b-menu-list",{attrs:{label:"Password"}}),a("b-input",{attrs:{type:"password","password-reveal":""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),a("b-button",{staticClass:"my-space is-primary",attrs:{disabled:!e.username||!e.password},on:{click:e.clickedLogin}},[e._v("Login")])],1)])],1)])},R=[],M=(i("13d5"),i("4de4"),i("b0c0"),function(e){Object(S["a"])(i,e);var t=Object(w["a"])(i);function i(){var e;return Object(y["a"])(this,i),e=t.apply(this,arguments),e.globalState=l["a"].state,e.username="",e.password="",e.expandOnHover=!0,e.fullheight=!0,e.fullwidth=!1,e.mobile="reduce",e.reduce=!1,e.overlay=!0,e.right=!1,e.theme="is-light",e.projects=e.globalState.svnProjects,e.subfolders=[{name:"hello"}],e.open=!1,e}return Object(k["a"])(i,[{key:"showLoginPanel",value:function(){this.open=""!==this.globalState.needLoginForUrl}},{key:"panelMayBeClosing",value:function(){this.open||l["a"].commit("requestLogin","")}},{key:"whichLogin",get:function(){var e=this;try{var t=this.globalState.svnProjects.filter((function(t){return t.url===e.globalState.needLoginForUrl}))[0];return t.name}catch(i){}return"this site"}},{key:"clickedLogin",value:function(){l["a"].commit("setCredentials",{url:this.globalState.needLoginForUrl,username:this.username,pw:this.password}),this.globalState.needLoginForUrl=""}}]),i}(x["c"]));Object(O["a"])([Object(x["d"])("globalState.needLoginForUrl")],M.prototype,"showLoginPanel",null),Object(O["a"])([Object(x["d"])("open")],M.prototype,"panelMayBeClosing",null),M=Object(O["a"])([Object(x["a"])({components:{},props:{}})],M);var A=M,D=A,E=(i("920e"),i("2877")),L=Object(E["a"])(D,_,R,!1,null,"2682e7c8",null),F=L.exports,P=j.a;P.accessToken=T["e"];var z=function(e){Object(S["a"])(i,e);var t=Object(w["a"])(i);function i(){var e;return Object(y["a"])(this,i),e=t.apply(this,arguments),e.state=l["a"].state,e}return Object(k["a"])(i,[{key:"clickedLink",value:function(e){this.$router.push({path:e})}},{key:"mounted",value:function(){var e=localStorage.getItem("colorscheme")?localStorage.getItem("colorscheme"):(window.matchMedia&&window.matchMedia("(prefers-color-scheme:dark)")).matches?T["a"].DarkMode:T["a"].LightMode;e===T["a"].DarkMode&&this.$store.commit("rotateColors"),document.body.style.backgroundColor=e===T["a"].LightMode?"#edebe4":"#2d3133",this.toggleFullScreen(!0)}},{key:"topNavLinks",get:function(){var e=[{name:"scout",url:""}],t=e.concat(this.state.svnProjects);return t}},{key:"removeAllErrors",value:function(){this.$store.commit("clearAllErrors")}},{key:"toggleLocale",value:function(){var e="en"===this.state.locale?"de":"en";this.$store.commit("setLocale",e),this.$root.$i18n.locale=e}},{key:"toggleTheme",value:function(){this.$store.commit("rotateColors")}},{key:"isDarkMode",get:function(){return this.state.colorScheme==T["a"].DarkMode}},{key:"toggleFullScreen",value:function(e){e?(document.body.classList.add("full-screen-page"),document.documentElement.style.overflowY="auto"):(document.body.classList.remove("full-screen-page"),document.documentElement.style.overflowY=null)}}]),i}(x["c"]);z=Object(O["a"])([Object(x["a"])({components:{LoginPanel:F}})],z);var I=z,N=I,H=(i("5c0b"),i("1a8b")),B=Object(E["a"])(N,g,b,!1,null,null,null);"function"===typeof H["default"]&&Object(H["default"])(B);var V=B.exports,U=i("b8ae");l["a"].commit("setLocale",o),a["default"].use(n["a"]),a["default"].use(U["VuePlugin"]),a["default"].use(s["a"],{defaultIconPack:"mdi",defaultInputHasCounter:!1}),a["default"].config.productionTip=!1;var q=new n["a"]({locale:o,fallbackLocale:"en"});new a["default"]({i18n:q,router:v,store:l["a"],render:function(e){return e(V)}}).$mount("#app")},cf49:function(e,t,i){},d037:function(e,t,i){"use strict";var a=i("b85c"),n=i("1da1"),s=i("d4ec"),r=i("bee2"),o=(i("96cf"),i("8a79"),i("ac1f"),i("5319"),i("d3b7"),i("1276"),i("466d"),i("3a0b")),l=function(){function e(t){Object(s["a"])(this,e),this.urlId=t.slug,this.needsAuth=!!t.needPassword,this.baseUrl=t.baseURL,t.baseURL.endsWith("/")||(this.baseUrl+="/")}return Object(r["a"])(e,[{key:"cleanURL",value:function(e){var t=this.baseUrl+e.replace(/^0-9a-zA-Z_\-\/:+/i,"");return t=t.replaceAll("//","/"),t=t.replace("https:/","https://"),t=t.replace("http:/","http://"),t}},{key:"_getFileResponse",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var i,a,n,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=this.cleanURL(t),a={},n=o["a"].state.credentials[this.urlId],this.needsAuth&&(a["Authorization"]="Basic ".concat(n)),s=new Request(i,{headers:a}),e.next=7,fetch(s).then((function(e){if(200!=e.status)throw console.log("Status:",e.status),e;return e}));case 7:return r=e.sent,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileText",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getFileResponse(t);case 2:return i=e.sent,e.abrupt("return",i.text());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileJson",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getFileResponse(t);case 2:return i=e.sent,e.abrupt("return",i.json());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileBlob",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._getFileResponse(t);case 2:return i=e.sent,e.abrupt("return",i.blob());case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getDirectory",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var i,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t,i.endsWith("/")||(i+="/"),e.next=4,this._getFileResponse(i).then();case 4:return a=e.sent,e.next=7,a.text();case 7:return n=e.sent,e.abrupt("return",this.buildListFromHtml(n));case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"buildListFromHtml",value:function(e){return e.indexOf("SimpleWebServer")>-1?this.buildListFromSimpleWebServer(e):e.indexOf("<ul>")>-1?this.buildListFromSVN(e):e.indexOf("<table>")>-1?this.buildListFromApache24(e):{dirs:[],files:[]}}},{key:"buildListFromSimpleWebServer",value:function(e){var t,i=/">(.*?)<\/a/,n=[],s=[],r=e.split("\n"),o=Object(a["a"])(r);try{for(o.s();!(t=o.n()).done;){var l=t.value;console.log(l);var c=l.indexOf('<li><a href="');if(!(c<0)){var u=l.match(i);if(u){var h=u[1];h.endsWith("/")?n.push(h.substring(0,h.length-1)):s.push(h)}}}}catch(d){o.e(d)}finally{o.f()}return{dirs:n,files:s}}},{key:"buildListFromSVN",value:function(e){var t,i=/"(.*?)"/,n=[],s=[],r=e.split("\n"),o=Object(a["a"])(r);try{for(o.s();!(t=o.n()).done;){var l=t.value,c=l.indexOf('<li><a href="');if(!(c<0)){var u=l.match(i);if(u){var h=u[1];"../"!==h&&(h.endsWith("/")?n.push(h.substring(0,h.length-1)):s.push(h))}}}}catch(d){o.e(d)}finally{o.f()}return{dirs:n,files:s}}},{key:"buildListFromApache24",value:function(e){var t,i=/"(.*?)"/,n=[],s=[],r=e.split("\n"),o=Object(a["a"])(r);try{for(o.s();!(t=o.n()).done;){var l=t.value;if(!(l.indexOf('<th "')>-1)&&!(l.indexOf("[PARENTDIR]")>-1)){var c=l.indexOf('<td><a href="');if(!(c<0)){var u=l.substring(c).match(i);if(u){var h=u[1];"../"!==h&&(h.endsWith("/")?n.push(h.substring(0,h.length-1)):s.push(h))}}}}}catch(d){o.e(d)}finally{o.f()}return{dirs:n,files:s}}}]),e}();t["a"]=l},d1f5:function(e,t,i){"use strict";i.r(t),i.d(t,"OrbitControls",(function(){return n})),i.d(t,"MapControls",(function(){return s}));i("d3b7"),i("ddb0"),i("4c53");var a=i("5a89"),n=function(e,t){void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new a["x"],this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:a["k"].PAN,MIDDLE:a["k"].DOLLY,RIGHT:a["k"].PAN},this.touches={ONE:a["s"].PAN,TWO:a["s"].DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(n),i.update(),l=o.NONE},this.update=function(){var t=new a["x"],s=(new a["o"]).setFromUnitVectors(e.up,new a["x"](0,1,0)),r=s.clone().inverse(),f=new a["x"],v=new a["o"];return function(){var e=i.object.position;return t.copy(e).sub(i.target),t.applyQuaternion(s),u.setFromVector3(t),i.autoRotate&&l===o.NONE&&x(C()),i.enableDamping?(u.theta+=h.theta*i.dampingFactor,u.phi+=h.phi*i.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi),u.theta=Math.max(i.minAzimuthAngle,Math.min(i.maxAzimuthAngle,u.theta)),u.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=d,u.radius=Math.max(i.minDistance,Math.min(i.maxDistance,u.radius)),!0===i.enableDamping?i.target.addScaledVector(p,i.dampingFactor):i.target.add(p),t.setFromSpherical(u),t.applyQuaternion(r),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(h.theta*=1-i.dampingFactor,h.phi*=1-i.dampingFactor,p.multiplyScalar(1-i.dampingFactor)):(h.set(0,0,0),p.set(0,0,0)),d=1,!!(m||f.distanceToSquared(i.object.position)>c||8*(1-v.dot(i.object.quaternion))>c)&&(i.dispatchEvent(n),f.copy(i.object.position),v.copy(i.object.quaternion),m=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",oe,!1),i.domElement.removeEventListener("mousedown",Q,!1),i.domElement.removeEventListener("wheel",ie,!1),i.domElement.removeEventListener("touchstart",ne,!1),i.domElement.removeEventListener("touchend",re,!1),i.domElement.removeEventListener("touchmove",se,!1),document.removeEventListener("mousemove",ee,!1),document.removeEventListener("mouseup",te,!1),i.domElement.removeEventListener("keydown",ae,!1)};var i=this,n={type:"change"},s={type:"start"},r={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},l=o.NONE,c=1e-6,u=new a["r"],h=new a["r"],d=1,p=new a["x"],m=!1,f=new a["w"],v=new a["w"],g=new a["w"],b=new a["w"],y=new a["w"],k=new a["w"],S=new a["w"],w=new a["w"],O=new a["w"];function C(){return 2*Math.PI/60/60*i.autoRotateSpeed}function j(){return Math.pow(.95,i.zoomSpeed)}function x(e){h.theta-=e}function T(e){h.phi-=e}var _=function(){var e=new a["x"];return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),p.add(e)}}(),R=function(){var e=new a["x"];return function(t,a){!0===i.screenSpacePanning?e.setFromMatrixColumn(a,1):(e.setFromMatrixColumn(a,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),p.add(e)}}(),M=function(){var e=new a["x"];return function(t,a){var n=i.domElement;if(i.object.isPerspectiveCamera){var s=i.object.position;e.copy(s).sub(i.target);var r=e.length();r*=Math.tan(i.object.fov/2*Math.PI/180),_(2*t*r/n.clientHeight,i.object.matrix),R(2*a*r/n.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(_(t*(i.object.right-i.object.left)/i.object.zoom/n.clientWidth,i.object.matrix),R(a*(i.object.top-i.object.bottom)/i.object.zoom/n.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function A(e){i.object.isPerspectiveCamera?d/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function D(e){i.object.isPerspectiveCamera?d*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function E(e){f.set(e.clientX,e.clientY)}function L(e){S.set(e.clientX,e.clientY)}function F(e){b.set(e.clientX,e.clientY)}function P(e){v.set(e.clientX,e.clientY),g.subVectors(v,f).multiplyScalar(i.rotateSpeed);var t=i.domElement;x(2*Math.PI*g.x/t.clientHeight),T(2*Math.PI*g.y/t.clientHeight),f.copy(v),i.update()}function z(e){w.set(e.clientX,e.clientY),O.subVectors(w,S),O.y>0?A(j()):O.y<0&&D(j()),S.copy(w),i.update()}function I(e){y.set(e.clientX,e.clientY),k.subVectors(y,b).multiplyScalar(i.panSpeed),M(k.x,k.y),b.copy(y),i.update()}function N(){}function H(e){e.deltaY<0?D(j()):e.deltaY>0&&A(j()),i.update()}function B(e){var t=!1;switch(e.keyCode){case i.keys.UP:M(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:M(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:M(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:M(-i.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),i.update())}function V(e){if(1==e.touches.length)f.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);f.set(t,i)}}function U(e){if(1==e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,i)}}function q(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+i*i);S.set(0,a)}function W(e){i.enableZoom&&q(e),i.enablePan&&U(e)}function $(e){i.enableZoom&&q(e),i.enableRotate&&V(e)}function G(e){if(1==e.touches.length)v.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),a=.5*(e.touches[0].pageY+e.touches[1].pageY);v.set(t,a)}g.subVectors(v,f).multiplyScalar(i.rotateSpeed);var n=i.domElement;x(2*Math.PI*g.x/n.clientHeight),T(2*Math.PI*g.y/n.clientHeight),f.copy(v)}function Y(e){if(1==e.touches.length)y.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),a=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(t,a)}k.subVectors(y,b).multiplyScalar(i.panSpeed),M(k.x,k.y),b.copy(y)}function X(e){var t=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+a*a);w.set(0,n),O.set(0,Math.pow(w.y/S.y,i.zoomSpeed)),A(O.y),S.copy(w)}function Z(e){i.enableZoom&&X(e),i.enablePan&&Y(e)}function K(e){i.enableZoom&&X(e),i.enableRotate&&G(e)}function J(){}function Q(e){if(!1!==i.enabled){var t;switch(e.preventDefault(),i.domElement.focus?i.domElement.focus():window.focus(),e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case a["k"].DOLLY:if(!1===i.enableZoom)return;L(e),l=o.DOLLY;break;case a["k"].ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;F(e),l=o.PAN}else{if(!1===i.enableRotate)return;E(e),l=o.ROTATE}break;case a["k"].PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;E(e),l=o.ROTATE}else{if(!1===i.enablePan)return;F(e),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&(document.addEventListener("mousemove",ee,!1),document.addEventListener("mouseup",te,!1),i.dispatchEvent(s))}}function ee(e){if(!1!==i.enabled)switch(e.preventDefault(),l){case o.ROTATE:if(!1===i.enableRotate)return;P(e);break;case o.DOLLY:if(!1===i.enableZoom)return;z(e);break;case o.PAN:if(!1===i.enablePan)return;I(e);break}}function te(e){!1!==i.enabled&&(N(),document.removeEventListener("mousemove",ee,!1),document.removeEventListener("mouseup",te,!1),i.dispatchEvent(r),l=o.NONE)}function ie(e){!1===i.enabled||!1===i.enableZoom||l!==o.NONE&&l!==o.ROTATE||(e.preventDefault(),e.stopPropagation(),i.dispatchEvent(s),H(e),i.dispatchEvent(r))}function ae(e){!1!==i.enabled&&!1!==i.enableKeys&&!1!==i.enablePan&&B(e)}function ne(e){if(!1!==i.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(i.touches.ONE){case a["s"].ROTATE:if(!1===i.enableRotate)return;V(e),l=o.TOUCH_ROTATE;break;case a["s"].PAN:if(!1===i.enablePan)return;U(e),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(i.touches.TWO){case a["s"].DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;W(e),l=o.TOUCH_DOLLY_PAN;break;case a["s"].DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;$(e),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&i.dispatchEvent(s)}}function se(e){if(!1!==i.enabled)switch(e.preventDefault(),e.stopPropagation(),l){case o.TOUCH_ROTATE:if(!1===i.enableRotate)return;G(e),i.update();break;case o.TOUCH_PAN:if(!1===i.enablePan)return;Y(e),i.update();break;case o.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;Z(e),i.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;K(e),i.update();break;default:l=o.NONE}}function re(e){!1!==i.enabled&&(J(),i.dispatchEvent(r),l=o.NONE)}function oe(e){!1!==i.enabled&&e.preventDefault()}i.domElement.addEventListener("contextmenu",oe,!1),i.domElement.addEventListener("mousedown",Q,!1),i.domElement.addEventListener("wheel",ie,!1),i.domElement.addEventListener("touchstart",ne,!1),i.domElement.addEventListener("touchend",re,!1),i.domElement.addEventListener("touchmove",se,!1),i.domElement.addEventListener("keydown",ae,!1),-1===i.domElement.tabIndex&&(i.domElement.tabIndex=0),this.update()};n.prototype=Object.create(a["e"].prototype),n.prototype.constructor=n;var s=function(e,t){n.call(this,e,t),this.mouseButtons.LEFT=a["k"].PAN,this.mouseButtons.RIGHT=a["k"].ROTATE,this.touches.ONE=a["s"].PAN,this.touches.TWO=a["s"].DOLLY_ROTATE};s.prototype=Object.create(a["e"].prototype),s.prototype.constructor=s},d326:function(e,t,i){"use strict";var a=i("73ab"),n=i.n(a);t["default"]=n.a},d352:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"carriers":"Carriers","vehicles":"VEHICLES","services":"SERVICES","shipments":"SHIPMENTS","tours":"TOURS"},"de":{"carriers":"Unternehmen","vehicles":"FAHRZEUGE","services":"BETRIEBE","shipments":"LIEFERUNGEN","tours":"TOUREN"}}'),delete e.options._Ctor}},d388:function(e,t,i){"use strict";var a=i("e008"),n=i.n(a);t["default"]=n.a},d429:function(e,t,i){},d8a0:function(e,t,i){"use strict";var a=i("79f5"),n=i.n(a);t["default"]=n.a},dc81:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"outer",class:{collapsed:e.collapsed}},["left"===e.direction?i("div",{staticClass:"body left",style:{transform:e.collapsed?"translateX(-50%) scale(0,1)":"none"}},[e._t("default")],2):i("div",{staticClass:"body",style:{order:1,transform:e.collapsed?"translateX(50%) scale(0,1)":"none"}},[e._t("default")],2),e.locked?i("div",{staticClass:"xbutton",style:{order:"left"===e.direction?1:2}},[i("div",{staticClass:"rotate",staticStyle:{width:"0.8rem"}})]):i("div",{staticClass:"xbutton",class:{collapsed:e.collapsed},style:{order:"left"===e.direction?1:2},on:{click:e.handleClick}},[i("div",{staticClass:"rotate",style:{transform:"rotate("+(e.collapsed?180:360)+"deg)"}},[e._v(e._s("left"===e.direction?"<":">"))])])])},n=[],s=i("d4ec"),r=i("bee2"),o=i("262e"),l=i("2caf"),c=i("9ab4"),u=i("60a3"),h=function(e){Object(o["a"])(i,e);var t=Object(l["a"])(i);function i(){var e;return Object(s["a"])(this,i),e=t.apply(this,arguments),e.collapsed=void 0!==e.initialCollapsed&&e.initialCollapsed,e}return Object(r["a"])(i,[{key:"handleClick",value:function(){this.collapsed=!this.collapsed}}]),i}(u["c"]);Object(c["a"])([Object(u["b"])({required:!1})],h.prototype,"initialCollapsed",void 0),Object(c["a"])([Object(u["b"])({required:!0})],h.prototype,"direction",void 0),Object(c["a"])([Object(u["b"])({required:!1})],h.prototype,"locked",void 0),h=Object(c["a"])([u["a"]],h);var d=h,p=d,m=(i("e2cd"),i("2877")),f=Object(m["a"])(p,a,n,!1,null,"6c4f3e46",null);t["a"]=f.exports},e008:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"en":{"carriers":"Carriers","vehicles":"VEHICLES","services":"SERVICES","shipments":"SHIPMENTS","tours":"TOURS","pickup":"Pickup","delivery":"Delivery"},"de":{"carriers":"Unternehmen","vehicles":"FAHRZEUGE","services":"BETRIEBE","shipments":"LIEFERUNGEN","tours":"TOUREN","pickup":"Abholung","delivery":"Lieferung"}}'),delete e.options._Ctor}},e046:function(e,t,i){e.exports=i.p+"img/vsp-logo-left.5106857d.png"},e2bd:function(e,t,i){"use strict";i("2fbe")},e2cd:function(e,t,i){"use strict";i("3630")},e5dd:function(e,t,i){},e65f:function(e,t,i){"use strict";i("b95e")},e9b2:function(e,t,i){"use strict";i.r(t),t["default"]="// vertex shader: agent positions\n\nuniform float simulationTime;\nuniform float showSusceptible;\n\nattribute vec3 position2;  // x,y,t\n\n// this gets passed from vertex to fragment shader\nvarying float skip;\nvarying float atRest;\n\nfloat calculateSize() {\n\n    float small = 2.0;\n    float med = 5.0;\n    float big = 8.0;\n\n    // if (myInfectionStatus == 0.0) return small;\n    // else if (myInfectionStatus == 1.0) return big;\n    // else if (myInfectionStatus < 6.0) return med;\n\n    return med;\n}\n\nfloat calculateTimestep(in vec3 point1, in vec3 point2) {\n\n    atRest = 0.0;\n\n    if (point1 == point2) {\n        atRest = 1.0;\n        return 0.0;\n    }\n\n    // position vars have time in the .z to save some space\n    if (simulationTime < position.z) return 0.0;\n    if (simulationTime > position2.z) return 1.0;\n\n    float progress = simulationTime - position.z;\n    float duration = position2.z - position.z;\n\n    return progress / duration;\n}\n\n\nvec3 interpolate(in vec3 point1, in vec3 point2, in float timestepFraction) {\n\n    if (timestepFraction == 0.0) {\n\n        return point1;\n\n    } else if (timestepFraction >= 1.0 ) {\n\n        return point2;\n\n    } else {\n\n        vec3 direction = point2 - point1;\n\n        return (direction * timestepFraction) + point1;\n    }\n}\n\n\nvoid main() {\n\n    // don't do anything if this trip is currently out of time bounds\n    if (simulationTime < position.z || simulationTime > position2.z) {\n        gl_PointSize = 0.0;\n        gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n        skip = 1.0;\n        return;\n\n    } else {\n\n        // figure out z-index based on whether it is moving\n        float zIndex = atRest == 1.0 ? 0.2 : 0.3;\n\n        // unpack coords from position buffers - x,y,time. Deal w/ z later\n        vec3 point1 = vec3(position.xy, zIndex);\n        vec3 point2 = vec3(position2.xy, zIndex);\n\n        float timestepFraction = calculateTimestep(point1, point2);\n\n        vec3 newPosition = interpolate(point1, point2, timestepFraction);\n\n        gl_PointSize = calculateSize();\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\n\n        skip = 0.0;\n   }\n}\n"},ef1a:function(e,t,i){},ef3f:function(e,t,i){"use strict";i("6348")},f0aa:function(e,t,i){"use strict";i("55ea")},f181:function(e,t,i){},f6f0:function(e,t,i){"use strict";i("a058")},f863:function(e,t,i){"use strict";i.r(t),t["default"]='// BC 2021-04-30: this file forked from https://github.com/visgl/deck.gl\n//\n// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the "Software"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceSizes;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\n\nuniform float currentTime;\n\nuniform vec2 iconStillOffsets;\nuniform vec4 iconStillFrames;\n\nattribute float instanceTimestamps;\nattribute float instanceTimestampsNext;\nattribute vec2 instanceStartPositions;\nattribute vec2 instanceEndPositions;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\nvarying float vPercentComplete;\n\n// ------------------------------------------------------------------\n\nvec2 rotate_by_angle(vec2 vertex, float angle_radian) {\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvec3 interpolate(in vec3 point1, in vec3 point2, in float timestepFraction) {\n    if (timestepFraction <= 0.0) {\n        return point1;\n    } else if (timestepFraction >= 1.0 ) {\n        return point2;\n    } else {\n        vec3 direction = point2 - point1;\n        return point1 + (direction * timestepFraction);\n    }\n}\n\nvoid main(void) {\n\n  // Calculate progress:\n  // Skip everything else if this vertex is outside the time window\n  if (currentTime < instanceTimestamps) {\n    vPercentComplete = -1.0;\n    return;\n  } else if (currentTime > instanceTimestampsNext) {\n    vPercentComplete = -1.0;\n    return;\n  } else {\n    vPercentComplete = (currentTime - instanceTimestamps) /\n                       (instanceTimestampsNext - instanceTimestamps);\n  }\n\n  geometry.pickingColor = instancePickingColors;\n\n  vec3 startPosition = vec3(instanceStartPositions, 5.0);\n  vec3 endPosition = vec3(instanceEndPositions, 5.0);\n\n  // are we stationary/still\n  bool still = (instanceStartPositions == instanceEndPositions);\n\n  // geometry.uv = positions;\n  // uv = positions;\n\n  // this could be the problem right here;\n  vec2 iconSize = still ? iconStillFrames.zw : instanceIconFrames.zw;\n  // convert size in meters to pixels, then scaled and clamp\n  // project meters to pixels and clamp to limits\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale),\n    sizeMinPixels, sizeMaxPixels\n  );\n\n  // scale icon height to match instanceSize\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n\n  // // figure out angle based on motion direction\n  float angle = 0.0;\n  if (!still) {\n    vec3 direction = normalize(endPosition - startPosition);\n    angle = atan( direction.y / direction.x);\n    if (direction.x < 0.0) angle = angle - PI;\n  }\n\n  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace\n  vec2 pixelOffset = positions / 2.0 * iconSize + (still ? iconStillOffsets : instanceOffsets);\n  pixelOffset = rotate_by_angle(pixelOffset, angle) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  vec3 newPosition = interpolate(startPosition, endPosition, vPercentComplete);\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(newPosition, vec3(0.0), vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(newPosition, vec3(0.0), offset_common, geometry.position);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vec2 upperleft = (still ? iconStillFrames.xy : instanceIconFrames.xy);\n\n  vTextureCoords = mix(\n    upperleft,\n    upperleft + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = instanceColorModes;\n}\n'},fa45:function(e,t,i){"use strict";i.d(t,"a",(function(){return k}));var a=i("2909"),n=i("5530"),s=i("d4ec"),r=i("bee2"),o=(i("07ac"),i("45eb")),l=i("7e84"),c=i("262e"),u=i("2caf"),h=(i("3835"),i("4fad"),i("99af"),i("9b26")),d=i("b7d4"),p=i.n(d),m=i("3a0b"),f=i("10a0"),v={layers:[],mapStyle:m["a"].state.isDarkMode?f["f"].dark:f["f"].light,controller:!0,useDevicePixels:!1,getCursor:function(e){var t=e.isDragging,i=e.isHovering;return t?"grabbing":i?"pointer":""}},g={position:"absolute",left:0,top:0,width:"100%",height:"100%"};m["a"].state.colorScheme,f["a"].DarkMode;function b(e){var t=e.container,i=void 0===t?document.body:t;if("string"===typeof i&&(i=document.querySelector(i)),!i)throw new Error("[DeckMap] container not found");var a=window.getComputedStyle(i);"static"===a.position&&(i.style.position="relative");var n=document.createElement("div");i.appendChild(n),Object.assign(n.style,g);var s=document.createElement("canvas");return s.oncontextmenu=function(){return!1},i.appendChild(s),Object.assign(s.style,g),{container:i,mapboxCanvas:n,deckCanvas:s}}var y=function(e){Object(c["a"])(i,e);var t=Object(u["a"])(i);function i(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s["a"])(this,i),a=Object(n["a"])(Object(n["a"])({},v),{},{onResize:function(){e._map&&e._map.resize()}},a);var r=b(a),o=r.mapboxCanvas,l=r.deckCanvas,c=a.viewState,u=a.basemap;return e=t.call(this,Object(n["a"])({canvas:l},a)),e._map=u||new p.a.Map({container:o,style:a.mapStyle,interactive:!1,center:[c.longitude,c.latitude],zoom:c.zoom,bearing:c.bearing||0,pitch:c.pitch||0}),e._onBeforeRender=function(t){if(e.onBeforeRender(t),e._map){var i=e.getViewports()[0];e._map.jumpTo({center:[i.longitude,i.latitude],zoom:i.zoom,bearing:i.bearing,pitch:i.pitch}),e.redrawMapbox()}},e}return Object(r["a"])(i,[{key:"redrawMapbox",value:function(){var e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}},{key:"setMapStyle",value:function(e){this._map&&this._map.setStyle(e)}},{key:"getMapboxMap",value:function(){return this._map}},{key:"finalize",value:function(){this._map&&this._map.remove(),Object(o["a"])(Object(l["a"])(i.prototype),"finalize",this).call(this)}},{key:"setProps",value:function(e){"onBeforeRender"in e&&this._onBeforeRender&&e.onBeforeRender!==this._onBeforeRender&&(this.onBeforeRender=e.onBeforeRender,e.onBeforeRender=this._onBeforeRender),Object(o["a"])(Object(l["a"])(i.prototype),"setProps",this).call(this,e)}}]),i}(h["a"]),k=function(){function e(){Object(s["a"])(this,e),this.layers={},this.deckInstance=null}return Object(r["a"])(e,[{key:"init",value:function(e){this.deckInstance=new y(Object(n["a"])(Object(n["a"])({},e),{},{map:f["e"]}))}},{key:"destroy",value:function(){this.deckInstance&&(this.deckInstance.finalize(),delete this.deckInstance)}},{key:"hasLayer",value:function(e){return!!this.layers[e]}},{key:"getLayers",value:function(){return this.layers}},{key:"isVisible",value:function(e){return this.layers[e]&&!1!==this.layers[e].props.visible}},{key:"updateDeckInstance",value:function(){if(this.deckInstance){var e=Object(a["a"])(Object.values(this.layers));this.deckInstance.setProps({layers:e})}}},{key:"updateStyle",value:function(){if(this.deckInstance){var e=m["a"].state.isDarkMode?f["f"].dark:f["f"].light;this.deckInstance.setMapStyle(e)}}},{key:"addLayer",value:function(e){if(!e.id)throw new Error('[layerManager.addLayer] layer id must defined. Received "'.concat(e.id,'" instead'));this.layers[e.id]=e,this.updateDeckInstance()}},{key:"updateLayer",value:function(e,t){if(this.layers[e]){var i=this.layers[e];this.layers[e]=i.clone(t),this.updateDeckInstance()}}},{key:"removeLayer",value:function(e){this.hasLayer(e)&&(delete this.layers[e],this.updateDeckInstance())}},{key:"hideLayer",value:function(e){this.hasLayer(e)&&this.updateLayer(e,{visible:!1})}},{key:"showLayer",value:function(e){this.hasLayer(e)&&this.updateLayer(e,{visible:!0})}}]),e}()},fbbf:function(e,t,i){"use strict";i("bade")},fc60:function(e,t,i){"use strict";i("1bf3")},ffb1:function(e,t,i){}});